/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{419:function(t,e,n){"use strict";n.d(e,"a",(function(){return w}));var r=n(415),o=n(418),c=n(417),h=n(420);class l{constructor(t,e){this._delegate=t,this.firebase=e,Object(c._addComponent)(t,new o.a("app-compat",(()=>this),"PUBLIC")),this.container=t.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this._delegate.automaticDataCollectionEnabled=t}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((t=>{this._delegate.checkDestroyed(),t()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Object(c.deleteApp)(this._delegate))))}_getService(t,e=c._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(t);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:e})}_removeServiceInstance(t,e=c._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(t).clearInstance(e)}_addComponent(component){Object(c._addComponent)(this._delegate,component)}_addOrOverwriteComponent(component){Object(c._addOrOverwriteComponent)(this._delegate,component)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const d={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},f=new r.b("app-compat","Firebase",d);const m=function t(){const e=function(t){const e={},n={__esModule:!0,initializeApp:function(o,h={}){const l=c.initializeApp(o,h);if(Object(r.e)(e,l.name))return e[l.name];const d=new t(l,n);return e[l.name]=d,d},app:o,registerVersion:c.registerVersion,setLogLevel:c.setLogLevel,onLog:c.onLog,apps:null,SDK_VERSION:c.SDK_VERSION,INTERNAL:{registerComponent:function(component){const e=component.name,h=e.replace("-compat","");if(c._registerComponent(component)&&"PUBLIC"===component.type){const c=(t=o())=>{if("function"!=typeof t[h])throw f.create("invalid-app-argument",{appName:e});return t[h]()};void 0!==component.serviceProps&&Object(r.i)(c,component.serviceProps),n[h]=c,t.prototype[h]=function(...t){return this._getService.bind(this,e).apply(this,component.multipleInstances?t:[])}}return"PUBLIC"===component.type?n[h]:null},removeApp:function(t){delete e[t]},useAsService:function(t,e){return"serverAuth"===e?null:e},modularAPIs:c}};function o(t){if(t=t||c._DEFAULT_ENTRY_NAME,!Object(r.e)(e,t))throw f.create("no-app",{appName:t});return e[t]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(e).map((t=>e[t]))}}),o.App=t,n}(l);return e.INTERNAL=Object.assign(Object.assign({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){Object(r.i)(e,t)},createSubscribe:r.g,ErrorFactory:r.b,deepExtend:r.i}),e}(),y=new h.b("@firebase/app-compat");if(Object(r.m)()&&void 0!==self.firebase){y.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const t=self.firebase.SDK_VERSION;t&&t.indexOf("LITE")>=0&&y.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const w=m;var v;Object(c.registerVersion)("@firebase/app-compat","0.1.8",v)},514:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return mu})),n.d(e,"b",(function(){return dc})),n.d(e,"c",(function(){return Xa})),n.d(e,"d",(function(){return qa})),n.d(e,"e",(function(){return zc})),n.d(e,"f",(function(){return lc})),n.d(e,"g",(function(){return x})),n.d(e,"h",(function(){return gc})),n.d(e,"i",(function(){return Gc})),n.d(e,"j",(function(){return Qc})),n.d(e,"k",(function(){return $})),n.d(e,"l",(function(){return wu})),n.d(e,"m",(function(){return Da})),n.d(e,"n",(function(){return lt})),n.d(e,"o",(function(){return X})),n.d(e,"p",(function(){return Fa})),n.d(e,"q",(function(){return A})),n.d(e,"r",(function(){return J})),n.d(e,"s",(function(){return E})),n.d(e,"t",(function(){return Ca})),n.d(e,"u",(function(){return ku})),n.d(e,"v",(function(){return qu})),n.d(e,"w",(function(){return Uu})),n.d(e,"x",(function(){return sc})),n.d(e,"y",(function(){return Ka})),n.d(e,"z",(function(){return $a})),n.d(e,"A",(function(){return Ua})),n.d(e,"B",(function(){return xu})),n.d(e,"C",(function(){return Mu})),n.d(e,"D",(function(){return ac})),n.d(e,"E",(function(){return za})),n.d(e,"F",(function(){return ec})),n.d(e,"G",(function(){return nc})),n.d(e,"H",(function(){return oc})),n.d(e,"I",(function(){return lu})),n.d(e,"J",(function(){return hu})),n.d(e,"K",(function(){return Za})),n.d(e,"L",(function(){return Ru})),n.d(e,"M",(function(){return bu})),n.d(e,"N",(function(){return Tu})),n.d(e,"O",(function(){return Eu})),n.d(e,"P",(function(){return _u})),n.d(e,"Q",(function(){return Su})),n.d(e,"R",(function(){return Nu})),n.d(e,"S",(function(){return ju})),n.d(e,"T",(function(){return su})),n.d(e,"U",(function(){return iu})),n.d(e,"V",(function(){return cc})),n.d(e,"W",(function(){return uc})),n.d(e,"X",(function(){return Cu})),n.d(e,"Y",(function(){return Ou})),n.d(e,"Z",(function(){return nu})),n.d(e,"ab",(function(){return Jc})),n.d(e,"bb",(function(){return Qa})),n.d(e,"cb",(function(){return Ga})),n.d(e,"db",(function(){return Pu})),n.d(e,"eb",(function(){return Vu})),n.d(e,"fb",(function(){return Au})),n.d(e,"gb",(function(){return v})),n.d(e,"hb",(function(){return Wc})),n.d(e,"ib",(function(){return cu})),n.d(e,"jb",(function(){return au})),n.d(e,"kb",(function(){return Du})),n.d(e,"lb",(function(){return ic})),n.d(e,"mb",(function(){return tu}));var r=n(417),o=n(418),c=n(420),h=n(415),l=n(515);const d="@firebase/firestore";class f{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}f.UNAUTHENTICATED=new f(null),f.GOOGLE_CREDENTIALS=new f("google-credentials-uid"),f.FIRST_PARTY=new f("first-party-uid"),f.MOCK_USER=new f("mock-user");let m="9.4.0";const y=new c.b("@firebase/firestore");function w(){return y.logLevel}function v(t){y.setLogLevel(t)}function I(t,...e){if(y.logLevel<=c.a.DEBUG){const n=e.map(_);y.debug(`Firestore (${m}): ${t}`,...n)}}function T(t,...e){if(y.logLevel<=c.a.ERROR){const n=e.map(_);y.error(`Firestore (${m}): ${t}`,...n)}}function E(t,...e){if(y.logLevel<=c.a.WARN){const n=e.map(_);y.warn(`Firestore (${m}): ${t}`,...n)}}function _(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function S(t="Unexpected state"){const e=`FIRESTORE (${m}) INTERNAL ASSERTION FAILED: `+t;throw T(e),new Error(e)}function N(t,e){t||S()}function A(t,e){t||S()}function q(t,e){return t}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class x extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class k{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class C{constructor(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization=`Bearer ${t}`}}class O{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(f.UNAUTHENTICATED)))}shutdown(){}}class R{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class L{constructor(t){this.t=t,this.currentUser=f.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new k;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new k,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{I("FirebaseCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(I("FirebaseCredentialsProvider","Auth not yet detected"),i.resolve(),i=new k)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(I("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(N("string"==typeof e.accessToken),new C(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return N(null===t||"string"==typeof t),new f(t)}}class F{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=f.FIRST_PARTY}get authHeaders(){const t={"X-Goog-AuthUser":this.l},e=this.h.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.m&&(t["X-Goog-Iam-Authorization-Token"]=this.m),t}}class P{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new F(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(f.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class M{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.g(t),this.p=t=>e.writeSequenceNumber(t))}g(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.p&&this.p(t),t}}function V(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}M.T=-1;class U{static I(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=V(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function j(t,e){return t<e?-1:t>e?1:0}function B(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}function K(t){return t+"\0"}class ${constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new x(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return $.fromMillis(Date.now())}static fromDate(t){return $.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new $(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?j(this.nanoseconds,t.nanoseconds):j(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rt{constructor(t){this.timestamp=t}static fromTimestamp(t){return new rt(t)}static min(){return new rt(new $(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function z(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function G(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Q(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class H{constructor(t,e,n){void 0===e?e=0:e>t.length&&S(),void 0===n?n=t.length-e:n>t.length-e&&S(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===H.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof H?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class W extends H{construct(t,e,n){return new W(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new x(D.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new W(e)}static emptyPath(){return new W([])}}const Y=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class X extends H{construct(t,e,n){return new X(t,e,n)}static isValidIdentifier(t){return Y.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),X.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new X(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new x(D.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new x(D.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new x(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new x(D.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new X(e)}static emptyPath(){return new X([])}}class dt{constructor(t){this.fields=t,t.sort(X.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return B(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}function J(){return"undefined"!=typeof atob}class Z{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new Z(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Z(e)}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return j(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Z.EMPTY_BYTE_STRING=new Z("");const tt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function et(t){if(N(!!t),"string"==typeof t){let e=0;const n=tt.exec(t);if(N(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:nt(t.seconds),nanos:nt(t.nanos)}}function nt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function st(t){return"string"==typeof t?Z.fromBase64String(t):Z.fromUint8Array(t)}function it(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ot(t){const e=t.mapValue.fields.__previous_value__;return it(e)?ot(e):e}function at(t){const e=et(t.mapValue.fields.__local_write_time__.timestampValue);return new $(e.seconds,e.nanos)}function ct(t){return null==t}function ut(t){return 0===t&&1/t==-1/0}function ht(t){return"number"==typeof t&&Number.isInteger(t)&&!ut(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class lt{constructor(t){this.path=t}static fromPath(t){return new lt(W.fromString(t))}static fromName(t){return new lt(W.fromString(t).popFirst(5))}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===W.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return W.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new lt(new W(t.slice()))}}function ft(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?it(t)?4:10:S()}function gt(t,e){const n=ft(t);if(n!==ft(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return at(t).isEqual(at(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=et(t.timestampValue),s=et(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return st(t.bytesValue).isEqual(st(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return nt(t.geoPointValue.latitude)===nt(e.geoPointValue.latitude)&&nt(t.geoPointValue.longitude)===nt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return nt(t.integerValue)===nt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=nt(t.doubleValue),s=nt(e.doubleValue);return n===s?ut(n)===ut(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return B(t.arrayValue.values||[],e.arrayValue.values||[],gt);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(z(n)!==z(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!gt(n[t],s[t])))return!1;return!0}(t,e);default:return S()}}function mt(t,e){return void 0!==(t.values||[]).find((t=>gt(t,e)))}function pt(t,e){const n=ft(t),s=ft(e);if(n!==s)return j(n,s);switch(n){case 0:return 0;case 1:return j(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=nt(t.integerValue||t.doubleValue),s=nt(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return yt(t.timestampValue,e.timestampValue);case 4:return yt(at(t),at(e));case 5:return j(t.stringValue,e.stringValue);case 6:return function(t,e){const n=st(t),s=st(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=j(n[t],s[t]);if(0!==e)return e}return j(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=j(nt(t.latitude),nt(e.latitude));return 0!==n?n:j(nt(t.longitude),nt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=pt(n[t],s[t]);if(e)return e}return j(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=j(s[t],r[t]);if(0!==e)return e;const o=pt(n[s[t]],i[r[t]]);if(0!==o)return o}return j(s.length,r.length)}(t.mapValue,e.mapValue);default:throw S()}}function yt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return j(t,e);const n=et(t),s=et(e),i=j(n.seconds,s.seconds);return 0!==i?i:j(n.nanos,s.nanos)}function wt(t){return vt(t)}function vt(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=et(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?st(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,lt.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=vt(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${vt(t.fields[i])}`;return n+"}"}(t.mapValue):S();var e,n}function bt(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function It(t){return!!t&&"integerValue"in t}function Tt(t){return!!t&&"arrayValue"in t}function Et(t){return!!t&&"nullValue"in t}function _t(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function St(t){return!!t&&"mapValue"in t}function Nt(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return G(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Nt(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Nt(t.arrayValue.values[n]);return e}return Object.assign({},t)}class At{constructor(t){this.value=t}static empty(){return new At({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!St(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Nt(e)}setAll(t){let e=X.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=Nt(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());St(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return gt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];St(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){G(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new At(Nt(this.value))}}function Dt(t){const e=[];return G(t.fields,((t,n)=>{const s=new X([t]);if(St(n)){const t=Dt(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new dt(e)}class xt{constructor(t,e,n,s,i){this.key=t,this.documentType=e,this.version=n,this.data=s,this.documentState=i}static newInvalidDocument(t){return new xt(t,0,rt.min(),At.empty(),0)}static newFoundDocument(t,e,n){return new xt(t,1,e,n,0)}static newNoDocument(t,e){return new xt(t,2,e,At.empty(),0)}static newUnknownDocument(t,e){return new xt(t,3,e,At.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=At.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=At.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof xt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}clone(){return new xt(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class kt{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.A=null}}function Ct(t,e=null,n=[],s=[],i=null,r=null,o=null){return new kt(t,e,n,s,i,r,o)}function Ot(t){const e=q(t);if(null===e.A){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>function(t){return t.field.canonicalString()+t.op.toString()+wt(t.value)}(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),ct(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=zt(e.startAt)),e.endAt&&(t+="|ub:",t+=zt(e.endAt)),e.A=t}return e.A}function Rt(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Qt(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!gt(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Wt(t.startAt,e.startAt)&&Wt(t.endAt,e.endAt)}function Lt(t){return lt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ft extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.R(t,e,n):new Pt(t,e,n):"array-contains"===e?new qt(t,n):"in"===e?new jt(t,n):"not-in"===e?new Bt(t,n):"array-contains-any"===e?new Kt(t,n):new Ft(t,e,n)}static R(t,e,n){return"in"===e?new Mt(t,n):new Vt(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.P(pt(e,this.value)):null!==e&&ft(this.value)===ft(e)&&this.P(pt(e,this.value))}P(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return S()}}v(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Pt extends Ft{constructor(t,e,n){super(t,e,n),this.key=lt.fromName(n.referenceValue)}matches(t){const e=lt.comparator(t.key,this.key);return this.P(e)}}class Mt extends Ft{constructor(t,e){super(t,"in",e),this.keys=Ut("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Vt extends Ft{constructor(t,e){super(t,"not-in",e),this.keys=Ut("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Ut(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>lt.fromName(t.referenceValue)))}class qt extends Ft{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Tt(e)&&mt(e.arrayValue,this.value)}}class jt extends Ft{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&mt(this.value.arrayValue,e)}}class Bt extends Ft{constructor(t,e){super(t,"not-in",e)}matches(t){if(mt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!mt(this.value.arrayValue,e)}}class Kt extends Ft{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Tt(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>mt(this.value.arrayValue,t)))}}class $t{constructor(t,e){this.position=t,this.before=e}}function zt(t){return`${t.before?"b":"a"}:${t.position.map((t=>wt(t))).join(",")}`}class Gt{constructor(t,e="asc"){this.field=t,this.dir=e}}function Qt(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Ht(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?lt.comparator(lt.fromName(o.referenceValue),n.key):pt(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function Wt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!gt(t.position[n],e.position[n]))return!1;return!0}class Yt{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=c,this.V=null,this.S=null,this.startAt,this.endAt}}function Xt(t,e,n,s,i,r,o,c){return new Yt(t,e,n,s,i,r,o,c)}function Jt(t){return new Yt(t)}function Zt(t){return!ct(t.limit)&&"F"===t.limitType}function te(t){return!ct(t.limit)&&"L"===t.limitType}function ee(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function ne(t){for(const e of t.filters)if(e.v())return e.field;return null}function re(t){return null!==t.collectionGroup}function se(t){const e=q(t);if(null===e.V){e.V=[];const t=ne(e),n=ee(e);if(null!==t&&null===n)t.isKeyField()||e.V.push(new Gt(t)),e.V.push(new Gt(X.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.V.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.V.push(new Gt(X.keyField(),t))}}}return e.V}function ie(t){const e=q(t);if(!e.S)if("F"===e.limitType)e.S=Ct(e.path,e.collectionGroup,se(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of se(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Gt(n.field,e))}const n=e.endAt?new $t(e.endAt.position,!e.endAt.before):null,s=e.startAt?new $t(e.startAt.position,!e.startAt.before):null;e.S=Ct(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.S}function oe(t,e,n){return new Yt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function ae(t,e){return Rt(ie(t),ie(e))&&t.limitType===e.limitType}function ce(t){return`${Ot(ie(t))}|lt:${t.limitType}`}function ue(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${wt(e.value)}`;var e})).join(", ")}]`),ct(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: "+zt(t.startAt)),t.endAt&&(e+=", endAt: "+zt(t.endAt)),`Target(${e})`}(ie(t))}; limitType=${t.limitType})`}function he(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):lt.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Ht(t.startAt,se(t),e))&&(!t.endAt||!Ht(t.endAt,se(t),e))}(t,e)}function le(t){return(e,n)=>{let s=!1;for(const i of se(t)){const t=de(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function de(t,e,n){const s=t.field.isKeyField()?lt.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?pt(s,i):S()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return S()}}function fe(t,e){if(t.D){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ut(e)?"-0":e}}function ge(t){return{integerValue:""+t}}function me(t,e){return ht(e)?ge(e):fe(t,e)}class pe{constructor(){this._=void 0}}function ye(t,e,n){return t instanceof be?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ie?Te(t,e):t instanceof Ee?_e(t,e):function(t,e){const n=ve(t,e),s=Ne(n)+Ne(t.C);return It(n)&&It(t.C)?ge(s):fe(t.N,s)}(t,e)}function we(t,e,n){return t instanceof Ie?Te(t,e):t instanceof Ee?_e(t,e):n}function ve(t,e){return t instanceof Se?It(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class be extends pe{}class Ie extends pe{constructor(t){super(),this.elements=t}}function Te(t,e){const n=Ae(e);for(const e of t.elements)n.some((t=>gt(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Ee extends pe{constructor(t){super(),this.elements=t}}function _e(t,e){let n=Ae(e);for(const e of t.elements)n=n.filter((t=>!gt(t,e)));return{arrayValue:{values:n}}}class Se extends pe{constructor(t,e){super(),this.N=t,this.C=e}}function Ne(t){return nt(t.integerValue||t.doubleValue)}function Ae(t){return Tt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class De{constructor(t,e){this.field=t,this.transform=e}}class xe{constructor(t,e){this.version=t,this.transformResults=e}}class ke{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ke}static exists(t){return new ke(void 0,t)}static updateTime(t){return new ke(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ce(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Oe{}function Re(t,e,n){t instanceof Ve?function(t,e,n){const s=t.value.clone(),i=je(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Ue?function(t,e,n){if(!Ce(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=je(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(qe(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Le(t,e,n){t instanceof Ve?function(t,e,n){if(!Ce(t.precondition,e))return;const s=t.value.clone(),i=Be(t.fieldTransforms,n,e);s.setAll(i),e.convertToFoundDocument(Me(e),s).setHasLocalMutations()}(t,e,n):t instanceof Ue?function(t,e,n){if(!Ce(t.precondition,e))return;const s=Be(t.fieldTransforms,n,e),i=e.data;i.setAll(qe(t)),i.setAll(s),e.convertToFoundDocument(Me(e),i).setHasLocalMutations()}(t,e,n):function(t,e){Ce(t.precondition,e)&&e.convertToNoDocument(rt.min())}(t,e)}function Fe(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=ve(s.transform,t||null);null!=i&&(null==n&&(n=At.empty()),n.set(s.field,i))}return n||null}function Pe(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&B(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ie&&e instanceof Ie||t instanceof Ee&&e instanceof Ee?B(t.elements,e.elements,gt):t instanceof Se&&e instanceof Se?gt(t.C,e.C):t instanceof be&&e instanceof be}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Me(t){return t.isFoundDocument()?t.version:rt.min()}class Ve extends Oe{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}}class Ue extends Oe{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}}function qe(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function je(t,e,n){const s=new Map;N(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,c=e.data.field(r.field);s.set(r.field,we(o,c,n[i]))}return s}function Be(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,ye(t,r,e))}return s}class Ke extends Oe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class $e extends Oe{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class ze{constructor(t){this.count=t}}var Ge,Qe;function He(t){switch(t){default:return S();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0}}function We(t){if(void 0===t)return T("GRPC error has no .code"),D.UNKNOWN;switch(t){case Ge.OK:return D.OK;case Ge.CANCELLED:return D.CANCELLED;case Ge.UNKNOWN:return D.UNKNOWN;case Ge.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case Ge.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case Ge.INTERNAL:return D.INTERNAL;case Ge.UNAVAILABLE:return D.UNAVAILABLE;case Ge.UNAUTHENTICATED:return D.UNAUTHENTICATED;case Ge.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case Ge.NOT_FOUND:return D.NOT_FOUND;case Ge.ALREADY_EXISTS:return D.ALREADY_EXISTS;case Ge.PERMISSION_DENIED:return D.PERMISSION_DENIED;case Ge.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case Ge.ABORTED:return D.ABORTED;case Ge.OUT_OF_RANGE:return D.OUT_OF_RANGE;case Ge.UNIMPLEMENTED:return D.UNIMPLEMENTED;case Ge.DATA_LOSS:return D.DATA_LOSS;default:return S()}}(Qe=Ge||(Ge={}))[Qe.OK=0]="OK",Qe[Qe.CANCELLED=1]="CANCELLED",Qe[Qe.UNKNOWN=2]="UNKNOWN",Qe[Qe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qe[Qe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qe[Qe.NOT_FOUND=5]="NOT_FOUND",Qe[Qe.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qe[Qe.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qe[Qe.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qe[Qe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qe[Qe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qe[Qe.ABORTED=10]="ABORTED",Qe[Qe.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qe[Qe.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qe[Qe.INTERNAL=13]="INTERNAL",Qe[Qe.UNAVAILABLE=14]="UNAVAILABLE",Qe[Qe.DATA_LOSS=15]="DATA_LOSS";class Ye{constructor(t,e){this.comparator=t,this.root=e||Je.EMPTY}insert(t,e){return new Ye(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Je.BLACK,null,null))}remove(t){return new Ye(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Je.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Xe(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Xe(this.root,t,this.comparator,!1)}getReverseIterator(){return new Xe(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Xe(this.root,t,this.comparator,!0)}}class Xe{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Je{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:Je.RED,this.left=null!=s?s:Je.EMPTY,this.right=null!=i?i:Je.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new Je(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Je.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return Je.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Je.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Je.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw S();if(this.right.isRed())throw S();const t=this.left.check();if(t!==this.right.check())throw S();return t+(this.isRed()?0:1)}}Je.EMPTY=null,Je.RED=!0,Je.BLACK=!1,Je.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(t,e,n,s,i){return this}insert(t,e,n){return new Je(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ze{constructor(t){this.comparator=t,this.data=new Ye(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new tn(this.data.getIterator())}getIteratorFrom(t){return new tn(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ze))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ze(this.comparator);return e.data=t,e}}class tn{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const en=new Ye(lt.comparator);function nn(){return en}const rn=new Ye(lt.comparator);function sn(){return rn}const on=new Ye(lt.comparator);function an(){return on}const cn=new Ze(lt.comparator);function un(...t){let e=cn;for(const n of t)e=e.add(n);return e}const hn=new Ze(j);function ln(){return hn}class dn{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,fn.createSynthesizedTargetChangeForCurrentChange(t,e)),new dn(rt.min(),n,ln(),nn(),un())}}class fn{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e){return new fn(Z.EMPTY_BYTE_STRING,e,un(),un(),un())}}class gn{constructor(t,e,n,s){this.k=t,this.removedTargetIds=e,this.key=n,this.$=s}}class mn{constructor(t,e){this.targetId=t,this.O=e}}class pn{constructor(t,e,n=Z.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class yn{constructor(){this.F=0,this.M=bn(),this.L=Z.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}get current(){return this.B}get resumeToken(){return this.L}get q(){return 0!==this.F}get K(){return this.U}j(t){t.approximateByteSize()>0&&(this.U=!0,this.L=t)}W(){let t=un(),e=un(),n=un();return this.M.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:S()}})),new fn(this.L,this.B,t,e,n)}G(){this.U=!1,this.M=bn()}H(t,e){this.U=!0,this.M=this.M.insert(t,e)}J(t){this.U=!0,this.M=this.M.remove(t)}Y(){this.F+=1}X(){this.F-=1}Z(){this.U=!0,this.B=!0}}class wn{constructor(t){this.tt=t,this.et=new Map,this.nt=nn(),this.st=vn(),this.it=new Ze(j)}rt(t){for(const e of t.k)t.$&&t.$.isFoundDocument()?this.ot(e,t.$):this.ct(e,t.key,t.$);for(const e of t.removedTargetIds)this.ct(e,t.key,t.$)}at(t){this.forEachTarget(t,(e=>{const n=this.ut(e);switch(t.state){case 0:this.ht(e)&&n.j(t.resumeToken);break;case 1:n.X(),n.q||n.G(),n.j(t.resumeToken);break;case 2:n.X(),n.q||this.removeTarget(e);break;case 3:this.ht(e)&&(n.Z(),n.j(t.resumeToken));break;case 4:this.ht(e)&&(this.lt(e),n.j(t.resumeToken));break;default:S()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.et.forEach(((t,n)=>{this.ht(n)&&e(n)}))}ft(t){const e=t.targetId,n=t.O.count,s=this.dt(e);if(s){const t=s.target;if(Lt(t))if(0===n){const n=new lt(t.path);this.ct(e,n,xt.newNoDocument(n,rt.min()))}else N(1===n);else this.wt(e)!==n&&(this.lt(e),this.it=this.it.add(e))}}_t(t){const e=new Map;this.et.forEach(((n,s)=>{const i=this.dt(s);if(i){if(n.current&&Lt(i.target)){const e=new lt(i.target.path);null!==this.nt.get(e)||this.gt(s,e)||this.ct(s,e,xt.newNoDocument(e,t))}n.K&&(e.set(s,n.W()),n.G())}}));let n=un();this.st.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.dt(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))}));const s=new dn(t,e,this.it,this.nt,n);return this.nt=nn(),this.st=vn(),this.it=new Ze(j),s}ot(t,e){if(!this.ht(t))return;const n=this.gt(t,e.key)?2:0;this.ut(t).H(e.key,n),this.nt=this.nt.insert(e.key,e),this.st=this.st.insert(e.key,this.yt(e.key).add(t))}ct(t,e,n){if(!this.ht(t))return;const s=this.ut(t);this.gt(t,e)?s.H(e,1):s.J(e),this.st=this.st.insert(e,this.yt(e).delete(t)),n&&(this.nt=this.nt.insert(e,n))}removeTarget(t){this.et.delete(t)}wt(t){const e=this.ut(t).W();return this.tt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Y(t){this.ut(t).Y()}ut(t){let e=this.et.get(t);return e||(e=new yn,this.et.set(t,e)),e}yt(t){let e=this.st.get(t);return e||(e=new Ze(j),this.st=this.st.insert(t,e)),e}ht(t){const e=null!==this.dt(t);return e||I("WatchChangeAggregator","Detected inactive target",t),e}dt(t){const e=this.et.get(t);return e&&e.q?null:this.tt.Tt(t)}lt(t){this.et.set(t,new yn),this.tt.getRemoteKeysForTarget(t).forEach((e=>{this.ct(t,e,null)}))}gt(t,e){return this.tt.getRemoteKeysForTarget(t).has(e)}}function vn(){return new Ye(lt.comparator)}function bn(){return new Ye(lt.comparator)}const In={asc:"ASCENDING",desc:"DESCENDING"},Tn={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class En{constructor(t,e){this.databaseId=t,this.D=e}}function _n(t,e){return t.D?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Sn(t,e){return t.D?e.toBase64():e.toUint8Array()}function Nn(t,e){return _n(t,e.toTimestamp())}function An(t){return N(!!t),rt.fromTimestamp(function(t){const e=et(t);return new $(e.seconds,e.nanos)}(t))}function Dn(t,e){return function(t){return new W(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function xn(t){const e=W.fromString(t);return N(Zn(e)),e}function kn(t,e){return Dn(t.databaseId,e.path)}function Cn(t,e){const n=xn(e);if(n.get(1)!==t.databaseId.projectId)throw new x(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new x(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new lt(Fn(n))}function On(t,e){return Dn(t.databaseId,e)}function Rn(t){const e=xn(t);return 4===e.length?W.emptyPath():Fn(e)}function Ln(t){return new W(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Fn(t){return N(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Pn(t,e,n){return{name:kn(t,e),fields:n.value.mapValue.fields}}function Mn(t,e,n){const s=Cn(t,e.name),i=An(e.updateTime),r=new At({mapValue:{fields:e.fields}}),o=xt.newFoundDocument(s,i,r);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Vn(t,e){let n;if(e instanceof Ve)n={update:Pn(t,e.key,e.value)};else if(e instanceof Ke)n={delete:kn(t,e.key)};else if(e instanceof Ue)n={update:Pn(t,e.key,e.data),updateMask:Jn(e.fieldMask)};else{if(!(e instanceof $e))return S();n={verify:kn(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof be)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ie)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ee)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Se)return{fieldPath:e.field.canonicalString(),increment:n.C};throw S()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Nn(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:S()}(t,e.precondition)),n}function Un(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?ke.updateTime(An(t.updateTime)):void 0!==t.exists?ke.exists(t.exists):ke.none()}(e.currentDocument):ke.none(),s=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)N("REQUEST_TIME"===e.setToServerValue),n=new be;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Ie(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Ee(t)}else"increment"in e?n=new Se(t,e.increment):S();const s=X.fromServerFormat(e.fieldPath);return new De(s,n)}(t,e))):[];if(e.update){e.update.name;const i=Cn(t,e.update.name),r=new At({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new dt(e.map((t=>X.fromServerFormat(t))))}(e.updateMask);return new Ue(i,r,t,n,s)}return new Ve(i,r,n,s)}if(e.delete){const s=Cn(t,e.delete);return new Ke(s,n)}if(e.verify){const s=Cn(t,e.verify);return new $e(s,n)}return S()}function qn(t,e){return{documents:[On(t,e.path)]}}function jn(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=On(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=On(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(_t(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NAN"}};if(Et(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(_t(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NOT_NAN"}};if(Et(t.value))return{unaryFilter:{field:Hn(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Hn(t.field),op:Qn(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Hn(t.field),direction:Gn(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.D||ct(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=$n(e.startAt)),e.endAt&&(n.structuredQuery.endAt=$n(e.endAt)),n}function Bn(t){let e=Rn(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){N(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=Kn(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new Gt(Wn(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let c=null;n.limit&&(c=function(t){let e;return e="object"==typeof t?t.value:t,ct(e)?null:e}(n.limit));let a=null;n.startAt&&(a=zn(n.startAt));let u=null;return n.endAt&&(u=zn(n.endAt)),Xt(e,i,o,r,c,"F",a,u)}function Kn(t){return t?void 0!==t.unaryFilter?[Xn(t)]:void 0!==t.fieldFilter?[Yn(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>Kn(t))).reduce(((t,e)=>t.concat(e))):S():[]}function $n(t){return{before:t.before,values:t.position}}function zn(t){const e=!!t.before,n=t.values||[];return new $t(n,e)}function Gn(t){return In[t]}function Qn(t){return Tn[t]}function Hn(t){return{fieldPath:t.canonicalString()}}function Wn(t){return X.fromServerFormat(t.fieldPath)}function Yn(t){return Ft.create(Wn(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(t.fieldFilter.op),t.fieldFilter.value)}function Xn(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Wn(t.unaryFilter.field);return Ft.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Wn(t.unaryFilter.field);return Ft.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Wn(t.unaryFilter.field);return Ft.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Wn(t.unaryFilter.field);return Ft.create(i,"!=",{nullValue:"NULL_VALUE"});default:return S()}}function Jn(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Zn(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function er(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=rr(e)),e=nr(t.get(n),e);return rr(e)}function nr(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function rr(t){return t+""}function sr(t){const e=t.length;if(N(e>=2),2===e)return N(""===t.charAt(0)&&""===t.charAt(1)),W.emptyPath();const n=e-2,s=[];let i="";for(let r=0;r<e;){const e=t.indexOf("",r);switch((e<0||e>n)&&S(),t.charAt(e+1)){case"":const n=t.substring(r,e);let o;0===i.length?o=n:(i+=n,o=i,i=""),s.push(o);break;case"":i+=t.substring(r,e),i+="\0";break;case"":i+=t.substring(r,e+1);break;default:S()}r=e+2}return new W(s)}class ir{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class or{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}or.store="owner",or.key="owner";class ar{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}ar.store="mutationQueues",ar.keyPath="userId";class cr{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}cr.store="mutations",cr.keyPath="batchId",cr.userMutationsIndex="userMutationsIndex",cr.userMutationsKeyPath=["userId","batchId"];class ur{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,er(e)]}static key(t,e,n){return[t,er(e),n]}}ur.store="documentMutations",ur.PLACEHOLDER=new ur;class lr{constructor(t,e){this.path=t,this.readTime=e}}class dr{constructor(t,e){this.path=t,this.version=e}}class fr{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}fr.store="remoteDocuments",fr.readTimeIndex="readTimeIndex",fr.readTimeIndexPath="readTime",fr.collectionReadTimeIndex="collectionReadTimeIndex",fr.collectionReadTimeIndexPath=["parentPath","readTime"];class gr{constructor(t){this.byteSize=t}}gr.store="remoteDocumentGlobal",gr.key="remoteDocumentGlobalKey";class mr{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}mr.store="targets",mr.keyPath="targetId",mr.queryTargetsIndexName="queryTargetsIndex",mr.queryTargetsKeyPath=["canonicalId","targetId"];class pr{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}pr.store="targetDocuments",pr.keyPath=["targetId","path"],pr.documentTargetsIndex="documentTargetsIndex",pr.documentTargetsKeyPath=["path","targetId"];class yr{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}yr.key="targetGlobalKey",yr.store="targetGlobal";class wr{constructor(t,e){this.collectionId=t,this.parent=e}}wr.store="collectionParents",wr.keyPath=["collectionId","parent"];class vr{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}vr.store="clientMetadata",vr.keyPath="clientId";class Ir{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}Ir.store="bundles",Ir.keyPath="bundleId";class Tr{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}Tr.store="namedQueries",Tr.keyPath="name";const Er=[ar.store,cr.store,ur.store,fr.store,mr.store,or.store,yr.store,pr.store,vr.store,gr.store,wr.store,Ir.store,Tr.store],_r="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Sr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}class Nr{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Nr(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Nr?e:Nr.resolve(e)}catch(t){return Nr.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Nr.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Nr.reject(e)}static resolve(t){return new Nr(((e,n)=>{e(t)}))}static reject(t){return new Nr(((e,n)=>{n(t)}))}static waitFor(t){return new Nr(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=Nr.resolve(!1);for(const n of t)e=e.next((t=>t?Nr.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}}class Ar{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.Et=new k,this.transaction.oncomplete=()=>{this.Et.resolve()},this.transaction.onabort=()=>{e.error?this.Et.reject(new kr(t,e.error)):this.Et.resolve()},this.transaction.onerror=e=>{const n=Fr(e.target.error);this.Et.reject(new kr(t,n))}}static open(t,e,n,s){try{return new Ar(e,t.transaction(s,n))}catch(t){throw new kr(e,t)}}get It(){return this.Et.promise}abort(t){t&&this.Et.reject(t),this.aborted||(I("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new Or(e)}}class Dr{constructor(t,e,n){this.name=t,this.version=e,this.At=n,12.2===Dr.Rt(Object(h.l)())&&T("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return I("SimpleDb","Removing database:",t),Rr(window.indexedDB.deleteDatabase(t)).toPromise()}static bt(){if(!Object(h.r)())return!1;if(Dr.Pt())return!0;const t=Object(h.l)(),e=Dr.Rt(t),n=0<e&&e<10,s=Dr.vt(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static Pt(){var e;return void 0!==t&&"YES"===(null===(e=t.env)||void 0===e?void 0:e.Vt)}static St(t,e){return t.store(e)}static Rt(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static vt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Dt(t){return this.db||(I("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=t=>{const n=t.target.result;e(n)},s.onblocked=()=>{n(new kr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{const s=e.target.error;"VersionError"===s.name?n(new x(D.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new x(D.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new kr(t,s))},s.onupgradeneeded=t=>{I("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.At.Ct(e,s.transaction,t.oldVersion,this.version).next((()=>{I("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Nt&&(this.db.onversionchange=t=>this.Nt(t)),this.db}xt(t){this.Nt=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const i="readonly"===e;let r=0;for(;;){++r;try{this.db=await this.Dt(t);const e=Ar.open(this.db,t,i?"readonly":"readwrite",n),r=s(e).catch((t=>(e.abort(t),Nr.reject(t)))).toPromise();return r.catch((()=>{})),await e.It,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(I("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class xr{constructor(t){this.kt=t,this.$t=!1,this.Ot=null}get isDone(){return this.$t}get Ft(){return this.Ot}set cursor(t){this.kt=t}done(){this.$t=!0}Mt(t){this.Ot=t}delete(){return Rr(this.kt.delete())}}class kr extends x{constructor(t,e){super(D.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Cr(t){return"IndexedDbTransactionError"===t.name}class Or{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(I("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Rr(n)}add(t){return I("SimpleDb","ADD",this.store.name,t,t),Rr(this.store.add(t))}get(t){return Rr(this.store.get(t)).next((e=>(void 0===e&&(e=null),I("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return I("SimpleDb","DELETE",this.store.name,t),Rr(this.store.delete(t))}count(){return I("SimpleDb","COUNT",this.store.name),Rr(this.store.count())}Lt(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.Bt(n,((t,e)=>{s.push(e)})).next((()=>s))}Ut(t,e){I("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.qt=!1;const s=this.cursor(n);return this.Bt(s,((t,e,n)=>n.delete()))}Kt(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.Bt(s,e)}jt(t){const e=this.cursor({});return new Nr(((n,s)=>{e.onerror=t=>{const e=Fr(t.target.error);s(e)},e.onsuccess=e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next((t=>{t?s.continue():n()})):n()}}))}Bt(t,e){const n=[];return new Nr(((s,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void s();const r=new xr(i),o=e(i.primaryKey,i.value,r);if(o instanceof Nr){const t=o.catch((t=>(r.done(),Nr.reject(t))));n.push(t)}r.isDone?s():null===r.Ft?i.continue():i.continue(r.Ft)}})).next((()=>Nr.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.qt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Rr(t){return new Nr(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Fr(t.target.error);n(e)}}))}let Lr=!1;function Fr(t){const e=Dr.Rt(Object(h.l)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Lr||(Lr=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Pr extends Sr{constructor(t,e){super(),this.Qt=t,this.currentSequenceNumber=e}}function Mr(t,e){const n=q(t);return Dr.St(n.Qt,e)}class Vr{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&Re(s,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&Le(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&Le(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),s=n;this.applyToLocalView(s),n.isValidDocument()||s.convertToNoDocument(rt.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),un())}isEqual(t){return this.batchId===t.batchId&&B(this.mutations,t.mutations,((t,e)=>Pe(t,e)))&&B(this.baseMutations,t.baseMutations,((t,e)=>Pe(t,e)))}}class Ur{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){N(t.mutations.length===n.length);let s=an();const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new Ur(t,e,n,s)}}class qr{constructor(t,e,n,s,i=rt.min(),r=rt.min(),o=Z.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}withSequenceNumber(t){return new qr(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new qr(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new qr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class jr{constructor(t){this.Wt=t}}function Br(t,e){if(e.document)return Mn(t.Wt,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=lt.fromSegments(e.noDocument.path),n=li(e.noDocument.readTime),s=xt.newNoDocument(t,n);return e.hasCommittedMutations?s.setHasCommittedMutations():s}if(e.unknownDocument){const t=lt.fromSegments(e.unknownDocument.path),n=li(e.unknownDocument.version);return xt.newUnknownDocument(t,n)}return S()}function Kr(t,e,n){const s=$r(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){const n=function(t,e){return{name:kn(t,e.key),fields:e.data.value.mapValue.fields,updateTime:_n(t,e.version.toTimestamp())}}(t.Wt,e),r=e.hasCommittedMutations;return new fr(null,null,n,r,s,i)}if(e.isNoDocument()){const t=e.key.path.toArray(),n=Gr(e.version),r=e.hasCommittedMutations;return new fr(null,new lr(t,n),null,r,s,i)}if(e.isUnknownDocument()){const t=e.key.path.toArray(),n=Gr(e.version);return new fr(new dr(t,n),null,null,!0,s,i)}return S()}function $r(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function zr(t){const e=new $(t[0],t[1]);return rt.fromTimestamp(e)}function Gr(t){const e=t.toTimestamp();return new ir(e.seconds,e.nanoseconds)}function li(t){const e=new $(t.seconds,t.nanoseconds);return rt.fromTimestamp(e)}function Qr(t,e){const n=(e.baseMutations||[]).map((e=>Un(t.Wt,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const s=e.mutations[t+1];n.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const s=e.mutations.map((e=>Un(t.Wt,e))),i=$.fromMillis(e.localWriteTimeMs);return new Vr(e.batchId,i,n,s)}function Hr(t){const e=li(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?li(t.lastLimboFreeSnapshotVersion):rt.min();let s;var i;return void 0!==t.query.documents?(N(1===(i=t.query).documents.length),s=ie(Jt(Rn(i.documents[0])))):s=function(t){return ie(Bn(t))}(t.query),new qr(s,t.targetId,0,t.lastListenSequenceNumber,e,n,Z.fromBase64String(t.resumeToken))}function Wr(t,e){const n=Gr(e.snapshotVersion),s=Gr(e.lastLimboFreeSnapshotVersion);let i;i=Lt(e.target)?qn(t.Wt,e.target):jn(t.Wt,e.target);const r=e.resumeToken.toBase64();return new mr(e.targetId,Ot(e.target),n,r,e.sequenceNumber,s,i)}function Yr(t){const e=Bn({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?oe(e,e.limit,"L"):e}class Xr{getBundleMetadata(t,e){return Jr(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:li(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return Jr(t).put({bundleId:(n=e).id,createTime:Gr(An(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return Zr(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:Yr(e.bundledQuery),readTime:li(e.readTime)};var e}))}saveNamedQuery(t,e){return Zr(t).put(function(t){return{name:t.name,readTime:Gr(An(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function Jr(t){return Mr(t,Ir.store)}function Zr(t){return Mr(t,Tr.store)}class ts{constructor(){this.Gt=new es}addToCollectionParentIndex(t,e){return this.Gt.add(e),Nr.resolve()}getCollectionParents(t,e){return Nr.resolve(this.Gt.getEntries(e))}}class es{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new Ze(W.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new Ze(W.comparator)).toArray()}}class ns{constructor(){this.zt=new es}addToCollectionParentIndex(t,e){if(!this.zt.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.zt.add(e)}));const i={collectionId:n,parent:er(s)};return rs(t).put(i)}return Nr.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[K(e),""],!1,!0);return rs(t).Lt(s).next((t=>{for(const s of t){if(s.collectionId!==e)break;n.push(sr(s.parent))}return n}))}}function rs(t){return Mr(t,wr.store)}const ss={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class is{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new is(t,is.DEFAULT_COLLECTION_PERCENTILE,is.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function os(t,e,n){const s=t.store(cr.store),i=t.store(ur.store),r=[],o=IDBKeyRange.only(n.batchId);let c=0;const a=s.Kt({range:o},((t,e,n)=>(c++,n.delete())));r.push(a.next((()=>{N(1===c)})));const u=[];for(const t of n.mutations){const s=ur.key(e,t.key.path,n.batchId);r.push(i.delete(s)),u.push(t.key)}return Nr.waitFor(r).next((()=>u))}function as(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw S();e=t.noDocument}return JSON.stringify(e).length}is.DEFAULT_COLLECTION_PERCENTILE=10,is.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,is.DEFAULT=new is(41943040,is.DEFAULT_COLLECTION_PERCENTILE,is.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),is.DISABLED=new is(-1,0,0);class cs{constructor(t,e,n,s){this.userId=t,this.N=e,this.Ht=n,this.referenceDelegate=s,this.Jt={}}static Yt(t,e,n,s){N(""!==t.uid);const i=t.isAuthenticated()?t.uid:"";return new cs(i,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return hs(t).Kt({index:cr.userMutationsIndex,range:n},((t,n,s)=>{e=!1,s.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const i=ls(t),r=hs(t);return r.add({}).next((o=>{N("number"==typeof o);const c=new Vr(o,e,n,s),a=function(t,e,n){const s=n.baseMutations.map((e=>Vn(t.Wt,e))),i=n.mutations.map((e=>Vn(t.Wt,e)));return new cr(e,n.batchId,n.localWriteTime.toMillis(),s,i)}(this.N,this.userId,c),u=[];let h=new Ze(((t,e)=>j(t.canonicalString(),e.canonicalString())));for(const t of s){const e=ur.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(r.put(a)),u.push(i.put(e,ur.PLACEHOLDER))}return h.forEach((e=>{u.push(this.Ht.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Jt[o]=c.keys()})),Nr.waitFor(u).next((()=>c))}))}lookupMutationBatch(t,e){return hs(t).get(e).next((t=>t?(N(t.userId===this.userId),Qr(this.N,t)):null))}Xt(t,e){return this.Jt[e]?Nr.resolve(this.Jt[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Jt[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return hs(t).Kt({index:cr.userMutationsIndex,range:s},((t,e,s)=>{e.userId===this.userId&&(N(e.batchId>=n),i=Qr(this.N,e)),s.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return hs(t).Kt({index:cr.userMutationsIndex,range:e,reverse:!0},((t,e,s)=>{n=e.batchId,s.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return hs(t).Lt(cr.userMutationsIndex,e).next((t=>t.map((t=>Qr(this.N,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=ur.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return ls(t).Kt({range:s},((n,s,r)=>{const[o,c,a]=n,u=sr(c);if(o===this.userId&&e.path.isEqual(u))return hs(t).get(a).next((t=>{if(!t)throw S();N(t.userId===this.userId),i.push(Qr(this.N,t))}));r.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ze(j);const s=[];return e.forEach((e=>{const i=ur.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=ls(t).Kt({range:r},((t,s,i)=>{const[r,o,c]=t,a=sr(o);r===this.userId&&e.path.isEqual(a)?n=n.add(c):i.done()}));s.push(o)})),Nr.waitFor(s).next((()=>this.Zt(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,i=ur.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new Ze(j);return ls(t).Kt({range:r},((t,e,i)=>{const[r,c,a]=t,u=sr(c);r===this.userId&&n.isPrefixOf(u)?u.length===s&&(o=o.add(a)):i.done()})).next((()=>this.Zt(t,o)))}Zt(t,e){const n=[],s=[];return e.forEach((e=>{s.push(hs(t).get(e).next((t=>{if(null===t)throw S();N(t.userId===this.userId),n.push(Qr(this.N,t))})))})),Nr.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return os(t.Qt,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.te(e.batchId)})),Nr.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}te(t){delete this.Jt[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return Nr.resolve();const n=IDBKeyRange.lowerBound(ur.prefixForUser(this.userId)),s=[];return ls(t).Kt({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=sr(t[1]);s.push(e)}else n.done()})).next((()=>{N(0===s.length)}))}))}containsKey(t,e){return us(t,this.userId,e)}ee(t){return ds(t).get(this.userId).next((t=>t||new ar(this.userId,-1,"")))}}function us(t,e,n){const s=ur.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return ls(t).Kt({range:r,qt:!0},((t,n,s)=>{const[r,c,a]=t;r===e&&c===i&&(o=!0),s.done()})).next((()=>o))}function hs(t){return Mr(t,cr.store)}function ls(t){return Mr(t,ur.store)}function ds(t){return Mr(t,ar.store)}class fs{constructor(t){this.ne=t}next(){return this.ne+=2,this.ne}static se(){return new fs(0)}static ie(){return new fs(-1)}}class gs{constructor(t,e){this.referenceDelegate=t,this.N=e}allocateTargetId(t){return this.re(t).next((e=>{const n=new fs(e.highestTargetId);return e.highestTargetId=n.next(),this.oe(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.re(t).next((t=>rt.fromTimestamp(new $(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.re(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.re(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.oe(t,s))))}addTargetData(t,e){return this.ce(t,e).next((()=>this.re(t).next((n=>(n.targetCount+=1,this.ae(e,n),this.oe(t,n))))))}updateTargetData(t,e){return this.ce(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>ms(t).delete(e.targetId))).next((()=>this.re(t))).next((e=>(N(e.targetCount>0),e.targetCount-=1,this.oe(t,e))))}removeTargets(t,e,n){let s=0;const i=[];return ms(t).Kt(((r,o)=>{const c=Hr(o);c.sequenceNumber<=e&&null===n.get(c.targetId)&&(s++,i.push(this.removeTargetData(t,c)))})).next((()=>Nr.waitFor(i))).next((()=>s))}forEachTarget(t,e){return ms(t).Kt(((t,n)=>{const s=Hr(n);e(s)}))}re(t){return ps(t).get(yr.key).next((t=>(N(null!==t),t)))}oe(t,e){return ps(t).put(yr.key,e)}ce(t,e){return ms(t).put(Wr(this.N,e))}ae(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.re(t).next((t=>t.targetCount))}getTargetData(t,e){const n=Ot(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return ms(t).Kt({range:s,index:mr.queryTargetsIndexName},((t,n,s)=>{const r=Hr(n);Rt(e,r.target)&&(i=r,s.done())})).next((()=>i))}addMatchingKeys(t,e,n){const s=[],i=ys(t);return e.forEach((e=>{const r=er(e.path);s.push(i.put(new pr(n,r))),s.push(this.referenceDelegate.addReference(t,n,e))})),Nr.waitFor(s)}removeMatchingKeys(t,e,n){const s=ys(t);return Nr.forEach(e,(e=>{const i=er(e.path);return Nr.waitFor([s.delete([n,i]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=ys(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=ys(t);let i=un();return s.Kt({range:n,qt:!0},((t,e,n)=>{const s=sr(t[1]),r=new lt(s);i=i.add(r)})).next((()=>i))}containsKey(t,e){const n=er(e.path),s=IDBKeyRange.bound([n],[K(n)],!1,!0);let i=0;return ys(t).Kt({index:pr.documentTargetsIndex,qt:!0,range:s},(([t,e],n,s)=>{0!==t&&(i++,s.done())})).next((()=>i>0))}Tt(t,e){return ms(t).get(e).next((t=>t?Hr(t):null))}}function ms(t){return Mr(t,mr.store)}function ps(t){return Mr(t,yr.store)}function ys(t){return Mr(t,pr.store)}async function ws(t){if(t.code!==D.FAILED_PRECONDITION||t.message!==_r)throw t;I("LocalStore","Unexpectedly lost primary lease")}function vs([t,e],[n,s]){const i=j(t,n);return 0===i?j(e,s):i}class bs{constructor(t){this.ue=t,this.buffer=new Ze(vs),this.he=0}le(){return++this.he}fe(t){const e=[t,this.le()];if(this.buffer.size<this.ue)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();vs(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Is{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.de=!1,this.we=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this._e(t)}stop(){this.we&&(this.we.cancel(),this.we=null)}get started(){return null!==this.we}_e(t){const e=this.de?3e5:6e4;I("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.we=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.we=null,this.de=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){Cr(t)?I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await ws(t)}await this._e(t)}))}}class Ts{constructor(t,e){this.me=t,this.params=e}calculateTargetCount(t,e){return this.me.ge(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Nr.resolve(M.T);const n=new bs(e);return this.me.forEachTarget(t,(t=>n.fe(t.sequenceNumber))).next((()=>this.me.ye(t,(t=>n.fe(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.me.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.me.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector","Garbage collection skipped; disabled"),Nr.resolve(ss)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ss):this.pe(t,e)))}getCacheSize(t){return this.me.getCacheSize(t)}pe(t,e){let n,s,i,r,o,a,u;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s=this.params.maximumSequenceNumbersToCollect):s=e,r=Date.now(),this.nthSequenceNumber(t,s)))).next((s=>(n=s,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(u=Date.now(),w()<=c.a.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-h}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-h}ms`),Nr.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:t}))))}}class Es{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new Ts(t,e)}(this,e)}ge(t){const e=this.Te(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}Te(t){let e=0;return this.ye(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}ye(t,e){return this.Ee(t,((t,n)=>e(n)))}addReference(t,e,n){return _s(t,n)}removeReference(t,e,n){return _s(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return _s(t,e)}Ie(t,e){return function(t,e){let n=!1;return ds(t).jt((s=>us(t,s,e).next((t=>(t&&(n=!0),Nr.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Ee(t,((r,o)=>{if(o<=e){const e=this.Ie(t,r).next((e=>{if(!e)return i++,n.getEntry(t,r).next((()=>(n.removeEntry(r),ys(t).delete([0,er(r.path)]))))}));s.push(e)}})).next((()=>Nr.waitFor(s))).next((()=>n.apply(t))).next((()=>i))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return _s(t,e)}Ee(t,e){const n=ys(t);let s,i=M.T;return n.Kt({index:pr.documentTargetsIndex},(([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==M.T&&e(new lt(sr(s)),i),i=o,s=r):i=M.T})).next((()=>{i!==M.T&&e(new lt(sr(s)),i)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function _s(t,e){return ys(t).put(function(t,e){return new pr(0,er(t.path),e)}(e,t.currentSequenceNumber))}class Ss{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),!0;return!1}forEach(t){G(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return Q(this.inner)}}class Ns{constructor(){this.changes=new Ss((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}getReadTime(t){const e=this.changes.get(t);return e?e.readTime:rt.min()}addEntry(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})}removeEntry(t,e=null){this.assertNotApplied(),this.changes.set(t,{document:xt.newInvalidDocument(t),readTime:e})}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Nr.resolve(n.document):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class As{constructor(t,e){this.N=t,this.Ht=e}addEntry(t,e,n){return ks(t).put(Cs(e),n)}removeEntry(t,e){const n=ks(t),s=Cs(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.Ae(t,n))))}getEntry(t,e){return ks(t).get(Cs(e)).next((t=>this.Re(e,t)))}be(t,e){return ks(t).get(Cs(e)).next((t=>({document:this.Re(e,t),size:as(t)})))}getEntries(t,e){let n=nn();return this.Pe(t,e,((t,e)=>{const s=this.Re(t,e);n=n.insert(t,s)})).next((()=>n))}ve(t,e){let n=nn(),s=new Ye(lt.comparator);return this.Pe(t,e,((t,e)=>{const i=this.Re(t,e);n=n.insert(t,i),s=s.insert(t,as(e))})).next((()=>({documents:n,Ve:s})))}Pe(t,e,n){if(e.isEmpty())return Nr.resolve();const s=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator();let r=i.getNext();return ks(t).Kt({range:s},((t,e,s)=>{const o=lt.fromSegments(t);for(;r&&lt.comparator(r,o)<0;)n(r,null),r=i.getNext();r&&r.isEqual(o)&&(n(r,e),r=i.hasNext()?i.getNext():null),r?s.Mt(r.path.toArray()):s.done()})).next((()=>{for(;r;)n(r,null),r=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(t,e,n){let s=nn();const i=e.path.length+1,r={};if(n.isEqual(rt.min())){const t=e.path.toArray();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.toArray(),s=$r(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=fr.collectionReadTimeIndex}return ks(t).Kt(r,((t,n,r)=>{if(t.length!==i)return;const o=Br(this.N,n);e.path.isPrefixOf(o.key.path)?he(e,o)&&(s=s.insert(o.key,o)):r.done()})).next((()=>s))}newChangeBuffer(t){return new Ds(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return xs(t).get(gr.key).next((t=>(N(!!t),t)))}Ae(t,e){return xs(t).put(gr.key,e)}Re(t,e){if(e){const t=Br(this.N,e);if(!t.isNoDocument()||!t.version.isEqual(rt.min()))return t}return xt.newInvalidDocument(t)}}class Ds extends Ns{constructor(t,e){super(),this.Se=t,this.trackRemovals=e,this.De=new Ss((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,s=new Ze(((t,e)=>j(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((i,r)=>{const o=this.De.get(i);if(r.document.isValidDocument()){const c=Kr(this.Se.N,r.document,this.getReadTime(i));s=s.add(i.path.popLast());const a=as(c);n+=a-o,e.push(this.Se.addEntry(t,i,c))}else if(n-=o,this.trackRemovals){const n=Kr(this.Se.N,xt.newNoDocument(i,rt.min()),this.getReadTime(i));e.push(this.Se.addEntry(t,i,n))}else e.push(this.Se.removeEntry(t,i))})),s.forEach((n=>{e.push(this.Se.Ht.addToCollectionParentIndex(t,n))})),e.push(this.Se.updateMetadata(t,n)),Nr.waitFor(e)}getFromCache(t,e){return this.Se.be(t,e).next((t=>(this.De.set(e,t.size),t.document)))}getAllFromCache(t,e){return this.Se.ve(t,e).next((({documents:t,Ve:e})=>(e.forEach(((t,e)=>{this.De.set(t,e)})),t)))}}function xs(t){return Mr(t,gr.store)}function ks(t){return Mr(t,fr.store)}function Cs(t){return t.path.toArray()}class Os{constructor(t){this.N=t}Ct(t,e,n,s){N(n<s&&n>=0&&s<=11);const i=new Ar("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore(or.store)}(t),function(t){t.createObjectStore(ar.store,{keyPath:ar.keyPath}),t.createObjectStore(cr.store,{keyPath:cr.keyPath,autoIncrement:!0}).createIndex(cr.userMutationsIndex,cr.userMutationsKeyPath,{unique:!0}),t.createObjectStore(ur.store)}(t),Rs(t),function(t){t.createObjectStore(fr.store)}(t));let r=Nr.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(pr.store),t.deleteObjectStore(mr.store),t.deleteObjectStore(yr.store)}(t),Rs(t)),r=r.next((()=>function(t){const e=t.store(yr.store),n=new yr(0,0,rt.min().toTimestamp(),0);return e.put(yr.key,n)}(i)))),n<4&&s>=4&&(0!==n&&(r=r.next((()=>function(t,e){return e.store(cr.store).Lt().next((n=>{t.deleteObjectStore(cr.store),t.createObjectStore(cr.store,{keyPath:cr.keyPath,autoIncrement:!0}).createIndex(cr.userMutationsIndex,cr.userMutationsKeyPath,{unique:!0});const s=e.store(cr.store),i=n.map((t=>s.put(t)));return Nr.waitFor(i)}))}(t,i)))),r=r.next((()=>{!function(t){t.createObjectStore(vr.store,{keyPath:vr.keyPath})}(t)}))),n<5&&s>=5&&(r=r.next((()=>this.Ce(i)))),n<6&&s>=6&&(r=r.next((()=>(function(t){t.createObjectStore(gr.store)}(t),this.Ne(i))))),n<7&&s>=7&&(r=r.next((()=>this.xe(i)))),n<8&&s>=8&&(r=r.next((()=>this.ke(t,i)))),n<9&&s>=9&&(r=r.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(fr.store);e.createIndex(fr.readTimeIndex,fr.readTimeIndexPath,{unique:!1}),e.createIndex(fr.collectionReadTimeIndex,fr.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&s>=10&&(r=r.next((()=>this.$e(i)))),n<11&&s>=11&&(r=r.next((()=>{!function(t){t.createObjectStore(Ir.store,{keyPath:Ir.keyPath})}(t),function(t){t.createObjectStore(Tr.store,{keyPath:Tr.keyPath})}(t)}))),r}Ne(t){let e=0;return t.store(fr.store).Kt(((t,n)=>{e+=as(n)})).next((()=>{const n=new gr(e);return t.store(gr.store).put(gr.key,n)}))}Ce(t){const e=t.store(ar.store),n=t.store(cr.store);return e.Lt().next((e=>Nr.forEach(e,(e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.Lt(cr.userMutationsIndex,s).next((n=>Nr.forEach(n,(n=>{N(n.userId===e.userId);const s=Qr(this.N,n);return os(t,e.userId,s).next((()=>{}))}))))}))))}xe(t){const e=t.store(pr.store),n=t.store(fr.store);return t.store(yr.store).get(yr.key).next((t=>{const s=[];return n.Kt(((n,i)=>{const r=new W(n),o=function(t){return[0,er(t)]}(r);s.push(e.get(o).next((n=>n?Nr.resolve():(n=>e.put(new pr(0,er(n),t.highestListenSequenceNumber)))(r))))})).next((()=>Nr.waitFor(s)))}))}ke(t,e){t.createObjectStore(wr.store,{keyPath:wr.keyPath});const n=e.store(wr.store),s=new es,i=t=>{if(s.add(t)){const e=t.lastSegment(),s=t.popLast();return n.put({collectionId:e,parent:er(s)})}};return e.store(fr.store).Kt({qt:!0},((t,e)=>{const n=new W(t);return i(n.popLast())})).next((()=>e.store(ur.store).Kt({qt:!0},(([t,e,n],s)=>{const r=sr(e);return i(r.popLast())}))))}$e(t){const e=t.store(mr.store);return e.Kt(((t,n)=>{const s=Hr(n),i=Wr(this.N,s);return e.put(i)}))}}function Rs(t){t.createObjectStore(pr.store,{keyPath:pr.keyPath}).createIndex(pr.documentTargetsIndex,pr.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(mr.store,{keyPath:mr.keyPath}).createIndex(mr.queryTargetsIndexName,mr.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(yr.store)}const Ls="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class tr{constructor(t,e,n,s,i,r,o,c,a,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Oe=i,this.window=r,this.document=o,this.Fe=a,this.Me=u,this.Le=null,this.Be=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ue=null,this.inForeground=!1,this.qe=null,this.Ke=null,this.je=Number.NEGATIVE_INFINITY,this.Qe=t=>Promise.resolve(),!tr.bt())throw new x(D.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Es(this,s),this.We=e+"main",this.N=new jr(c),this.Ge=new Dr(this.We,11,new Os(this.N)),this.ze=new gs(this.referenceDelegate,this.N),this.Ht=new ns,this.He=function(t,e){return new As(t,e)}(this.N,this.Ht),this.Je=new Xr,this.window&&this.window.localStorage?this.Ye=this.window.localStorage:(this.Ye=null,!1===u&&T("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Xe().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(D.FAILED_PRECONDITION,Ls);return this.Ze(),this.tn(),this.en(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.ze.getHighestSequenceNumber(t)))})).then((t=>{this.Le=new M(t,this.Fe)})).then((()=>{this.Be=!0})).catch((t=>(this.Ge&&this.Ge.close(),Promise.reject(t))))}nn(t){return this.Qe=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ge.xt((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Oe.enqueueAndForget((async()=>{this.started&&await this.Xe()})))}Xe(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>Ps(t).put(new vr(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.sn(t).next((t=>{t||(this.isPrimary=!1,this.Oe.enqueueRetryable((()=>this.Qe(!1))))}))})).next((()=>this.rn(t))).next((e=>this.isPrimary&&!e?this.on(t).next((()=>!1)):!!e&&this.cn(t).next((()=>!0)))))).catch((t=>{if(Cr(t))return I("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Oe.enqueueRetryable((()=>this.Qe(t))),this.isPrimary=t}))}sn(t){return Fs(t).get(or.key).next((t=>Nr.resolve(this.an(t))))}un(t){return Ps(t).delete(this.clientId)}async hn(){if(this.isPrimary&&!this.ln(this.je,18e5)){this.je=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=Mr(t,vr.store);return e.Lt().next((t=>{const n=this.fn(t,18e5),s=t.filter((t=>-1===n.indexOf(t)));return Nr.forEach(s,(t=>e.delete(t.clientId))).next((()=>s))}))})).catch((()=>[]));if(this.Ye)for(const e of t)this.Ye.removeItem(this.dn(e.clientId))}}en(){this.Ke=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Xe().then((()=>this.hn())).then((()=>this.en()))))}an(t){return!!t&&t.ownerId===this.clientId}rn(t){return this.Me?Nr.resolve(!0):Fs(t).get(or.key).next((e=>{if(null!==e&&this.ln(e.leaseTimestampMs,5e3)&&!this.wn(e.ownerId)){if(this.an(e)&&this.networkEnabled)return!0;if(!this.an(e)){if(!e.allowTabSynchronization)throw new x(D.FAILED_PRECONDITION,Ls);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ps(t).Lt().next((t=>void 0===this.fn(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&I("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.Be=!1,this._n(),this.Ke&&(this.Ke.cancel(),this.Ke=null),this.mn(),this.gn(),await this.Ge.runTransaction("shutdown","readwrite",[or.store,vr.store],(t=>{const e=new Pr(t,M.T);return this.on(e).next((()=>this.un(e)))})),this.Ge.close(),this.yn()}fn(t,e){return t.filter((t=>this.ln(t.updateTimeMs,e)&&!this.wn(t.clientId)))}pn(){return this.runTransaction("getActiveClients","readonly",(t=>Ps(t).Lt().next((t=>this.fn(t,18e5).map((t=>t.clientId))))))}get started(){return this.Be}getMutationQueue(t){return cs.Yt(t,this.N,this.Ht,this.referenceDelegate)}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getIndexManager(){return this.Ht}getBundleCache(){return this.Je}runTransaction(t,e,n){I("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let i;return this.Ge.runTransaction(t,s,Er,(s=>(i=new Pr(s,this.Le?this.Le.next():M.T),"readwrite-primary"===e?this.sn(i).next((t=>!!t||this.rn(i))).next((e=>{if(!e)throw T(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Oe.enqueueRetryable((()=>this.Qe(!1))),new x(D.FAILED_PRECONDITION,_r);return n(i)})).next((t=>this.cn(i).next((()=>t)))):this.Tn(i).next((()=>n(i)))))).then((t=>(i.raiseOnCommittedEvent(),t)))}Tn(t){return Fs(t).get(or.key).next((t=>{if(null!==t&&this.ln(t.leaseTimestampMs,5e3)&&!this.wn(t.ownerId)&&!this.an(t)&&!(this.Me||this.allowTabSynchronization&&t.allowTabSynchronization))throw new x(D.FAILED_PRECONDITION,Ls)}))}cn(t){const e=new or(this.clientId,this.allowTabSynchronization,Date.now());return Fs(t).put(or.key,e)}static bt(){return Dr.bt()}on(t){const e=Fs(t);return e.get(or.key).next((t=>this.an(t)?(I("IndexedDbPersistence","Releasing primary lease."),e.delete(or.key)):Nr.resolve()))}ln(t,e){const n=Date.now();return!(t<n-e||t>n&&(T(`Detected an update time that is in the future: ${t} > ${n}`),1))}Ze(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=()=>{this.Oe.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Xe())))},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)}mn(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)}tn(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ue=()=>{this._n(),Object(h.v)()&&navigator.appVersion.match("Version/14")&&this.Oe.enterRestrictedMode(!0),this.Oe.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Ue))}gn(){this.Ue&&(this.window.removeEventListener("pagehide",this.Ue),this.Ue=null)}wn(t){var e;try{const n=null!==(null===(e=this.Ye)||void 0===e?void 0:e.getItem(this.dn(t)));return I("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return T("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}_n(){if(this.Ye)try{this.Ye.setItem(this.dn(this.clientId),String(Date.now()))}catch(t){T("Failed to set zombie client id.",t)}}yn(){if(this.Ye)try{this.Ye.removeItem(this.dn(this.clientId))}catch(t){}}dn(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Fs(t){return Mr(t,or.store)}function Ps(t){return Mr(t,vr.store)}function Ms(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class Vs{constructor(t,e){this.progress=t,this.En=e}}class Us{constructor(t,e,n){this.He=t,this.In=e,this.Ht=n}An(t,e){return this.In.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.Rn(t,e,n)))}Rn(t,e,n){return this.He.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}bn(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}Pn(t,e){return this.He.getEntries(t,e).next((e=>this.vn(t,e).next((()=>e))))}vn(t,e){return this.In.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.bn(e,t)))}getDocumentsMatchingQuery(t,e,n){return function(t){return lt.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Vn(t,e.path):re(e)?this.Sn(t,e,n):this.Dn(t,e,n)}Vn(t,e){return this.An(t,new lt(e)).next((t=>{let e=sn();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}Sn(t,e,n){const s=e.collectionGroup;let i=sn();return this.Ht.getCollectionParents(t,s).next((r=>Nr.forEach(r,(r=>{const o=function(t,e){return new Yt(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.Dn(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}Dn(t,e,n){let s,i;return this.He.getDocumentsMatchingQuery(t,e,n).next((n=>(s=n,this.In.getAllMutationBatchesAffectingQuery(t,e)))).next((e=>(i=e,this.Cn(t,i,s).next((t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key;let i=s.get(n);null==i&&(i=xt.newInvalidDocument(n),s=s.insert(n,i)),Le(e,i,t.localWriteTime),i.isFoundDocument()||(s=s.remove(n))}}))))).next((()=>(s.forEach(((t,n)=>{he(e,n)||(s=s.remove(t))})),s)))}Cn(t,e,n){let s=un();for(const t of e)for(const e of t.mutations)e instanceof Ue&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this.He.getEntries(t,s).next((t=>(t.forEach(((t,e)=>{e.isFoundDocument()&&(i=i.insert(t,e))})),i)))}}class qs{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Nn=n,this.xn=s}static kn(t,e){let n=un(),s=un();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new qs(t,e.fromCache,n,s)}}class js{$n(t){this.On=t}getDocumentsMatchingQuery(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(rt.min())?this.Fn(t,e):this.On.Pn(t,s).next((i=>{const r=this.Mn(e,i);return(Zt(e)||te(e))&&this.Ln(e.limitType,r,s,n)?this.Fn(t,e):(w()<=c.a.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),ue(e)),this.On.getDocumentsMatchingQuery(t,e,n).next((t=>(r.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}Mn(t,e){let n=new Ze(le(t));return e.forEach(((e,s)=>{he(t,s)&&(n=n.add(s))})),n}Ln(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Fn(t,e){return w()<=c.a.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",ue(e)),this.On.getDocumentsMatchingQuery(t,e,rt.min())}}class Bs{constructor(t,e,n,s){this.persistence=t,this.Bn=e,this.N=s,this.Un=new Ye(j),this.qn=new Ss((t=>Ot(t)),Rt),this.Kn=rt.min(),this.In=t.getMutationQueue(n),this.jn=t.getRemoteDocumentCache(),this.ze=t.getTargetCache(),this.Qn=new Us(this.jn,this.In,this.persistence.getIndexManager()),this.Je=t.getBundleCache(),this.Bn.$n(this.Qn)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Un)))}}function Ks(t,e,n,s){return new Bs(t,e,n,s)}async function hr(t,e){const n=q(t);let s=n.In,i=n.Qn;const r=await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.In.getAllMutationBatches(t).next((o=>(r=o,s=n.persistence.getMutationQueue(e),i=new Us(n.jn,s,n.persistence.getIndexManager()),s.getAllMutationBatches(t)))).next((e=>{const n=[],s=[];let o=un();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.Pn(t,o).next((t=>({Wn:t,removedBatchIds:n,addedBatchIds:s})))}))}));return n.In=s,n.Qn=i,n.Bn.$n(n.Qn),r}function $s(t){const e=q(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.ze.getLastRemoteSnapshotVersion(t)))}function zs(t,e,n,s,i){let r=un();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=nn();return n.forEach(((n,o)=>{const c=t.get(n),a=(null==i?void 0:i.get(n))||s;o.isNoDocument()&&o.version.isEqual(rt.min())?(e.removeEntry(n,a),r=r.insert(n,o)):!c.isValidDocument()||o.version.compareTo(c.version)>0||0===o.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(o,a),r=r.insert(n,o)):I("LocalStore","Ignoring outdated watch update for ",n,". Current version:",c.version," Watch version:",o.version)})),r}))}function Gs(t,e){const n=q(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.In.getNextMutationBatchAfterBatchId(t,e))))}function Qs(t,e){const n=q(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.ze.getTargetData(t,e).next((i=>i?(s=i,Nr.resolve(s)):n.ze.allocateTargetId(t).next((i=>(s=new qr(e,i,0,t.currentSequenceNumber),n.ze.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.Un.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Un=n.Un.insert(t.targetId,t),n.qn.set(e,t.targetId)),t}))}async function Hs(t,e,n){const s=q(t),i=s.Un.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!Cr(t))throw t;I("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Un=s.Un.remove(e),s.qn.delete(i.target)}function Ws(t,e,n){const s=q(t);let i=rt.min(),r=un();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=q(t),i=s.qn.get(n);return void 0!==i?Nr.resolve(s.Un.get(i)):s.ze.getTargetData(e,n)}(s,t,ie(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.ze.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.Bn.getDocumentsMatchingQuery(t,e,n?i:rt.min(),n?r:un()))).next((t=>({documents:t,Gn:r})))))}function Ys(t,e){const n=q(t),s=q(n.ze),i=n.Un.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(t=>s.Tt(t,e).next((t=>t?t.target:null))))}function Xs(t){const e=q(t);return e.persistence.runTransaction("Get new document changes","readonly",(t=>function(t,e,n){const s=q(t);let i=nn(),r=$r(n);const o=ks(e),c=IDBKeyRange.lowerBound(r,!0);return o.Kt({index:fr.readTimeIndex,range:c},((t,e)=>{const n=Br(s.N,e);i=i.insert(n.key,n),r=e.readTime})).next((()=>({En:i,readTime:zr(r)})))}(e.jn,t,e.Kn))).then((({En:t,readTime:n})=>(e.Kn=n,t)))}async function Js(t,e,n=un()){const s=await Qs(t,ie(Yr(e.bundledQuery))),i=q(t);return i.persistence.runTransaction("Save named query","readwrite",(t=>{const r=An(e.readTime);if(s.snapshotVersion.compareTo(r)>=0)return i.Je.saveNamedQuery(t,e);const o=s.withResumeToken(Z.EMPTY_BYTE_STRING,r);return i.Un=i.Un.insert(o.targetId,o),i.ze.updateTargetData(t,o).next((()=>i.ze.removeMatchingKeysForTargetId(t,s.targetId))).next((()=>i.ze.addMatchingKeys(t,n,s.targetId))).next((()=>i.Je.saveNamedQuery(t,e)))}))}class Zs{constructor(t){this.N=t,this.Yn=new Map,this.Xn=new Map}getBundleMetadata(t,e){return Nr.resolve(this.Yn.get(e))}saveBundleMetadata(t,e){var n;return this.Yn.set(e.id,{id:(n=e).id,version:n.version,createTime:An(n.createTime)}),Nr.resolve()}getNamedQuery(t,e){return Nr.resolve(this.Xn.get(e))}saveNamedQuery(t,e){return this.Xn.set(e.name,function(t){return{name:t.name,query:Yr(t.bundledQuery),readTime:An(t.readTime)}}(e)),Nr.resolve()}}class br{constructor(){this.Zn=new Ze(ti.ts),this.es=new Ze(ti.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(t,e){const n=new ti(t,e);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}ss(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.rs(new ti(t,e))}os(t,e){t.forEach((t=>this.removeReference(t,e)))}cs(t){const e=new lt(new W([])),n=new ti(e,t),s=new ti(e,t+1),i=[];return this.es.forEachInRange([n,s],(t=>{this.rs(t),i.push(t.key)})),i}us(){this.Zn.forEach((t=>this.rs(t)))}rs(t){this.Zn=this.Zn.delete(t),this.es=this.es.delete(t)}hs(t){const e=new lt(new W([])),n=new ti(e,t),s=new ti(e,t+1);let i=un();return this.es.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new ti(t,0),n=this.Zn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class ti{constructor(t,e){this.key=t,this.ls=e}static ts(t,e){return lt.comparator(t.key,e.key)||j(t.ls,e.ls)}static ns(t,e){return j(t.ls,e.ls)||lt.comparator(t.key,e.key)}}class ei{constructor(t,e){this.Ht=t,this.referenceDelegate=e,this.In=[],this.fs=1,this.ds=new Ze(ti.ts)}checkEmpty(t){return Nr.resolve(0===this.In.length)}addMutationBatch(t,e,n,s){const i=this.fs;this.fs++,this.In.length>0&&this.In[this.In.length-1];const r=new Vr(i,e,n,s);this.In.push(r);for(const e of s)this.ds=this.ds.add(new ti(e.key,i)),this.Ht.addToCollectionParentIndex(t,e.key.path.popLast());return Nr.resolve(r)}lookupMutationBatch(t,e){return Nr.resolve(this.ws(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this._s(n),i=s<0?0:s;return Nr.resolve(this.In.length>i?this.In[i]:null)}getHighestUnacknowledgedBatchId(){return Nr.resolve(0===this.In.length?-1:this.fs-1)}getAllMutationBatches(t){return Nr.resolve(this.In.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new ti(e,0),s=new ti(e,Number.POSITIVE_INFINITY),i=[];return this.ds.forEachInRange([n,s],(t=>{const e=this.ws(t.ls);i.push(e)})),Nr.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ze(j);return e.forEach((t=>{const e=new ti(t,0),s=new ti(t,Number.POSITIVE_INFINITY);this.ds.forEachInRange([e,s],(t=>{n=n.add(t.ls)}))})),Nr.resolve(this.gs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;lt.isDocumentKey(i)||(i=i.child(""));const r=new ti(new lt(i),0);let o=new Ze(j);return this.ds.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.ls)),!0)}),r),Nr.resolve(this.gs(o))}gs(t){const e=[];return t.forEach((t=>{const n=this.ws(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){N(0===this.ys(e.batchId,"removed")),this.In.shift();let n=this.ds;return Nr.forEach(e.mutations,(s=>{const i=new ti(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.ds=n}))}te(t){}containsKey(t,e){const n=new ti(e,0),s=this.ds.firstAfterOrEqual(n);return Nr.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.In.length,Nr.resolve()}ys(t,e){return this._s(t)}_s(t){return 0===this.In.length?0:t-this.In[0].batchId}ws(t){const e=this._s(t);return e<0||e>=this.In.length?null:this.In[e]}}class ni{constructor(t,e){this.Ht=t,this.ps=e,this.docs=new Ye(lt.comparator),this.size=0}addEntry(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.ps(e);return this.docs=this.docs.insert(s,{document:e.clone(),size:o,readTime:n}),this.size+=o-r,this.Ht.addToCollectionParentIndex(t,s.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Nr.resolve(n?n.document.clone():xt.newInvalidDocument(e))}getEntries(t,e){let n=nn();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.clone():xt.newInvalidDocument(t))})),Nr.resolve(n)}getDocumentsMatchingQuery(t,e,n){let s=nn();const i=new lt(e.path.child("")),r=this.docs.getIteratorFrom(i);for(;r.hasNext();){const{key:t,value:{document:i,readTime:o}}=r.getNext();if(!e.path.isPrefixOf(t.path))break;o.compareTo(n)<=0||he(e,i)&&(s=s.insert(i.key,i.clone()))}return Nr.resolve(s)}Ts(t,e){return Nr.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new ri(this)}getSize(t){return Nr.resolve(this.size)}}class ri extends Ns{constructor(t){super(),this.Se=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.document.isValidDocument()?e.push(this.Se.addEntry(t,s.document,this.getReadTime(n))):this.Se.removeEntry(n)})),Nr.waitFor(e)}getFromCache(t,e){return this.Se.getEntry(t,e)}getAllFromCache(t,e){return this.Se.getEntries(t,e)}}class si{constructor(t){this.persistence=t,this.Es=new Ss((t=>Ot(t)),Rt),this.lastRemoteSnapshotVersion=rt.min(),this.highestTargetId=0,this.Is=0,this.As=new br,this.targetCount=0,this.Rs=fs.se()}forEachTarget(t,e){return this.Es.forEach(((t,n)=>e(n))),Nr.resolve()}getLastRemoteSnapshotVersion(t){return Nr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Nr.resolve(this.Is)}allocateTargetId(t){return this.highestTargetId=this.Rs.next(),Nr.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Is&&(this.Is=e),Nr.resolve()}ce(t){this.Es.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Rs=new fs(e),this.highestTargetId=e),t.sequenceNumber>this.Is&&(this.Is=t.sequenceNumber)}addTargetData(t,e){return this.ce(e),this.targetCount+=1,Nr.resolve()}updateTargetData(t,e){return this.ce(e),Nr.resolve()}removeTargetData(t,e){return this.Es.delete(e.target),this.As.cs(e.targetId),this.targetCount-=1,Nr.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.Es.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Es.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),Nr.waitFor(i).next((()=>s))}getTargetCount(t){return Nr.resolve(this.targetCount)}getTargetData(t,e){const n=this.Es.get(e)||null;return Nr.resolve(n)}addMatchingKeys(t,e,n){return this.As.ss(e,n),Nr.resolve()}removeMatchingKeys(t,e,n){this.As.os(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),Nr.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.As.cs(e),Nr.resolve()}getMatchingKeysForTargetId(t,e){const n=this.As.hs(e);return Nr.resolve(n)}containsKey(t,e){return Nr.resolve(this.As.containsKey(e))}}class ii{constructor(t,e){this.bs={},this.Le=new M(0),this.Be=!1,this.Be=!0,this.referenceDelegate=t(this),this.ze=new si(this),this.Ht=new ts,this.He=function(t,e){return new ni(t,e)}(this.Ht,(t=>this.referenceDelegate.Ps(t))),this.N=new jr(e),this.Je=new Zs(this.N)}start(){return Promise.resolve()}shutdown(){return this.Be=!1,Promise.resolve()}get started(){return this.Be}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Ht}getMutationQueue(t){let e=this.bs[t.toKey()];return e||(e=new ei(this.Ht,this.referenceDelegate),this.bs[t.toKey()]=e),e}getTargetCache(){return this.ze}getRemoteDocumentCache(){return this.He}getBundleCache(){return this.Je}runTransaction(t,e,n){I("MemoryPersistence","Starting transaction:",t);const s=new oi(this.Le.next());return this.referenceDelegate.vs(),n(s).next((t=>this.referenceDelegate.Vs(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Ss(t,e){return Nr.or(Object.values(this.bs).map((n=>()=>n.containsKey(t,e))))}}class oi extends Sr{constructor(t){super(),this.currentSequenceNumber=t}}class ai{constructor(t){this.persistence=t,this.Ds=new br,this.Cs=null}static Ns(t){return new ai(t)}get xs(){if(this.Cs)return this.Cs;throw S()}addReference(t,e,n){return this.Ds.addReference(n,e),this.xs.delete(n.toString()),Nr.resolve()}removeReference(t,e,n){return this.Ds.removeReference(n,e),this.xs.add(n.toString()),Nr.resolve()}markPotentiallyOrphaned(t,e){return this.xs.add(e.toString()),Nr.resolve()}removeTarget(t,e){this.Ds.cs(e.targetId).forEach((t=>this.xs.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.xs.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}vs(){this.Cs=new Set}Vs(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Nr.forEach(this.xs,(n=>{const s=lt.fromPath(n);return this.ks(t,s).next((t=>{t||e.removeEntry(s)}))})).next((()=>(this.Cs=null,e.apply(t))))}updateLimboDocument(t,e){return this.ks(t,e).next((t=>{t?this.xs.delete(e.toString()):this.xs.add(e.toString())}))}Ps(t){return 0}ks(t,e){return Nr.or([()=>Nr.resolve(this.Ds.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ss(t,e)])}}function ci(t,e){return`firestore_clients_${t}_${e}`}function ui(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}function hi(t,e){return`firestore_targets_${t}_${e}`}class di{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static $s(t,e,n){const s=JSON.parse(n);let i,r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return r&&s.error&&(r="string"==typeof s.error.message&&"string"==typeof s.error.code,r&&(i=new x(s.error.code,s.error.message))),r?new di(t,e,s.state,i):(T("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Os(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class fi{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static $s(t,e){const n=JSON.parse(e);let s,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(s=new x(n.error.code,n.error.message))),i?new fi(t,n.state,s):(T("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Os(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class gi{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static $s(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=ln();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=ht(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new gi(t,i):(T("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class mi{constructor(t,e){this.clientId=t,this.onlineState=e}static $s(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new mi(e.clientId,e.onlineState):(T("SharedClientState",`Failed to parse online state: ${t}`),null)}}class pi{constructor(){this.activeTargetIds=ln()}Fs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ms(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Os(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class yi{constructor(t,e,n,s,i){this.window=t,this.Oe=e,this.persistenceKey=n,this.Ls=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Bs=this.Us.bind(this),this.qs=new Ye(j),this.started=!1,this.Ks=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.js=ci(this.persistenceKey,this.Ls),this.Qs=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.qs=this.qs.insert(this.Ls,new pi),this.Ws=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.Gs=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.zs=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.Hs=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.Js=function(t){return`firestore_bundle_loaded_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.Bs)}static bt(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.pn();for(const e of t){if(e===this.Ls)continue;const t=this.getItem(ci(this.persistenceKey,e));if(t){const n=gi.$s(e,t);n&&(this.qs=this.qs.insert(n.clientId,n))}}this.Ys();const e=this.storage.getItem(this.Hs);if(e){const t=this.Xs(e);t&&this.Zs(t)}for(const t of this.Ks)this.Us(t);this.Ks=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.Qs,JSON.stringify(t))}getAllActiveQueryTargets(){return this.ti(this.qs)}isActiveQueryTarget(t){let e=!1;return this.qs.forEach(((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.ei(t,"pending")}updateMutationState(t,e,n){this.ei(t,e,n),this.ni(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(hi(this.persistenceKey,t));if(n){const s=fi.$s(t,n);s&&(e=s.state)}}return this.si.Fs(t),this.Ys(),e}removeLocalQueryTarget(t){this.si.Ms(t),this.Ys()}isLocalQueryTarget(t){return this.si.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(hi(this.persistenceKey,t))}updateQueryState(t,e,n){this.ii(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.ni(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.ri(t)}notifyBundleLoaded(){this.oi()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Bs),this.removeItem(this.js),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return I("SharedClientState","READ",t,e),e}setItem(t,e){I("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){I("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Us(t){const e=t;if(e.storageArea===this.storage){if(I("SharedClientState","EVENT",e.key,e.newValue),e.key===this.js)return void T("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.Ws.test(e.key)){if(null==e.newValue){const t=this.ci(e.key);return this.ai(t,null)}{const t=this.ui(e.key,e.newValue);if(t)return this.ai(t.clientId,t)}}else if(this.Gs.test(e.key)){if(null!==e.newValue){const t=this.hi(e.key,e.newValue);if(t)return this.li(t)}}else if(this.zs.test(e.key)){if(null!==e.newValue){const t=this.fi(e.key,e.newValue);if(t)return this.di(t)}}else if(e.key===this.Hs){if(null!==e.newValue){const t=this.Xs(e.newValue);if(t)return this.Zs(t)}}else if(e.key===this.Qs){const t=function(t){let e=M.T;if(null!=t)try{const n=JSON.parse(t);N("number"==typeof n),e=n}catch(t){T("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==M.T&&this.sequenceNumberHandler(t)}else if(e.key===this.Js)return this.syncEngine.wi()}else this.Ks.push(e)}))}}get si(){return this.qs.get(this.Ls)}Ys(){this.setItem(this.js,this.si.Os())}ei(t,e,n){const s=new di(this.currentUser,t,e,n),i=ui(this.persistenceKey,this.currentUser,t);this.setItem(i,s.Os())}ni(t){const e=ui(this.persistenceKey,this.currentUser,t);this.removeItem(e)}ri(t){const e={clientId:this.Ls,onlineState:t};this.storage.setItem(this.Hs,JSON.stringify(e))}ii(t,e,n){const s=hi(this.persistenceKey,t),i=new fi(t,e,n);this.setItem(s,i.Os())}oi(){this.setItem(this.Js,"value-not-used")}ci(t){const e=this.Ws.exec(t);return e?e[1]:null}ui(t,e){const n=this.ci(t);return gi.$s(n,e)}hi(t,e){const n=this.Gs.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return di.$s(new f(i),s,e)}fi(t,e){const n=this.zs.exec(t),s=Number(n[1]);return fi.$s(s,e)}Xs(t){return mi.$s(t)}async li(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine._i(t.batchId,t.state,t.error);I("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}di(t){return this.syncEngine.mi(t.targetId,t.state,t.error)}ai(t,e){const n=e?this.qs.insert(t,e):this.qs.remove(t),s=this.ti(this.qs),i=this.ti(n),r=[],o=[];return i.forEach((t=>{s.has(t)||r.push(t)})),s.forEach((t=>{i.has(t)||o.push(t)})),this.syncEngine.gi(r,o).then((()=>{this.qs=n}))}Zs(t){this.qs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}ti(t){let e=ln();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class wi{constructor(){this.yi=new pi,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.yi.Fs(t),this.pi[t]||"not-current"}updateQueryState(t,e,n){this.pi[t]=e}removeLocalQueryTarget(t){this.yi.Ms(t)}isLocalQueryTarget(t){return this.yi.activeTargetIds.has(t)}clearQueryState(t){delete this.pi[t]}getAllActiveQueryTargets(){return this.yi.activeTargetIds}isActiveQueryTarget(t){return this.yi.activeTargetIds.has(t)}start(){return this.yi=new pi,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class vi{Ti(t){}shutdown(){}}class bi{constructor(){this.Ei=()=>this.Ii(),this.Ai=()=>this.Ri(),this.bi=[],this.Pi()}Ti(t){this.bi.push(t)}shutdown(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}Pi(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}Ii(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.bi)t(0)}Ri(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.bi)t(1)}static bt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Ii={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Ti{constructor(t){this.vi=t.vi,this.Vi=t.Vi}Si(t){this.Di=t}Ci(t){this.Ni=t}onMessage(t){this.xi=t}close(){this.Vi()}send(t){this.vi(t)}ki(){this.Di()}$i(t){this.Ni(t)}Oi(t){this.xi(t)}}class Ei extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.Fi=e+"://"+t.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Li(t,e,n,s){const i=this.Bi(t,e);I("RestConnection","Sending: ",i,n);const r={};return this.Ui(r,s),this.qi(t,i,r,n).then((t=>(I("RestConnection","Received: ",t),t)),(e=>{throw E("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e}))}Ki(t,e,n,s){return this.Li(t,e,n,s)}Ui(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/"+m,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(const n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])}Bi(t,e){const n=Ii[t];return`${this.Fi}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}qi(t,e,n,s){return new Promise(((i,r)=>{const o=new l.g;o.listenOnce(l.c.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case l.a.NO_ERROR:const e=o.getResponseJson();I("Connection","XHR received:",JSON.stringify(e)),i(e);break;case l.a.TIMEOUT:I("Connection",'RPC "'+t+'" timed out'),r(new x(D.DEADLINE_EXCEEDED,"Request time out"));break;case l.a.HTTP_ERROR:const n=o.getStatus();if(I("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(e)>=0?e:D.UNKNOWN}(t.status);r(new x(e,t.message))}else r(new x(D.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new x(D.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{I("Connection",'RPC "'+t+'" completed.')}}));const c=JSON.stringify(s);o.send(e,"POST",c,n,15)}))}ji(t,e){const n=[this.Fi,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Object(l.h)(),i=Object(l.i)(),r={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(r.xmlHttpFactory=new l.d({})),this.Ui(r.initMessageHeaders,e),Object(h.s)()||Object(h.u)()||Object(h.o)()||Object(h.q)()||Object(h.w)()||Object(h.n)()||(r.httpHeadersOverwriteParam="$httpHeaders");const o=n.join("");I("Connection","Creating WebChannel: "+o,r);const c=s.createWebChannel(o,r);let a=!1,u=!1;const d=new Ti({vi:t=>{u?I("Connection","Not sending because WebChannel is closed:",t):(a||(I("Connection","Opening WebChannel transport."),c.open(),a=!0),I("Connection","WebChannel sending:",t),c.send(t))},Vi:()=>c.close()}),g=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return g(c,l.f.EventType.OPEN,(()=>{u||I("Connection","WebChannel transport opened.")})),g(c,l.f.EventType.CLOSE,(()=>{u||(u=!0,I("Connection","WebChannel transport closed"),d.$i())})),g(c,l.f.EventType.ERROR,(t=>{u||(u=!0,E("Connection","WebChannel transport errored:",t),d.$i(new x(D.UNAVAILABLE,"The operation could not be completed")))})),g(c,l.f.EventType.MESSAGE,(t=>{var e;if(!u){const n=t.data[0];N(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){I("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=Ge[t];if(void 0!==e)return We(e)}(t),n=i.message;void 0===e&&(e=D.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),u=!0,d.$i(new x(e,n)),c.close()}else I("Connection","WebChannel received:",n),d.Oi(n)}})),g(i,l.b.STAT_EVENT,(t=>{t.stat===l.e.PROXY?I("Connection","Detected buffering proxy"):t.stat===l.e.NOPROXY&&I("Connection","Detected no buffering proxy")})),setTimeout((()=>{d.ki()}),0),d}}function _i(){return"undefined"!=typeof window?window:null}function Si(){return"undefined"!=typeof document?document:null}function Ni(t){return new En(t,!0)}class Ai{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Oe=t,this.timerId=e,this.Qi=n,this.Wi=s,this.Gi=i,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}reset(){this.zi=0}Yi(){this.zi=this.Gi}Xi(t){this.cancel();const e=Math.floor(this.zi+this.Zi()),n=Math.max(0,Date.now()-this.Ji),s=Math.max(0,e-n);s>0&&I("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.zi} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,s,(()=>(this.Ji=Date.now(),t()))),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}tr(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}cancel(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}Zi(){return(Math.random()-.5)*this.zi}}class Di{constructor(t,e,n,s,i,r,o){this.Oe=t,this.er=n,this.nr=s,this.sr=i,this.credentialsProvider=r,this.listener=o,this.state=0,this.ir=0,this.rr=null,this.cr=null,this.stream=null,this.ar=new Ai(t,e)}ur(){return 1===this.state||5===this.state||this.hr()}hr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.lr()}async stop(){this.ur()&&await this.close(0)}dr(){this.state=0,this.ar.reset()}wr(){this.hr()&&null===this.rr&&(this.rr=this.Oe.enqueueAfterDelay(this.er,6e4,(()=>this._r())))}mr(t){this.gr(),this.stream.send(t)}async _r(){if(this.hr())return this.close(0)}gr(){this.rr&&(this.rr.cancel(),this.rr=null)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}async close(t,e){this.gr(),this.yr(),this.ar.cancel(),this.ir++,4!==t?this.ar.reset():e&&e.code===D.RESOURCE_EXHAUSTED?(T(e.toString()),T("Using maximum backoff delay to prevent overloading the backend."),this.ar.Yi()):e&&e.code===D.UNAUTHENTICATED&&3!==this.state&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.pr(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Ci(e)}pr(){}auth(){this.state=1;const t=this.Tr(this.ir),e=this.ir;this.credentialsProvider.getToken().then((t=>{this.ir===e&&this.Er(t)}),(e=>{t((()=>{const t=new x(D.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Ir(t)}))}))}Er(t){const e=this.Tr(this.ir);this.stream=this.Ar(t),this.stream.Si((()=>{e((()=>(this.state=2,this.cr=this.Oe.enqueueAfterDelay(this.nr,1e4,(()=>(this.hr()&&(this.state=3),Promise.resolve()))),this.listener.Si())))})),this.stream.Ci((t=>{e((()=>this.Ir(t)))})),this.stream.onMessage((t=>{e((()=>this.onMessage(t)))}))}lr(){this.state=5,this.ar.Xi((async()=>{this.state=0,this.start()}))}Ir(t){return I("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Tr(t){return e=>{this.Oe.enqueueAndForget((()=>this.ir===t?e():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class xi extends Di{constructor(t,e,n,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i),this.N=s}Ar(t){return this.sr.ji("Listen",t)}onMessage(t){this.ar.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:S()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.D?(N(void 0===e||"string"==typeof e),Z.fromBase64String(e||"")):(N(void 0===e||e instanceof Uint8Array),Z.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(t){const e=void 0===t.code?D.UNKNOWN:We(t.code);return new x(e,t.message||"")}(o);n=new pn(s,i,r,c||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=Cn(t,s.document.name),r=An(s.document.updateTime),o=new At({mapValue:{fields:s.document.fields}}),c=xt.newFoundDocument(i,r,o),a=s.targetIds||[],u=s.removedTargetIds||[];n=new gn(a,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=Cn(t,s.document),r=s.readTime?An(s.readTime):rt.min(),o=xt.newNoDocument(i,r),c=s.removedTargetIds||[];n=new gn([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=Cn(t,s.document),r=s.removedTargetIds||[];n=new gn([],r,i,null)}else{if(!("filter"in e))return S();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new ze(s),r=t.targetId;n=new mn(r,i)}}return n}(this.N,t),n=function(t){if(!("targetChange"in t))return rt.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?rt.min():e.readTime?An(e.readTime):rt.min()}(t);return this.listener.Rr(e,n)}br(t){const e={};e.database=Ln(this.N),e.addTarget=function(t,e){let n;const s=e.target;return n=Lt(s)?{documents:qn(t,s)}:{query:jn(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Sn(t,e.resumeToken):e.snapshotVersion.compareTo(rt.min())>0&&(n.readTime=_n(t,e.snapshotVersion.toTimestamp())),n}(this.N,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return S()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.N,t);n&&(e.labels=n),this.mr(e)}Pr(t){const e={};e.database=Ln(this.N),e.removeTarget=t,this.mr(e)}}class ki extends Di{constructor(t,e,n,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i),this.N=s,this.vr=!1}get Vr(){return this.vr}start(){this.vr=!1,this.lastStreamToken=void 0,super.start()}pr(){this.vr&&this.Sr([])}Ar(t){return this.sr.ji("Write",t)}onMessage(t){if(N(!!t.streamToken),this.lastStreamToken=t.streamToken,this.vr){this.ar.reset();const e=function(t,e){return t&&t.length>0?(N(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?An(t.updateTime):An(e);return n.isEqual(rt.min())&&(n=An(e)),new xe(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=An(t.commitTime);return this.listener.Dr(n,e)}return N(!t.writeResults||0===t.writeResults.length),this.vr=!0,this.listener.Cr()}Nr(){const t={};t.database=Ln(this.N),this.mr(t)}Sr(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Vn(this.N,t)))};this.mr(e)}}class Ci extends class{}{constructor(t,e,n){super(),this.credentials=t,this.sr=e,this.N=n,this.kr=!1}$r(){if(this.kr)throw new x(D.FAILED_PRECONDITION,"The client has already been terminated.")}Li(t,e,n){return this.$r(),this.credentials.getToken().then((s=>this.sr.Li(t,e,n,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===D.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new x(D.UNKNOWN,t.toString())}))}Ki(t,e,n){return this.$r(),this.credentials.getToken().then((s=>this.sr.Ki(t,e,n,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===D.UNAUTHENTICATED&&this.credentials.invalidateToken(),t):new x(D.UNKNOWN,t.toString())}))}terminate(){this.kr=!0}}class Oi{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Or=0,this.Fr=null,this.Mr=!0}Lr(){0===this.Or&&(this.Br("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.Fr=null,this.Ur("Backend didn't respond within 10 seconds."),this.Br("Offline"),Promise.resolve()))))}qr(t){"Online"===this.state?this.Br("Unknown"):(this.Or++,this.Or>=1&&(this.Kr(),this.Ur(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.Br("Offline")))}set(t){this.Kr(),this.Or=0,"Online"===t&&(this.Mr=!1),this.Br(t)}Br(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Ur(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Mr?(T(e),this.Mr=!1):I("OnlineStateTracker",e)}Kr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class Ri{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.jr=[],this.Qr=new Map,this.Wr=new Set,this.Gr=[],this.zr=i,this.zr.Ti((t=>{n.enqueueAndForget((async()=>{Bi(this)&&(I("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=q(t);e.Wr.add(4),await Fi(e),e.Hr.set("Unknown"),e.Wr.delete(4),await Li(e)}(this))}))})),this.Hr=new Oi(n,s)}}async function Li(t){if(Bi(t))for(const e of t.Gr)await e(!0)}async function Fi(t){for(const e of t.Gr)await e(!1)}function Pi(t,e){const n=q(t);n.Qr.has(e.targetId)||(n.Qr.set(e.targetId,e),ji(n)?qi(n):io(n).hr()&&Vi(n,e))}function Mi(t,e){const n=q(t),s=io(n);n.Qr.delete(e),s.hr()&&Ui(n,e),0===n.Qr.size&&(s.hr()?s.wr():Bi(n)&&n.Hr.set("Unknown"))}function Vi(t,e){t.Jr.Y(e.targetId),io(t).br(e)}function Ui(t,e){t.Jr.Y(e),io(t).Pr(e)}function qi(t){t.Jr=new wn({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.Qr.get(e)||null}),io(t).start(),t.Hr.Lr()}function ji(t){return Bi(t)&&!io(t).ur()&&t.Qr.size>0}function Bi(t){return 0===q(t).Wr.size}function Ki(t){t.Jr=void 0}async function $i(t){t.Qr.forEach(((e,n)=>{Vi(t,e)}))}async function zi(t,e){Ki(t),ji(t)?(t.Hr.qr(e),qi(t)):t.Hr.set("Unknown")}async function Gi(t,e,n){if(t.Hr.set("Online"),e instanceof pn&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Qr.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.Qr.delete(s),t.Jr.removeTarget(s))}(t,e)}catch(n){I("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Qi(t,n)}else if(e instanceof gn?t.Jr.rt(e):e instanceof mn?t.Jr.ft(e):t.Jr.at(e),!n.isEqual(rt.min()))try{const e=await $s(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Jr._t(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Qr.get(s);i&&t.Qr.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.Qr.get(e);if(!n)return;t.Qr.set(e,n.withResumeToken(Z.EMPTY_BYTE_STRING,n.snapshotVersion)),Ui(t,e);const s=new qr(n.target,e,1,n.sequenceNumber);Vi(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){I("RemoteStore","Failed to raise snapshot:",e),await Qi(t,e)}}async function Qi(t,e,n){if(!Cr(e))throw e;t.Wr.add(1),await Fi(t),t.Hr.set("Offline"),n||(n=()=>$s(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{I("RemoteStore","Retrying IndexedDB access"),await n(),t.Wr.delete(1),await Li(t)}))}function Hi(t,e){return e().catch((n=>Qi(t,n,e)))}async function Wi(t){const e=q(t),n=oo(e);let s=e.jr.length>0?e.jr[e.jr.length-1].batchId:-1;for(;Yi(e);)try{const t=await Gs(e.localStore,s);if(null===t){0===e.jr.length&&n.wr();break}s=t.batchId,Xi(e,t)}catch(t){await Qi(e,t)}Ji(e)&&Zi(e)}function Yi(t){return Bi(t)&&t.jr.length<10}function Xi(t,e){t.jr.push(e);const n=oo(t);n.hr()&&n.Vr&&n.Sr(e.mutations)}function Ji(t){return Bi(t)&&!oo(t).ur()&&t.jr.length>0}function Zi(t){oo(t).start()}async function to(t){oo(t).Nr()}async function eo(t){const e=oo(t);for(const n of t.jr)e.Sr(n.mutations)}async function no(t,e,n){const s=t.jr.shift(),i=Ur.from(s,e,n);await Hi(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Wi(t)}async function ro(t,e){e&&oo(t).Vr&&await async function(t,e){if(He(n=e.code)&&n!==D.ABORTED){const n=t.jr.shift();oo(t).dr(),await Hi(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Wi(t)}var n}(t,e),Ji(t)&&Zi(t)}async function so(t,e){const n=q(t);e?(n.Wr.delete(2),await Li(n)):e||(n.Wr.add(2),await Fi(n),n.Hr.set("Unknown"))}function io(t){return t.Yr||(t.Yr=function(t,e,n){const s=q(t);return s.$r(),new xi(e,s.sr,s.credentials,s.N,n)}(t.datastore,t.asyncQueue,{Si:$i.bind(null,t),Ci:zi.bind(null,t),Rr:Gi.bind(null,t)}),t.Gr.push((async e=>{e?(t.Yr.dr(),ji(t)?qi(t):t.Hr.set("Unknown")):(await t.Yr.stop(),Ki(t))}))),t.Yr}function oo(t){return t.Xr||(t.Xr=function(t,e,n){const s=q(t);return s.$r(),new ki(e,s.sr,s.credentials,s.N,n)}(t.datastore,t.asyncQueue,{Si:to.bind(null,t),Ci:ro.bind(null,t),Cr:eo.bind(null,t),Dr:no.bind(null,t)}),t.Gr.push((async e=>{e?(t.Xr.dr(),await Wi(t)):(await t.Xr.stop(),t.jr.length>0&&(I("RemoteStore",`Stopping write stream with ${t.jr.length} pending writes`),t.jr=[]))}))),t.Xr}class ao{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new k,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new ao(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new x(D.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function co(t,e){if(T("AsyncQueue",`${e}: ${t}`),Cr(t))return new x(D.UNAVAILABLE,`${e}: ${t}`);throw t}class uo{constructor(t){this.comparator=t?(e,n)=>t(e,n)||lt.comparator(e.key,n.key):(t,e)=>lt.comparator(t.key,e.key),this.keyedMap=sn(),this.sortedSet=new Ye(this.comparator)}static emptySet(t){return new uo(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof uo))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new uo;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class ho{constructor(){this.Zr=new Ye(lt.comparator)}track(t){const e=t.doc.key,n=this.Zr.get(e);n?0!==t.type&&3===n.type?this.Zr=this.Zr.insert(e,t):3===t.type&&1!==n.type?this.Zr=this.Zr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Zr=this.Zr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Zr=this.Zr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Zr=this.Zr.remove(e):1===t.type&&2===n.type?this.Zr=this.Zr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Zr=this.Zr.insert(e,{type:2,doc:t.doc}):S():this.Zr=this.Zr.insert(e,t)}eo(){const t=[];return this.Zr.inorderTraversal(((e,n)=>{t.push(n)})),t}}class lo{constructor(t,e,n,s,i,r,o,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=c}static fromInitialDocuments(t,e,n,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new lo(t,e,uo.emptySet(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ae(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class fo{constructor(){this.no=void 0,this.listeners=[]}}class go{constructor(){this.queries=new Ss((t=>ce(t)),ae),this.onlineState="Unknown",this.so=new Set}}async function mo(t,e){const n=q(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new fo),i)try{r.no=await n.onListen(s)}catch(t){const n=co(t,`Initialization of query '${ue(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.io(n.onlineState),r.no&&e.ro(r.no)&&vo(n)}async function po(t,e){const n=q(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function yo(t,e){const n=q(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.ro(t)&&(s=!0);i.no=t}}s&&vo(n)}function wo(t,e,n){const s=q(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}function vo(t){t.so.forEach((t=>{t.next()}))}class bo{constructor(t,e,n){this.query=t,this.oo=e,this.co=!1,this.ao=null,this.onlineState="Unknown",this.options=n||{}}ro(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new lo(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.co?this.uo(t)&&(this.oo.next(t),e=!0):this.ho(t,this.onlineState)&&(this.lo(t),e=!0),this.ao=t,e}onError(t){this.oo.error(t)}io(t){this.onlineState=t;let e=!1;return this.ao&&!this.co&&this.ho(this.ao,t)&&(this.lo(this.ao),e=!0),e}ho(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.fo&&n||t.docs.isEmpty()&&"Offline"!==e)}uo(t){if(t.docChanges.length>0)return!0;const e=this.ao&&this.ao.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}lo(t){t=lo.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.co=!0,this.oo.next(t)}}class Io{constructor(t,e){this.payload=t,this.byteLength=e}wo(){return"metadata"in this.payload}}class To{constructor(t){this.N=t}zn(t){return Cn(this.N,t)}Hn(t){return t.metadata.exists?Mn(this.N,t.document,!1):xt.newNoDocument(this.zn(t.metadata.name),this.Jn(t.metadata.readTime))}Jn(t){return An(t)}}class Eo{constructor(t,e,n){this._o=t,this.localStore=e,this.N=n,this.queries=[],this.documents=[],this.progress=_o(t)}mo(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}yo(t){const e=new Map,n=new To(this.N);for(const s of t)if(s.metadata.queries){const t=n.zn(s.metadata.name);for(const n of s.metadata.queries){const s=(e.get(n)||un()).add(t);e.set(n,s)}}return e}async complete(){const t=await async function(t,e,n,s){const i=q(t);let r=un(),o=nn(),c=an();for(const t of n){const n=e.zn(t.metadata.name);t.document&&(r=r.add(n)),o=o.insert(n,e.Hn(t)),c=c.insert(n,e.Jn(t.metadata.readTime))}const a=i.jn.newChangeBuffer({trackRemovals:!0}),u=await Qs(i,function(t){return ie(Jt(W.fromString(`__bundle__/docs/${t}`)))}(s));return i.persistence.runTransaction("Apply bundle documents","readwrite",(t=>zs(t,a,o,rt.min(),c).next((e=>(a.apply(t),e))).next((e=>i.ze.removeMatchingKeysForTargetId(t,u.targetId).next((()=>i.ze.addMatchingKeys(t,r,u.targetId))).next((()=>i.Qn.vn(t,e))).next((()=>e))))))}(this.localStore,new To(this.N),this.documents,this._o.id),e=this.yo(this.documents);for(const t of this.queries)await Js(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",new Vs(Object.assign({},this.progress),t)}}function _o(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class So{constructor(t){this.key=t}}class No{constructor(t){this.key=t}}class Ao{constructor(t,e){this.query=t,this.po=e,this.To=null,this.current=!1,this.Eo=un(),this.mutatedKeys=un(),this.Io=le(t),this.Ao=new uo(this.Io)}get Ro(){return this.po}bo(t,e){const n=e?e.Po:new ho,s=e?e.Ao:this.Ao;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const c=Zt(this.query)&&s.size===this.query.limit?s.last():null,a=te(this.query)&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const u=s.get(t),h=he(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.vo(u,h)||(n.track({type:2,doc:h}),f=!0,(c&&this.Io(h,c)>0||a&&this.Io(h,a)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(c||a)&&(o=!0)),f&&(h?(r=r.add(h),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),Zt(this.query)||te(this.query))for(;r.size>this.query.limit;){const t=Zt(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Ao:r,Po:n,Ln:o,mutatedKeys:i}}vo(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.Ao;this.Ao=t.Ao,this.mutatedKeys=t.mutatedKeys;const i=t.Po.eo();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return n(t)-n(e)}(t.type,e.type)||this.Io(t.doc,e.doc))),this.Vo(n);const r=e?this.So():[],o=0===this.Eo.size&&this.current?1:0,c=o!==this.To;return this.To=o,0!==i.length||c?{snapshot:new lo(this.query,t.Ao,s,i,t.mutatedKeys,0===o,c,!1),Do:r}:{Do:r}}io(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Ao:this.Ao,Po:new ho,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{Do:[]}}Co(t){return!this.po.has(t)&&!!this.Ao.has(t)&&!this.Ao.get(t).hasLocalMutations}Vo(t){t&&(t.addedDocuments.forEach((t=>this.po=this.po.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.po=this.po.delete(t))),this.current=t.current)}So(){if(!this.current)return[];const t=this.Eo;this.Eo=un(),this.Ao.forEach((t=>{this.Co(t.key)&&(this.Eo=this.Eo.add(t.key))}));const e=[];return t.forEach((t=>{this.Eo.has(t)||e.push(new No(t))})),this.Eo.forEach((n=>{t.has(n)||e.push(new So(n))})),e}No(t){this.po=t.Gn,this.Eo=un();const e=this.bo(t.documents);return this.applyChanges(e,!0)}xo(){return lo.fromInitialDocuments(this.query,this.Ao,this.mutatedKeys,0===this.To)}}class Do{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class xo{constructor(t){this.key=t,this.ko=!1}}class ko{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.$o={},this.Oo=new Ss((t=>ce(t)),ae),this.Fo=new Map,this.Mo=new Set,this.Lo=new Ye(lt.comparator),this.Bo=new Map,this.Uo=new br,this.qo={},this.Ko=new Map,this.jo=fs.ie(),this.onlineState="Unknown",this.Qo=void 0}get isPrimaryClient(){return!0===this.Qo}}async function Co(t,e){const n=ra(t);let s,i;const r=n.Oo.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.xo();else{const t=await Qs(n.localStore,ie(e)),r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await Oo(n,e,s,"current"===r),n.isPrimaryClient&&Pi(n.remoteStore,t)}return i}async function Oo(t,e,n,s){t.Wo=(e,n,s)=>async function(t,e,n,s){let i=e.view.bo(n);i.Ln&&(i=await Ws(t.localStore,e.query,!1).then((({documents:t})=>e.view.bo(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,r);return Ko(t,e.targetId,o.Do),o.snapshot}(t,e,n,s);const i=await Ws(t.localStore,e,!0),r=new Ao(e,i.Gn),o=r.bo(i.documents),c=fn.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState),a=r.applyChanges(o,t.isPrimaryClient,c);Ko(t,n,a.Do);const u=new Do(e,n,r);return t.Oo.set(e,u),t.Fo.has(n)?t.Fo.get(n).push(e):t.Fo.set(n,[e]),a.snapshot}async function Ro(t,e){const n=q(t),s=n.Oo.get(e),i=n.Fo.get(s.targetId);if(i.length>1)return n.Fo.set(s.targetId,i.filter((t=>!ae(t,e)))),void n.Oo.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Hs(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),Mi(n.remoteStore,s.targetId),jo(n,s.targetId)})).catch(ws)):(jo(n,s.targetId),await Hs(n.localStore,s.targetId,!0))}async function Lo(t,e){const n=q(t);try{const t=await function(t,e){const n=q(t),s=e.snapshotVersion;let i=n.Un;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.jn.newChangeBuffer({trackRemovals:!0});i=n.Un;const o=[];e.targetChanges.forEach(((e,r)=>{const c=i.get(r);if(!c)return;o.push(n.ze.removeMatchingKeys(t,e.removedDocuments,r).next((()=>n.ze.addMatchingKeys(t,e.addedDocuments,r))));const a=e.resumeToken;if(a.approximateByteSize()>0){const u=c.withResumeToken(a,s).withSequenceNumber(t.currentSequenceNumber);i=i.insert(r,u),function(t,e,n){return N(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,e)&&o.push(n.ze.updateTargetData(t,u))}}));let c=nn();if(e.documentUpdates.forEach(((s,i)=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(zs(t,r,e.documentUpdates,s,void 0).next((t=>{c=t}))),!s.isEqual(rt.min())){const e=n.ze.getLastRemoteSnapshotVersion(t).next((e=>n.ze.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return Nr.waitFor(o).next((()=>r.apply(t))).next((()=>n.Qn.vn(t,c))).next((()=>c))})).then((t=>(n.Un=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.Bo.get(e);s&&(N(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.ko=!0:t.modifiedDocuments.size>0?N(s.ko):t.removedDocuments.size>0&&(N(s.ko),s.ko=!1))})),await Go(n,t,e)}catch(t){await ws(t)}}function Fo(t,e,n){const s=q(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.Oo.forEach(((n,s)=>{const i=s.view.io(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=q(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.io(e)&&(s=!0)})),s&&vo(n)}(s.eventManager,e),t.length&&s.$o.Rr(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Po(t,e,n){const s=q(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.Bo.get(e),r=i&&i.key;if(r){let t=new Ye(lt.comparator);t=t.insert(r,xt.newNoDocument(r,rt.min()));const n=un().add(r),i=new dn(rt.min(),new Map,new Ze(j),t,n);await Lo(s,i),s.Lo=s.Lo.remove(r),s.Bo.delete(e),zo(s)}else await Hs(s.localStore,e,!1).then((()=>jo(s,e,n))).catch(ws)}async function Mo(t,e){const n=q(t),s=e.batch.batchId;try{const t=await function(t,e){const n=q(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.jn.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=Nr.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);N(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&s.addEntry(e,n.commitVersion))}))})),o.next((()=>t.In.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.In.performConsistencyCheck(t))).next((()=>n.Qn.Pn(t,s)))}))}(n.localStore,e);qo(n,s,null),Uo(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Go(n,t)}catch(t){await ws(t)}}async function Vo(t,e,n){const s=q(t);try{const t=await function(t,e){const n=q(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.In.lookupMutationBatch(t,e).next((e=>(N(null!==e),s=e.keys(),n.In.removeMutationBatch(t,e)))).next((()=>n.In.performConsistencyCheck(t))).next((()=>n.Qn.Pn(t,s)))}))}(s.localStore,e);qo(s,e,n),Uo(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Go(s,t)}catch(n){await ws(n)}}function Uo(t,e){(t.Ko.get(e)||[]).forEach((t=>{t.resolve()})),t.Ko.delete(e)}function qo(t,e,n){const s=q(t);let i=s.qo[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.qo[s.currentUser.toKey()]=i}}function jo(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Fo.get(e))t.Oo.delete(s),n&&t.$o.Go(s,n);t.Fo.delete(e),t.isPrimaryClient&&t.Uo.cs(e).forEach((e=>{t.Uo.containsKey(e)||Bo(t,e)}))}function Bo(t,e){t.Mo.delete(e.path.canonicalString());const n=t.Lo.get(e);null!==n&&(Mi(t.remoteStore,n),t.Lo=t.Lo.remove(e),t.Bo.delete(n),zo(t))}function Ko(t,e,n){for(const s of n)s instanceof So?(t.Uo.addReference(s.key,e),$o(t,s)):s instanceof No?(I("SyncEngine","Document no longer in limbo: "+s.key),t.Uo.removeReference(s.key,e),t.Uo.containsKey(s.key)||Bo(t,s.key)):S()}function $o(t,e){const n=e.key,s=n.path.canonicalString();t.Lo.get(n)||t.Mo.has(s)||(I("SyncEngine","New document in limbo: "+n),t.Mo.add(s),zo(t))}function zo(t){for(;t.Mo.size>0&&t.Lo.size<t.maxConcurrentLimboResolutions;){const e=t.Mo.values().next().value;t.Mo.delete(e);const n=new lt(W.fromString(e)),s=t.jo.next();t.Bo.set(s,new xo(n)),t.Lo=t.Lo.insert(n,s),Pi(t.remoteStore,new qr(ie(Jt(n.path)),s,2,M.T))}}async function Go(t,e,n){const s=q(t),i=[],r=[],o=[];s.Oo.isEmpty()||(s.Oo.forEach(((t,c)=>{o.push(s.Wo(c,e,n).then((t=>{if(t){s.isPrimaryClient&&s.sharedClientState.updateQueryState(c.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=qs.kn(c.targetId,t);r.push(e)}})))})),await Promise.all(o),s.$o.Rr(i),await async function(t,e){const n=q(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Nr.forEach(e,(e=>Nr.forEach(e.Nn,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>Nr.forEach(e.xn,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!Cr(t))throw t;I("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Un.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.Un=n.Un.insert(e,i)}}}(s.localStore,r))}async function Qo(t,e){const n=q(t);if(!n.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const t=await hr(n.localStore,e);n.currentUser=e,function(t,e){t.Ko.forEach((t=>{t.forEach((t=>{t.reject(new x(D.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ko.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Go(n,t.Wn)}}function Ho(t,e){const n=q(t),s=n.Bo.get(e);if(s&&s.ko)return un().add(s.key);{let t=un();const s=n.Fo.get(e);if(!s)return t;for(const e of s){const s=n.Oo.get(e);t=t.unionWith(s.view.Ro)}return t}}async function Wo(t,e){const n=q(t),s=await Ws(n.localStore,e.query,!0),i=e.view.No(s);return n.isPrimaryClient&&Ko(n,e.targetId,i.Do),i}async function Yo(t){const e=q(t);return Xs(e.localStore).then((t=>Go(e,t)))}async function Xo(t,e,n,s){const i=q(t),r=await function(t,e){const n=q(t),s=q(n.In);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>s.Xt(t,e).next((e=>e?n.Qn.Pn(t,e):Nr.resolve(null)))))}(i.localStore,e);null!==r?("pending"===n?await Wi(i.remoteStore):"acknowledged"===n||"rejected"===n?(qo(i,e,s||null),Uo(i,e),function(t,e){q(q(t).In).te(e)}(i.localStore,e)):S(),await Go(i,r)):I("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Jo(t,e,n){const s=q(t),i=[],r=[];for(const t of e){let e;const n=s.Fo.get(t);if(n&&0!==n.length){e=await Qs(s.localStore,ie(n[0]));for(const t of n){const e=s.Oo.get(t),n=await Wo(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await Ys(s.localStore,t);e=await Qs(s.localStore,n),await Oo(s,Zo(n),t,!1)}i.push(e)}return s.$o.Rr(r),i}function Zo(t){return Xt(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function ta(t){const e=q(t);return q(q(e.localStore).persistence).pn()}async function ea(t,e,n,s){const i=q(t);if(i.Qo)I("SyncEngine","Ignoring unexpected query state notification.");else if(i.Fo.has(e))switch(n){case"current":case"not-current":{const t=await Xs(i.localStore),s=dn.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await Go(i,t,s);break}case"rejected":await Hs(i.localStore,e,!0),jo(i,e,s);break;default:S()}}async function na(t,e,n){const s=ra(t);if(s.Qo){for(const t of e){if(s.Fo.has(t)){I("SyncEngine","Adding an already active target "+t);continue}const e=await Ys(s.localStore,t),n=await Qs(s.localStore,e);await Oo(s,Zo(e),n.targetId,!1),Pi(s.remoteStore,n)}for(const t of n)s.Fo.has(t)&&await Hs(s.localStore,t,!1).then((()=>{Mi(s.remoteStore,t),jo(s,t)})).catch(ws)}}function ra(t){const e=q(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Lo.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ho.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Po.bind(null,e),e.$o.Rr=yo.bind(null,e.eventManager),e.$o.Go=wo.bind(null,e.eventManager),e}function sa(t){const e=q(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Mo.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Vo.bind(null,e),e}class ia{constructor(){this.synchronizeTabs=!1}async initialize(t){this.N=Ni(t.databaseInfo.databaseId),this.sharedClientState=this.Ho(t),this.persistence=this.Jo(t),await this.persistence.start(),this.gcScheduler=this.Yo(t),this.localStore=this.Xo(t)}Yo(t){return null}Xo(t){return Ks(this.persistence,new js,t.initialUser,this.N)}Jo(t){return new ii(ai.Ns,this.N)}Ho(t){return new wi}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class oa extends ia{constructor(t,e,n){super(),this.Zo=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=q(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",(t=>function(t){const e=ks(t);let n=rt.min();return e.Kt({index:fr.readTimeIndex,reverse:!0},((t,e,s)=>{e.readTime&&(n=zr(e.readTime)),s.done()})).next((()=>n))}(t))).then((t=>{e.Kn=t}))}(this.localStore),await this.Zo.initialize(this,t),await sa(this.Zo.syncEngine),await Wi(this.Zo.remoteStore),await this.persistence.nn((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Xo(t){return Ks(this.persistence,new js,t.initialUser,this.N)}Yo(t){const e=this.persistence.referenceDelegate.garbageCollector;return new Is(e,t.asyncQueue)}Jo(t){const e=Ms(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?is.withCacheSize(this.cacheSizeBytes):is.DEFAULT;return new tr(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,_i(),Si(),this.N,this.sharedClientState,!!this.forceOwnership)}Ho(t){return new wi}}class aa extends oa{constructor(t,e){super(t,e,!1),this.Zo=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.Zo.syncEngine;this.sharedClientState instanceof yi&&(this.sharedClientState.syncEngine={_i:Xo.bind(null,e),mi:ea.bind(null,e),gi:na.bind(null,e),pn:ta.bind(null,e),wi:Yo.bind(null,e)},await this.sharedClientState.start()),await this.persistence.nn((async t=>{await async function(t,e){const n=q(t);if(ra(n),sa(n),!0===e&&!0!==n.Qo){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await Jo(n,t.toArray());n.Qo=!0,await so(n.remoteStore,!0);for(const t of e)Pi(n.remoteStore,t)}else if(!1===e&&!1!==n.Qo){const t=[];let e=Promise.resolve();n.Fo.forEach(((s,i)=>{n.sharedClientState.isLocalQueryTarget(i)?t.push(i):e=e.then((()=>(jo(n,i),Hs(n.localStore,i,!0)))),Mi(n.remoteStore,i)})),await e,await Jo(n,t),function(t){const e=q(t);e.Bo.forEach(((t,n)=>{Mi(e.remoteStore,n)})),e.Uo.us(),e.Bo=new Map,e.Lo=new Ye(lt.comparator)}(n),n.Qo=!1,await so(n.remoteStore,!1)}}(this.Zo.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop())}))}Ho(t){const e=_i();if(!yi.bt(e))throw new x(D.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ms(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new yi(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class ca{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Fo(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Qo.bind(null,this.syncEngine),await so(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new go}createDatastore(t){const e=Ni(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new Ei(s));var s;return function(t,e,n){return new Ci(t,e,n)}(t.credentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,i=t=>Fo(this.syncEngine,t,0),r=bi.bt()?new bi:new vi,new Ri(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const c=new ko(t,e,n,s,i,r);return o&&(c.Qo=!0),c}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=q(t);I("RemoteStore","RemoteStore shutting down."),e.Wr.add(5),await Fi(e),e.zr.shutdown(),e.Hr.set("Unknown")}(this.remoteStore)}}function ua(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class ha{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.tc(this.observer.next,t)}error(t){this.observer.error?this.tc(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}ec(){this.muted=!0}tc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class la{constructor(t,e){this.nc=t,this.N=e,this.metadata=new k,this.buffer=new Uint8Array,this.sc=new TextDecoder("utf-8"),this.ic().then((t=>{t&&t.wo()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))}),(t=>this.metadata.reject(t)))}close(){return this.nc.cancel()}async getMetadata(){return this.metadata.promise}async zo(){return await this.getMetadata(),this.ic()}async ic(){const t=await this.rc();if(null===t)return null;const e=this.sc.decode(t),n=Number(e);isNaN(n)&&this.oc(`length string (${e}) is not valid number`);const s=await this.cc(n);return new Io(JSON.parse(s),t.length+n)}ac(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async rc(){for(;this.ac()<0&&!await this.uc(););if(0===this.buffer.length)return null;const t=this.ac();t<0&&this.oc("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async cc(t){for(;this.buffer.length<t;)await this.uc()&&this.oc("Reached the end of bundle when more is expected.");const e=this.sc.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}oc(t){throw this.nc.cancel(),new Error(`Invalid bundle format: ${t}`)}async uc(){const t=await this.nc.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class da{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new x(D.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=q(t),s=Ln(n.N)+"/documents",i={documents:e.map((t=>kn(n.N,t)))},r=await n.Ki("BatchGetDocuments",s,i),o=new Map;r.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){N(!!e.found),e.found.name,e.found.updateTime;const n=Cn(t,e.found.name),s=An(e.found.updateTime),i=new At({mapValue:{fields:e.found.fields}});return xt.newFoundDocument(n,s,i)}(t,e):"missing"in e?function(t,e){N(!!e.missing),N(!!e.readTime);const n=Cn(t,e.missing),s=An(e.readTime);return xt.newNoDocument(n,s)}(t,e):S()}(n.N,t);o.set(e.key.toString(),e)}));const c=[];return e.forEach((t=>{const e=o.get(t.toString());N(!!e),c.push(e)})),c}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ke(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=lt.fromPath(e);this.mutations.push(new $e(n,this.precondition(n)))})),await async function(t,e){const n=q(t),s=Ln(n.N)+"/documents",i={writes:e.map((t=>Vn(n.N,t)))};await n.Li("Commit",s,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw S();e=rt.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new x(D.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ke.updateTime(e):ke.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(rt.min()))throw new x(D.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ke.updateTime(e)}return ke.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class fa{constructor(t,e,n,s){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=s,this.hc=5,this.ar=new Ai(this.asyncQueue,"transaction_retry")}run(){this.hc-=1,this.lc()}lc(){this.ar.Xi((async()=>{const t=new da(this.datastore),e=this.fc(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.dc(t)}))))})).catch((t=>{this.dc(t)}))}))}fc(t){try{const e=this.updateFunction(t);return!ct(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}dc(t){this.hc>0&&this.wc(t)?(this.hc-=1,this.asyncQueue.enqueueAndForget((()=>(this.lc(),Promise.resolve())))):this.deferred.reject(t)}wc(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!He(e)}return!1}}class ga{constructor(t,e,n){this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=f.UNAUTHENTICATED,this.clientId=U.I(),this.credentialListener=()=>Promise.resolve(),this.credentials.start(e,(async t=>{I("FirestoreClient","Received user=",t.uid),await this.credentialListener(t),this.user=t}))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.credentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new x(D.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new k;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.credentials.shutdown(),t.resolve()}catch(e){const n=co(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function ma(t,e){t.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await hr(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function pa(t,e){t.asyncQueue.verifyOperationInProgress();const n=await ya(t);I("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>async function(t,e){const n=q(t);n.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const s=Bi(n);n.Wr.add(3),await Fi(n),s&&n.Hr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Wr.delete(3),await Li(n)}(e.remoteStore,t))),t.onlineComponents=e}async function ya(t){return t.offlineComponents||(I("FirestoreClient","Using default OfflineComponentProvider"),await ma(t,new ia)),t.offlineComponents}async function wa(t){return t.onlineComponents||(I("FirestoreClient","Using default OnlineComponentProvider"),await pa(t,new ca)),t.onlineComponents}function va(t){return ya(t).then((t=>t.persistence))}function ba(t){return ya(t).then((t=>t.localStore))}function Ia(t){return wa(t).then((t=>t.remoteStore))}function Ta(t){return wa(t).then((t=>t.syncEngine))}async function Ea(t){const e=await wa(t),n=e.eventManager;return n.onListen=Co.bind(null,e.syncEngine),n.onUnlisten=Ro.bind(null,e.syncEngine),n}function _a(t,e,n={}){const s=new k;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new ha({next:r=>{e.enqueueAndForget((()=>po(t,o)));const c=r.docs.has(n);!c&&r.fromCache?i.reject(new x(D.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&r.fromCache&&s&&"server"===s.source?i.reject(new x(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new bo(Jt(n.path),r,{includeMetadataChanges:!0,fo:!0});return mo(t,o)}(await Ea(t),t.asyncQueue,e,n,s))),s.promise}function Sa(t,e,n={}){const s=new k;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new ha({next:n=>{e.enqueueAndForget((()=>po(t,o))),n.fromCache&&"server"===s.source?i.reject(new x(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new bo(n,r,{includeMetadataChanges:!0,fo:!0});return mo(t,o)}(await Ea(t),t.asyncQueue,e,n,s))),s.promise}function Na(t,e,n,s){const i=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new la(t,e)}(function(t,e){if(t instanceof Uint8Array)return ua(t,e);if(t instanceof ArrayBuffer)return ua(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,Ni(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const s=q(t);(async function(t,e,n){try{const s=await e.getMetadata();if(await function(t,e){const n=q(t),s=An(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Je.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(s)>=0))}(t.localStore,s))return await e.close(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(s));n._updateProgress(_o(s));const i=new Eo(s,t.localStore,e.N);let r=await e.zo();for(;r;){const t=await i.mo(r);t&&n._updateProgress(t),r=await e.zo()}const o=await i.complete();await Go(t,o.En,void 0),await function(t,e){const n=q(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Je.saveBundleMetadata(t,e)))}(t.localStore,s),n._completeWith(o.progress)}catch(t){E("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t)}})(s,e,n).then((()=>{s.sharedClientState.notifyBundleLoaded()}))}(await Ta(t),i,s)}))}class Aa{constructor(t,e,n,s,i,r,o,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.useFetchStreams=c}}class Da{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Da&&t.projectId===this.projectId&&t.database===this.database}}const xa=new Map;function ka(t,e,n){if(!n)throw new x(D.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Ca(t,e,n,s){if(!0===e&&!0===s)throw new x(D.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Oa(t){if(!lt.isDocumentKey(t))throw new x(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Ra(t){if(lt.isDocumentKey(t))throw new x(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function La(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":S()}function Fa(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new x(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=La(t);throw new x(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function Pa(t,e){if(e<=0)throw new x(D.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class Ma{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new x(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new x(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Ca("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Va{constructor(t,e){this._credentials=e,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ma({}),this._settingsFrozen=!1,t instanceof Da?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new x(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Da(t.options.projectId)}(t))}get app(){if(!this._app)throw new x(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new x(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ma(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new O;switch(t.type){case"gapi":const e=t.client;return N(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new P(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new x(D.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=xa.get(t);e&&(I("ComponentProvider","Removing Datastore"),xa.delete(t),e.terminate())}(this),Promise.resolve()}}function Ua(t,e,n,s={}){var i;const r=(t=Fa(t,Va))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==e&&E("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=f.MOCK_USER;else{e=Object(h.f)(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new x(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new f(r)}t._credentials=new R(new C(e,n))}}class qa{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ba(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new qa(this.firestore,t,this._key)}}class ja{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new ja(this.firestore,t,this._query)}}class Ba extends ja{constructor(t,e,n){super(t,e,Jt(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new qa(this.firestore,null,new lt(t))}withConverter(t){return new Ba(this.firestore,t,this._path)}}function Ka(t,e,...n){if(t=Object(h.k)(t),ka("collection","path",e),t instanceof Va){const s=W.fromString(e,...n);return Ra(s),new Ba(t,null,s)}{if(!(t instanceof qa||t instanceof Ba))throw new x(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(W.fromString(e,...n));return Ra(s),new Ba(t.firestore,null,s)}}function $a(t,e){if(t=Fa(t,Va),ka("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new x(D.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ja(t,null,function(t){return new Yt(W.emptyPath(),t)}(e))}function za(t,e,...n){if(t=Object(h.k)(t),1===arguments.length&&(e=U.I()),ka("doc","path",e),t instanceof Va){const s=W.fromString(e,...n);return Oa(s),new qa(t,null,new lt(s))}{if(!(t instanceof qa||t instanceof Ba))throw new x(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(W.fromString(e,...n));return Oa(s),new qa(t.firestore,t instanceof Ba?t.converter:null,new lt(s))}}function Ga(t,e){return t=Object(h.k)(t),e=Object(h.k)(e),(t instanceof qa||t instanceof Ba)&&(e instanceof qa||e instanceof Ba)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Qa(t,e){return t=Object(h.k)(t),e=Object(h.k)(e),t instanceof ja&&e instanceof ja&&t.firestore===e.firestore&&ae(t._query,e._query)&&t.converter===e.converter}class Ha{constructor(){this._c=Promise.resolve(),this.mc=[],this.gc=!1,this.yc=[],this.Tc=null,this.Ec=!1,this.Ic=!1,this.Ac=[],this.ar=new Ai(this,"async_queue_retry"),this.Rc=()=>{const t=Si();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ar.tr()};const t=Si();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Rc)}get isShuttingDown(){return this.gc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.bc(),this.Pc(t)}enterRestrictedMode(t){if(!this.gc){this.gc=!0,this.Ic=t||!1;const e=Si();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Rc)}}enqueue(t){if(this.bc(),this.gc)return new Promise((()=>{}));const e=new k;return this.Pc((()=>this.gc&&this.Ic?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.mc.push(t),this.vc())))}async vc(){if(0!==this.mc.length){try{await this.mc[0](),this.mc.shift(),this.ar.reset()}catch(t){if(!Cr(t))throw t;I("AsyncQueue","Operation failed with retryable error: "+t)}this.mc.length>0&&this.ar.Xi((()=>this.vc()))}}Pc(t){const e=this._c.then((()=>(this.Ec=!0,t().catch((t=>{this.Tc=t,this.Ec=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw T("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ec=!1,t))))));return this._c=e,e}enqueueAfterDelay(t,e,n){this.bc(),this.Ac.indexOf(t)>-1&&(e=0);const s=ao.createAndSchedule(this,t,e,n,(t=>this.Vc(t)));return this.yc.push(s),s}bc(){this.Tc&&S()}verifyOperationInProgress(){}async Sc(){let t;do{t=this._c,await t}while(t!==this._c)}Dc(t){for(const e of this.yc)if(e.timerId===t)return!0;return!1}Cc(t){return this.Sc().then((()=>{this.yc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.yc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Sc()}))}Nc(t){this.Ac.push(t)}Vc(t){const e=this.yc.indexOf(t);this.yc.splice(e,1)}}function Wa(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Ya{constructor(){this._progressObserver={},this._taskCompletionResolver=new k,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const Xa=-1;class Ja extends Va{constructor(t,e){super(t,e),this.type="firestore",this._queue=new Ha,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||tc(this),this._firestoreClient.terminate()}}function Za(t){return t._firestoreClient||tc(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function tc(t){var e;const n=t._freezeSettings(),s=function(t,e,n,s){return new Aa(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new ga(t._credentials,t._queue,s)}function ec(t,e){hc(t=Fa(t,Ja));const n=Za(t),s=t._freezeSettings(),i=new ca;return rc(n,i,new oa(i,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function nc(t){hc(t=Fa(t,Ja));const e=Za(t),n=t._freezeSettings(),s=new ca;return rc(e,s,new aa(s,n.cacheSizeBytes))}function rc(t,e,n){const s=new k;return t.asyncQueue.enqueue((async()=>{try{await ma(t,n),await pa(t,e),s.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===D.FAILED_PRECONDITION||t.code===D.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}})).then((()=>s.promise))}function sc(t){if(t._initialized&&!t._terminated)throw new x(D.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new k;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!Dr.bt())return Promise.resolve();const e=t+"main";await Dr.delete(e)}(Ms(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function ic(t){return function(t){const e=new k;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=q(t);Bi(n.remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=q(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.In.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const s=n.Ko.get(t)||[];s.push(e),n.Ko.set(t,s)}catch(t){const n=co(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await Ta(t),e))),e.promise}(Za(t=Fa(t,Ja)))}function oc(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await va(t),n=await Ia(t);return e.setNetworkEnabled(!0),function(t){const e=q(t);return e.Wr.delete(0),Li(e)}(n)}))}(Za(t=Fa(t,Ja)))}function ac(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await va(t),n=await Ia(t);return e.setNetworkEnabled(!1),async function(t){const e=q(t);e.Wr.add(0),await Fi(e),e.Hr.set("Offline")}(n)}))}(Za(t=Fa(t,Ja)))}function cc(t,e){const n=Za(t=Fa(t,Ja)),s=new Ya;return Na(n,t._databaseId,e,s),s}function uc(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=q(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Je.getNamedQuery(t,e)))}(await ba(t),e)))}(Za(t=Fa(t,Ja)),e).then((e=>e?new ja(t,null,e.query):null))}function hc(t){if(t._initialized||t._terminated)throw new x(D.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class lc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new x(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new X(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class dc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new dc(Z.fromBase64String(t))}catch(t){throw new x(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new dc(Z.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class fc{constructor(t){this._methodName=t}}class gc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return j(this._lat,t._lat)||j(this._long,t._long)}}const mc=/^__.*__$/;class pc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Ue(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ve(t,this.data,e,this.fieldTransforms)}}class yc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Ue(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function wc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}class vc{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.N=n,this.ignoreUndefinedProperties=s,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get kc(){return this.settings.kc}$c(t){return new vc(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Oc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.$c({path:n,Fc:!1});return s.Mc(t),s}Lc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.$c({path:n,Fc:!1});return s.xc(),s}Bc(t){return this.$c({path:void 0,Fc:!0})}Uc(t){return Uc(t,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Kc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}xc(){if(this.path)for(let t=0;t<this.path.length;t++)this.Mc(this.path.get(t))}Mc(t){if(0===t.length)throw this.Uc("Document fields must not be empty");if(wc(this.kc)&&mc.test(t))throw this.Uc('Document fields cannot begin and end with "__"')}}class bc{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.N=n||Ni(t)}jc(t,e,n,s=!1){return new vc({kc:t,methodName:e,Kc:n,path:X.emptyPath(),Fc:!1,qc:s},this.databaseId,this.N,this.ignoreUndefinedProperties)}}function Ic(t){const e=t._freezeSettings(),n=Ni(t._databaseId);return new bc(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Tc(t,e,n,s,i,r={}){const o=t.jc(r.merge||r.mergeFields?2:0,e,n,i);Fc("Data must be an object, but it was:",o,s);const c=Rc(s,o);let a,u;if(r.merge)a=new dt(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=Pc(e,s,n);if(!o.contains(i))throw new x(D.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);qc(t,i)||t.push(i)}a=new dt(t),u=o.fieldTransforms.filter((t=>a.covers(t.field)))}else a=null,u=o.fieldTransforms;return new pc(new At(c),a,u)}class Ec extends fc{_toFieldTransform(t){if(2!==t.kc)throw 1===t.kc?t.Uc(`${this._methodName}() can only appear at the top level of your update data`):t.Uc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Ec}}function _c(t,e,n){return new vc({kc:3,Kc:e.settings.Kc,methodName:t._methodName,Fc:n},e.databaseId,e.N,e.ignoreUndefinedProperties)}class Sc extends fc{_toFieldTransform(t){return new De(t.path,new be)}isEqual(t){return t instanceof Sc}}class Nc extends fc{constructor(t,e){super(t),this.Qc=e}_toFieldTransform(t){const e=_c(this,t,!0),n=this.Qc.map((t=>Oc(t,e))),s=new Ie(n);return new De(t.path,s)}isEqual(t){return this===t}}class Ac extends fc{constructor(t,e){super(t),this.Qc=e}_toFieldTransform(t){const e=_c(this,t,!0),n=this.Qc.map((t=>Oc(t,e))),s=new Ee(n);return new De(t.path,s)}isEqual(t){return this===t}}class Dc extends fc{constructor(t,e){super(t),this.Wc=e}_toFieldTransform(t){const e=new Se(t.N,me(t.N,this.Wc));return new De(t.path,e)}isEqual(t){return this===t}}function xc(t,e,n,s){const i=t.jc(1,e,n);Fc("Data must be an object, but it was:",i,s);const r=[],o=At.empty();G(s,((t,s)=>{const c=Vc(e,t,n);s=Object(h.k)(s);const a=i.Lc(c);if(s instanceof Ec)r.push(c);else{const t=Oc(s,a);null!=t&&(r.push(c),o.set(c,t))}}));const c=new dt(r);return new yc(o,c,i.fieldTransforms)}function kc(t,e,n,s,i,r){const o=t.jc(1,e,n),c=[Pc(e,s,n)],a=[i];if(r.length%2!=0)throw new x(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)c.push(Pc(e,r[t])),a.push(r[t+1]);const u=[],l=At.empty();for(let t=c.length-1;t>=0;--t)if(!qc(u,c[t])){const e=c[t];let n=a[t];n=Object(h.k)(n);const s=o.Lc(e);if(n instanceof Ec)u.push(e);else{const t=Oc(n,s);null!=t&&(u.push(e),l.set(e,t))}}const d=new dt(u);return new yc(l,d,o.fieldTransforms)}function Cc(t,e,n,s=!1){return Oc(n,t.jc(s?4:3,e))}function Oc(t,e){if(Lc(t=Object(h.k)(t)))return Fc("Unsupported field value:",e,t),Rc(t,e);if(t instanceof fc)return function(t,e){if(!wc(e.kc))throw e.Uc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Uc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.kc)throw e.Uc("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=Oc(i,e.Bc(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(h.k)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return me(e.N,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=$.fromDate(t);return{timestampValue:_n(e.N,n)}}if(t instanceof $){const n=new $(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:_n(e.N,n)}}if(t instanceof gc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof dc)return{bytesValue:Sn(e.N,t._byteString)};if(t instanceof qa){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.Uc(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Dn(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Uc(`Unsupported field value: ${La(t)}`)}(t,e)}function Rc(t,e){const n={};return Q(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):G(t,((t,s)=>{const i=Oc(s,e.Oc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Lc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $||t instanceof gc||t instanceof dc||t instanceof qa||t instanceof fc)}function Fc(t,e,n){if(!Lc(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=La(n);throw"an object"===s?e.Uc(t+" a custom object"):e.Uc(t+" "+s)}}function Pc(t,e,n){if((e=Object(h.k)(e))instanceof lc)return e._internalPath;if("string"==typeof e)return Vc(t,e);throw Uc("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}const Mc=new RegExp("[~\\*/\\[\\]]");function Vc(t,e,n){if(e.search(Mc)>=0)throw Uc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new lc(...e.split("."))._internalPath}catch(r){throw Uc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Uc(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let c=`Function ${e}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let a="";return(r||o)&&(a+=" (found",r&&(a+=` in field ${s}`),o&&(a+=` in document ${i}`),a+=")"),new x(D.INVALID_ARGUMENT,c+t+a)}function qc(t,e){return t.some((t=>t.isEqual(e)))}class jc{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new qa(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Bc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Kc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Bc extends jc{data(){return super.data()}}function Kc(t,e){return"string"==typeof e?Vc(t,e):e instanceof lc?e._internalPath:e._delegate._internalPath}class $c{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class zc extends jc{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Gc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Kc("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Gc extends zc{data(t={}){return super.data(t)}}class Qc{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new $c(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Gc(this._firestore,this._userDataWriter,n.key,n,new $c(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new x(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Gc(t._firestore,t._userDataWriter,n.doc.key,n.doc,new $c(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Gc(t._firestore,t._userDataWriter,e.doc.key,e.doc,new $c(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Hc(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Hc(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function Wc(t,e){return t instanceof zc&&e instanceof zc?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Qc&&e instanceof Qc&&t._firestore===e._firestore&&Qa(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Yc(t){if(te(t)&&0===t.explicitOrderBy.length)throw new x(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Xc{}function Jc(t,...e){for(const n of e)t=n._apply(t);return t}class Zc extends Xc{constructor(t,e,n){super(),this.Gc=t,this.zc=e,this.Hc=n,this.type="where"}_apply(t){const e=Ic(t.firestore),n=function(t,e,n,s,i,r,o){let c;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new x(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on FieldPath.documentId().`);if("in"===r||"not-in"===r){th(o,r);const e=[];for(const n of o)e.push(fu(s,t,n));c={arrayValue:{values:e}}}else c=fu(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||th(o,r),c=Cc(n,"where",o,"in"===r||"not-in"===r);const a=Ft.create(i,r,c);return function(t,e){if(e.v()){const n=ne(t);if(null!==n&&!n.isEqual(e.field))throw new x(D.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=ee(t);null!==s&&gu(t,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new x(D.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(D.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,a),a}(t._query,0,e,t.firestore._databaseId,this.Gc,this.zc,this.Hc);return new ja(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new Yt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function tu(t,e,n){const s=e,i=Kc("where",t);return new Zc(i,s,n)}class eu extends Xc{constructor(t,e){super(),this.Gc=t,this.Jc=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new x(D.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new x(D.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Gt(e,n);return function(t,e){if(null===ee(t)){const n=ne(t);null!==n&&gu(t,n,e.field)}}(t,s),s}(t._query,this.Gc,this.Jc);return new ja(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Yt(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function nu(t,e="asc"){const n=e,s=Kc("orderBy",t);return new eu(s,n)}class ru extends Xc{constructor(t,e,n){super(),this.type=t,this.Yc=e,this.Xc=n}_apply(t){return new ja(t.firestore,t.converter,oe(t._query,this.Yc,this.Xc))}}function su(t){return Pa("limit",t),new ru("limit",t,"F")}function iu(t){return Pa("limitToLast",t),new ru("limitToLast",t,"L")}class ou extends Xc{constructor(t,e,n){super(),this.type=t,this.Zc=e,this.ta=n}_apply(t){const e=du(t,this.type,this.Zc,this.ta);return new ja(t.firestore,t.converter,function(t,e){return new Yt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function au(...t){return new ou("startAt",t,!0)}function cu(...t){return new ou("startAfter",t,!1)}class uu extends Xc{constructor(t,e,n){super(),this.type=t,this.Zc=e,this.ta=n}_apply(t){const e=du(t,this.type,this.Zc,this.ta);return new ja(t.firestore,t.converter,function(t,e){return new Yt(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function hu(...t){return new uu("endBefore",t,!0)}function lu(...t){return new uu("endAt",t,!1)}function du(t,e,n,s){if(n[0]=Object(h.k)(n[0]),n[0]instanceof jc)return function(t,e,n,s,i){if(!s)throw new x(D.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const r=[];for(const n of se(t))if(n.field.isKeyField())r.push(bt(e,s.key));else{const t=s.data.field(n.field);if(it(t))throw new x(D.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new x(D.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new $t(r,i)}(t._query,t.firestore._databaseId,e,n[0]._document,s);{const i=Ic(t.firestore);return function(t,e,n,s,i,r){const o=t.explicitOrderBy;if(i.length>o.length)throw new x(D.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const c=[];for(let r=0;r<i.length;r++){const a=i[r];if(o[r].field.isKeyField()){if("string"!=typeof a)throw new x(D.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof a}`);if(!re(t)&&-1!==a.indexOf("/"))throw new x(D.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${a}' contains a slash.`);const n=t.path.child(W.fromString(a));if(!lt.isDocumentKey(n))throw new x(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new lt(n);c.push(bt(e,i))}else{const t=Cc(n,s,a);c.push(t)}}return new $t(c,r)}(t._query,t.firestore._databaseId,i,e,n,s)}}function fu(t,e,n){if("string"==typeof(n=Object(h.k)(n))){if(""===n)throw new x(D.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!re(e)&&-1!==n.indexOf("/"))throw new x(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(W.fromString(n));if(!lt.isDocumentKey(s))throw new x(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return bt(t,new lt(s))}if(n instanceof qa)return bt(t,n._key);throw new x(D.INVALID_ARGUMENT,`Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ${La(n)}.`)}function th(t,e){if(!Array.isArray(t)||0===t.length)throw new x(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new x(D.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function gu(t,e,n){if(!n.isEqual(e))throw new x(D.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class mu{convertValue(t,e="none"){switch(ft(t)){case 0:return null;case 1:return t.booleanValue;case 2:return nt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(st(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw S()}}convertObject(t,e){const n={};return G(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new gc(nt(t.latitude),nt(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=ot(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(at(t));default:return null}}convertTimestamp(t){const e=et(t);return new $(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=W.fromString(t);N(Zn(n));const s=new Da(n.get(1),n.get(3)),i=new lt(n.popFirst(5));return s.isEqual(e)||T(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function pu(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}class yu extends mu{constructor(t){super(),this.firestore=t}convertBytes(t){return new dc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new qa(this.firestore,null,e)}}class wu{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Ic(t)}set(t,e,n){this._verifyNotCommitted();const s=vu(t,this._firestore),i=pu(s.converter,e,n),r=Tc(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,n);return this._mutations.push(r.toMutation(s._key,ke.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const i=vu(t,this._firestore);let r;return r="string"==typeof(e=Object(h.k)(e))||e instanceof lc?kc(this._dataReader,"WriteBatch.update",i._key,e,n,s):xc(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(r.toMutation(i._key,ke.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=vu(t,this._firestore);return this._mutations=this._mutations.concat(new Ke(e._key,ke.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(D.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function vu(t,e){if((t=Object(h.k)(t)).firestore!==e)throw new x(D.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function bu(t){t=Fa(t,qa);const e=Fa(t.firestore,Ja);return _a(Za(e),t._key).then((n=>Lu(e,t,n)))}class Iu extends mu{constructor(t){super(),this.firestore=t}convertBytes(t){return new dc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new qa(this.firestore,null,e)}}function Tu(t){t=Fa(t,qa);const e=Fa(t.firestore,Ja),n=Za(e),s=new Iu(e);return function(t,e){const n=new k;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await function(t,e){const n=q(t);return n.persistence.runTransaction("read document","readonly",(t=>n.Qn.An(t,e)))}(t,e);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new x(D.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=co(t,`Failed to get document '${e} from cache`);n.reject(s)}}(await ba(t),e,n))),n.promise}(n,t._key).then((n=>new zc(e,s,t._key,n,new $c(null!==n&&n.hasLocalMutations,!0),t.converter)))}function Eu(t){t=Fa(t,qa);const e=Fa(t.firestore,Ja);return _a(Za(e),t._key,{source:"server"}).then((n=>Lu(e,t,n)))}function _u(t){t=Fa(t,ja);const e=Fa(t.firestore,Ja),n=Za(e),s=new Iu(e);return Yc(t._query),Sa(n,t._query).then((n=>new Qc(e,s,t,n)))}function Su(t){t=Fa(t,ja);const e=Fa(t.firestore,Ja),n=Za(e),s=new Iu(e);return function(t,e){const n=new k;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await Ws(t,e,!0),i=new Ao(e,s.Gn),r=i.bo(s.documents),o=i.applyChanges(r,!1);n.resolve(o.snapshot)}catch(t){const s=co(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(await ba(t),e,n))),n.promise}(n,t._query).then((n=>new Qc(e,s,t,n)))}function Nu(t){t=Fa(t,ja);const e=Fa(t.firestore,Ja),n=Za(e),s=new Iu(e);return Sa(n,t._query,{source:"server"}).then((n=>new Qc(e,s,t,n)))}function Au(t,e,n){t=Fa(t,qa);const s=Fa(t.firestore,Ja),i=pu(t.converter,e,n);return Ru(s,[Tc(Ic(s),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,ke.none())])}function Du(t,e,n,...s){t=Fa(t,qa);const i=Fa(t.firestore,Ja),r=Ic(i);let o;return o="string"==typeof(e=Object(h.k)(e))||e instanceof lc?kc(r,"updateDoc",t._key,e,n,s):xc(r,"updateDoc",t._key,e),Ru(i,[o.toMutation(t._key,ke.exists(!0))])}function xu(t){return Ru(Fa(t.firestore,Ja),[new Ke(t._key,ke.none())])}function ku(t,e){const n=Fa(t.firestore,Ja),s=za(t),i=pu(t.converter,e);return Ru(n,[Tc(Ic(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,ke.exists(!1))]).then((()=>s))}function Cu(t,...e){var n,s,i;t=Object(h.k)(t);let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Wa(e[o])||(r=e[o],o++);const c={includeMetadataChanges:r.includeMetadataChanges};if(Wa(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let a,u,l;if(t instanceof qa)u=Fa(t.firestore,Ja),l=Jt(t._key.path),a={next:n=>{e[o]&&e[o](Lu(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Fa(t,ja);u=Fa(n.firestore,Ja),l=n._query;const s=new Iu(u);a={next:t=>{e[o]&&e[o](new Qc(u,s,n,t))},error:e[o+1],complete:e[o+2]},Yc(t._query)}return function(t,e,n,s){const i=new ha(s),r=new bo(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>mo(await Ea(t),r))),()=>{i.ec(),t.asyncQueue.enqueueAndForget((async()=>po(await Ea(t),r)))}}(Za(u),l,c,a)}function Ou(t,e){return function(t,e){const n=new ha(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){q(t).so.add(e),e.next()}(await Ea(t),n))),()=>{n.ec(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){q(t).so.delete(e)}(await Ea(t),n)))}}(Za(t=Fa(t,Ja)),Wa(e)?e:{next:e})}function Ru(t,e){return function(t,e){const n=new k;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=sa(t);try{const t=await function(t,e){const n=q(t),s=$.now(),i=e.reduce(((t,e)=>t.add(e.key)),un());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.Qn.Pn(t,i).next((i=>{r=i;const o=[];for(const t of e){const e=Fe(t,r.get(t.key));null!=e&&o.push(new Ue(t.key,e,Dt(e.value.mapValue),ke.exists(!0)))}return n.In.addMutationBatch(t,s,o,e)})))).then((t=>(t.applyToLocalDocumentSet(r),{batchId:t.batchId,changes:r})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.qo[t.currentUser.toKey()];s||(s=new Ye(j)),s=s.insert(e,n),t.qo[t.currentUser.toKey()]=s}(s,t.batchId,n),await Go(s,t.changes),await Wi(s.remoteStore)}catch(t){const e=co(t,"Failed to persist write");n.reject(e)}}(await Ta(t),e,n))),n.promise}(Za(t),e)}function Lu(t,e,n){const s=n.docs.get(e._key),i=new Iu(t);return new zc(t,i,e._key,s,new $c(n.hasPendingWrites,n.fromCache),e.converter)}class Fu extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Ic(t)}get(t){const e=vu(t,this._firestore),n=new yu(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return S();const s=t[0];if(s.isFoundDocument())return new jc(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new jc(this._firestore,n,e._key,null,e.converter);throw S()}))}set(t,e,n){const s=vu(t,this._firestore),i=pu(s.converter,e,n),r=Tc(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,n);return this._transaction.set(s._key,r),this}update(t,e,n,...s){const i=vu(t,this._firestore);let r;return r="string"==typeof(e=Object(h.k)(e))||e instanceof lc?kc(this._dataReader,"Transaction.update",i._key,e,n,s):xc(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,r),this}delete(t){const e=vu(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=vu(t,this._firestore),n=new Iu(this._firestore);return super.get(t).then((t=>new zc(this._firestore,n,e._key,t._document,new $c(!1,!1),e.converter)))}}function Pu(t,e){return function(t,e){const n=new k;return t.asyncQueue.enqueueAndForget((async()=>{const s=await function(t){return wa(t).then((t=>t.datastore))}(t);new fa(t.asyncQueue,s,e,n).run()})),n.promise}(Za(t=Fa(t,Ja)),(n=>e(new Fu(t,n))))}function Mu(){return new Ec("deleteField")}function Vu(){return new Sc("serverTimestamp")}function Uu(...t){return new Nc("arrayUnion",t)}function qu(...t){return new Ac("arrayRemove",t)}function ju(t){return new Dc("increment",t)}!function(t,e=!0){!function(t){m=t}(r.SDK_VERSION),Object(r._registerComponent)(new o.a("firestore",((t,{options:n})=>{const s=t.getProvider("app").getImmediate(),i=new Ja(s,new L(t.getProvider("auth-internal")));return n=Object.assign({useFetchStreams:e},n),i._setSettings(n),i}),"PUBLIC")),Object(r.registerVersion)(d,"3.3.0",t),Object(r.registerVersion)(d,"3.3.0","esm2017")}()}).call(this,n(202))},515:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return mr})),n.d(e,"b",(function(){return yr})),n.d(e,"c",(function(){return pr})),n.d(e,"d",(function(){return vr})),n.d(e,"e",(function(){return wr})),n.d(e,"f",(function(){return Ir})),n.d(e,"g",(function(){return Tr})),n.d(e,"h",(function(){return fr})),n.d(e,"i",(function(){return gr}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},c={},h=h||{},l=o||self;function d(){}function f(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function w(a,b,t){return a.call.apply(a.bind,arguments)}function v(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function q(a,b,t){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:v).apply(null,arguments)}function I(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}function T(a,b){function t(){}t.prototype=b.prototype,a.Z=b.prototype,a.prototype=new t,a.prototype.constructor=a,a.Vb=function(t,e,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[e].apply(t,r)}}function E(){this.s=this.s,this.o=this.o}var _={};E.prototype.s=!1,E.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var a=function(a){return Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++y)}(this);delete _[a]}},E.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const S=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1},N=Array.prototype.forEach?function(a,b,t){Array.prototype.forEach.call(a,b,t)}:function(a,b,t){const e=a.length,n="string"==typeof a?a.split(""):a;for(let r=0;r<e;r++)r in n&&b.call(t,n[r],r,a)};function A(a){return Array.prototype.concat.apply([],arguments)}function D(a){const b=a.length;if(0<b){const t=Array(b);for(let e=0;e<b;e++)t[e]=a[e];return t}return[]}function x(a){return/^[\s\xa0]*$/.test(a)}var k,C=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function O(a,b){return-1!=a.indexOf(b)}function R(a,b){return a<b?-1:a>b?1:0}t:{var L=l.navigator;if(L){var F=L.userAgent;if(F){k=F;break t}}k=""}function P(a,b,t){for(const e in a)b.call(t,a[e],e,a)}function M(a){const b={};for(const t in a)b[t]=a[t];return b}var V="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function U(a,b){let t,e;for(let n=1;n<arguments.length;n++){for(t in e=arguments[n],e)a[t]=e[t];for(let n=0;n<V.length;n++)t=V[n],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function j(a){return j[" "](a),a}j[" "]=d;var B,a,K=O(k,"Opera"),$=O(k,"Trident")||O(k,"MSIE"),z=O(k,"Edge"),G=z||$,Q=O(k,"Gecko")&&!(O(k.toLowerCase(),"webkit")&&!O(k,"Edge"))&&!(O(k,"Trident")||O(k,"MSIE"))&&!O(k,"Edge"),H=O(k.toLowerCase(),"webkit")&&!O(k,"Edge");function W(){var a=l.document;return a?a.documentMode:void 0}t:{var Y="",X=(a=k,Q?/rv:([^\);]+)(\)|;)/.exec(a):z?/Edge\/([\d\.]+)/.exec(a):$?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):H?/WebKit\/(\S+)/.exec(a):K?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(X&&(Y=X?X[1]:""),$){var J=W();if(null!=J&&J>parseFloat(Y)){B=String(J);break t}}B=Y}var Z,tt={};function et(){return function(a){var b=tt;return Object.prototype.hasOwnProperty.call(b,9)?b[9]:b[9]=a(9)}((function(){let a=0;const b=C(String(B)).split("."),t=C("9").split("."),e=Math.max(b.length,t.length);for(let o=0;0==a&&o<e;o++){var n=b[o]||"",r=t[o]||"";do{if(n=/(\d*)(\D*)(.*)/.exec(n)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==n[0].length&&0==r[0].length)break;a=R(0==n[1].length?0:parseInt(n[1],10),0==r[1].length?0:parseInt(r[1],10))||R(0==n[2].length,0==r[2].length)||R(n[2],r[2]),n=n[3],r=r[3]}while(0==a)}return 0<=a}))}if(l.document&&$){var nt=W();Z=nt||(parseInt(B,10)||void 0)}else Z=void 0;var st=Z,it=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",d,b),l.removeEventListener("test",d,b)}catch(t){}return a}();function ot(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}function at(a,b){if(ot.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(Q){t:{try{j(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:ct[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&at.Z.h.call(this)}}ot.prototype.h=function(){this.defaultPrevented=!0},T(at,ot);var ct={2:"touch",3:"pen",4:"mouse"};at.prototype.h=function(){at.Z.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var ut="closure_listenable_"+(1e6*Math.random()|0),ht=0;function lt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.ia=n,this.key=++ht,this.ca=this.fa=!1}function ft(a){a.ca=!0,a.listener=null,a.proxy=null,a.src=null,a.ia=null}function gt(a){this.src=a,this.g={},this.h=0}function mt(a,b){var t=b.type;if(t in a.g){var e,n=a.g[t],r=S(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(ft(b),0==a.g[t].length&&(delete a.g[t],a.h--))}}function pt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.ca&&r.listener==b&&r.capture==!!t&&r.ia==e)return n}return-1}gt.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=pt(a,b,e,n);return-1<o?(b=a[o],t||(b.fa=!1)):((b=new lt(b,this.src,r,!!e,n)).fa=t,a.push(b)),b};var yt="closure_lm_"+(1e6*Math.random()|0),wt={};function vt(a,b,t,e,n){if(e&&e.once)return It(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)vt(a,b[r],t,e,n);return null}return t=Dt(t),a&&a[ut]?a.N(b,t,p(e)?!!e.capture:!!e,n):bt(a,b,t,!1,e,n)}function bt(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=Nt(a);if(c||(a[yt]=c=new gt(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){function a(t){return b.call(a.src,a.listener,t)}var b=St;return a}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)it||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(_t(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function It(a,b,t,e,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)It(a,b[r],t,e,n);return null}return t=Dt(t),a&&a[ut]?a.O(b,t,p(e)?!!e.capture:!!e,n):bt(a,b,t,!0,e,n)}function Tt(a,b,t,e,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)Tt(a,b[r],t,e,n);else e=p(e)?!!e.capture:!!e,t=Dt(t),a&&a[ut]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(t=pt(r=a.g[b],t,e,n))&&(ft(r[t]),Array.prototype.splice.call(r,t,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=Nt(a))&&(b=a.g[b.toString()],a=-1,b&&(a=pt(b,t,e,n)),(t=-1<a?b[a]:null)&&Et(t))}function Et(a){if("number"!=typeof a&&a&&!a.ca){var b=a.src;if(b&&b[ut])mt(b.i,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(_t(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=Nt(b))?(mt(t,a),0==t.h&&(t.src=null,b[yt]=null)):ft(a)}}}function _t(a){return a in wt?wt[a]:wt[a]="on"+a}function St(a,b){if(a.ca)a=!0;else{b=new at(b,this);var t=a.listener,e=a.ia||a.src;a.fa&&Et(a),a=t.call(e,b)}return a}function Nt(a){return(a=a[yt])instanceof gt?a:null}var At="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dt(a){return"function"==typeof a?a:(a[At]||(a[At]=function(b){return a.handleEvent(b)}),a[At])}function xt(){E.call(this),this.i=new gt(this),this.P=this,this.I=null}function kt(a,b){var t,e=a.I;if(e)for(t=[];e;e=e.I)t.push(e);if(a=a.P,e=b.type||b,"string"==typeof b)b=new ot(b,a);else if(b instanceof ot)b.target=b.target||a;else{var n=b;U(b=new ot(e,a),n)}if(n=!0,t)for(var r=t.length-1;0<=r;r--){var o=b.g=t[r];n=Ct(o,e,!0,b)&&n}if(n=Ct(o=b.g=a,e,!0,b)&&n,n=Ct(o,e,!1,b)&&n,t)for(r=0;r<t.length;r++)n=Ct(o=b.g=t[r],e,!1,b)&&n}function Ct(a,b,t,e){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.ca&&o.capture==t){var c=o.listener,u=o.ia||o.src;o.fa&&mt(a.i,o),n=!1!==c.call(u,e)&&n}}return n&&!e.defaultPrevented}T(xt,E),xt.prototype[ut]=!0,xt.prototype.removeEventListener=function(a,b,t,e){Tt(this,a,b,t,e)},xt.prototype.M=function(){if(xt.Z.M.call(this),this.i){var t,a=this.i;for(t in a.g){for(var e=a.g[t],n=0;n<e.length;n++)ft(e[n]);delete a.g[t],a.h--}}this.I=null},xt.prototype.N=function(a,b,t,e){return this.i.add(String(a),b,!1,t,e)},xt.prototype.O=function(a,b,t,e){return this.i.add(String(a),b,!0,t,e)};var Ot=l.JSON.stringify;function Rt(){var a=qt;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Lt,Ft=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new Pt),(a=>a.reset()));class Pt{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Mt(a){l.setTimeout((()=>{throw a}),0)}function Vt(a,b){Lt||function(){var a=l.Promise.resolve(void 0);Lt=function(){a.then(jt)}}(),Ut||(Lt(),Ut=!0),qt.add(a,b)}var Ut=!1,qt=new class{constructor(){this.h=this.g=null}add(a,b){const t=Ft.get();t.set(a,b),this.h?this.h.next=t:this.g=t,this.h=t}};function jt(){for(var a;a=Rt();){try{a.h.call(a.g)}catch(t){Mt(t)}var b=Ft;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}Ut=!1}function Bt(a,b){xt.call(this),this.h=a||1,this.g=b||l,this.j=q(this.kb,this),this.l=Date.now()}function Kt(a){a.da=!1,a.S&&(a.g.clearTimeout(a.S),a.S=null)}function $t(a,b,t){if("function"==typeof a)t&&(a=q(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function zt(a){a.g=$t((()=>{a.g=null,a.i&&(a.i=!1,zt(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}T(Bt,xt),(r=Bt.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-a):(this.S&&(this.g.clearTimeout(this.S),this.S=null),kt(this,"tick"),this.da&&(Kt(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Bt.Z.M.call(this),Kt(this),delete this.g};class Gt extends E{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:zt(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Qt(a){E.call(this),this.h=a,this.g={}}T(Qt,E);var Ht=[];function Wt(a,b,t,e){Array.isArray(t)||(t&&(Ht[0]=t.toString()),t=Ht);for(var n=0;n<t.length;n++){var r=vt(b,t[n],e||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function Yt(a){P(a.g,(function(b,t){this.g.hasOwnProperty(t)&&Et(b)}),a),a.g={}}function Xt(){this.g=!0}function Jt(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return Ot(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}Qt.prototype.M=function(){Qt.Z.M.call(this),Yt(this)},Qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Xt.prototype.Aa=function(){this.g=!1},Xt.prototype.info=function(){};var Zt={},te=null;function ee(){return te=te||new xt}function ne(a){ot.call(this,Zt.Ma,a)}function re(a){const b=ee();kt(b,new ne(b,a))}function se(a,b){ot.call(this,Zt.STAT_EVENT,a),this.stat=b}function ie(a){const b=ee();kt(b,new se(b,a))}function oe(a,b){ot.call(this,Zt.Na,a),this.size=b}function ae(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}Zt.Ma="serverreachability",T(ne,ot),Zt.STAT_EVENT="statevent",T(se,ot),Zt.Na="timingevent",T(oe,ot);var ce={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ue={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function he(){}function le(a){return a.h||(a.h=a.i())}function de(){}he.prototype.h=null;var fe,ge={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function me(){ot.call(this,"d")}function pe(){ot.call(this,"c")}function ye(){}function we(a,b,t,e){this.l=a,this.j=b,this.m=t,this.X=e||1,this.V=new Qt(this),this.P=be,a=G?125:void 0,this.W=new Bt(a),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ve}function ve(){this.i=null,this.g="",this.h=!1}T(me,ot),T(pe,ot),T(ye,he),ye.prototype.g=function(){return new XMLHttpRequest},ye.prototype.i=function(){return{}},fe=new ye;var be=45e3,Ie={},Te={};function Ee(a,b,t){a.K=1,a.v=Ge(qe(b)),a.s=t,a.U=!0,_e(a,null)}function _e(a,b){a.F=Date.now(),De(a),a.A=qe(a.v);var t=a.A,e=a.X;Array.isArray(e)||(e=[String(e)]),sn(t.h,"t",e),a.C=0,t=a.l.H,a.h=new ve,a.g=ir(a.l,t?b:null,!a.s),0<a.O&&(a.L=new Gt(q(a.Ia,a,a.g),a.O)),Wt(a.V,a.g,"readystatechange",a.gb),b=a.H?M(a.H):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.s,b)):(a.u="GET",a.g.ea(a.A,a.u,null,b)),re(1),function(a,b,t,e,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),u=0;u<c.length;u++){var h=c[u].split("=");if(1<h.length){var l=h[0];h=h[1];var d=l.split("_");o=2<=d.length&&"type"==d[1]?o+(l+"=")+h+"&":o+(l+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.j,a.u,a.A,a.m,a.X,a.s)}function Se(a){return!!a.g&&("GET"==a.u&&2!=a.K&&a.l.Ba)}function Ne(a,b,t){let e,n=!0;for(;!a.I&&a.C<t.length;){if(e=Ae(a,t),e==Te){4==b&&(a.o=4,ie(14),n=!1),Jt(a.j,a.m,null,"[Incomplete Response]");break}if(e==Ie){a.o=4,ie(15),Jt(a.j,a.m,t,"[Invalid Chunk]"),n=!1;break}Jt(a.j,a.m,e,null),Re(a,e)}Se(a)&&e!=Te&&e!=Ie&&(a.h.g="",a.C=0),4!=b||0!=t.length||a.h.h||(a.o=1,ie(16),n=!1),a.i=a.i&&n,n?0<t.length&&!a.aa&&(a.aa=!0,(b=a.l).g==a&&b.$&&!b.L&&(b.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),Yn(b),b.L=!0,ie(11))):(Jt(a.j,a.m,t,"[Invalid Chunked Response]"),Oe(a),Ce(a))}function Ae(a,b){var t=a.C,e=b.indexOf("\n",t);return-1==e?Te:(t=Number(b.substring(t,e)),isNaN(t)?Ie:(e+=1)+t>b.length?Te:(b=b.substr(e,t),a.C=e+t,b))}function De(a){a.Y=Date.now()+a.P,xe(a,a.P)}function xe(a,b){if(null!=a.B)throw Error("WatchDog timer not null");a.B=ae(q(a.eb,a),b)}function ke(a){a.B&&(l.clearTimeout(a.B),a.B=null)}function Ce(a){0==a.l.G||a.I||Zn(a.l,a)}function Oe(a){ke(a);var b=a.L;b&&"function"==typeof b.na&&b.na(),a.L=null,Kt(a.W),Yt(a.V),a.g&&(b=a.g,a.g=null,b.abort(),b.na())}function Re(a,b){try{var t=a.l;if(0!=t.G&&(t.g==a||ln(t.i,a)))if(t.I=a.N,!a.J&&ln(t.i,a)&&3==t.G){try{var e=t.Ca.g.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.u){if(t.g){if(!(t.g.F+3e3<a.F))break t;Jn(t),jn(t)}Wn(t),ie(18)}}else t.ta=n[1],0<t.ta-t.U&&37500>n[2]&&t.N&&0==t.A&&!t.v&&(t.v=ae(q(t.ab,t),6e3));if(1>=hn(t.i)&&t.ka){try{t.ka()}catch(t){}t.ka=void 0}}else nr(t,11)}else if((a.J||t.g==a)&&Jn(t),!x(b))for(n=t.Ca.g.parse(b),b=0;b<n.length;b++){let h=n[b];if(t.U=h[0],h=h[1],2==t.G)if("c"==h[0]){t.J=h[1],t.la=h[2];const n=h[3];null!=n&&(t.ma=n,t.h.info("VER="+t.ma));const l=h[4];null!=l&&(t.za=l,t.h.info("SVER="+t.za));const d=h[5];null!=d&&"number"==typeof d&&0<d&&(e=1.5*d,t.K=e,t.h.info("backChannelRequestTimeoutMs_="+e)),e=t;const f=a.g;if(f){const t=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=e.i;!r.g&&(O(t,"spdy")||O(t,"quic")||O(t,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(dn(r,r.h),r.h=null))}if(e.D){const t=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(e.sa=t,ze(e.F,e.D,t))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-a.F,t.h.info("Handshake RTT: "+t.O+"ms"));var o=a;if((e=t).oa=sr(e,e.H?e.la:null,e.W),o.J){fn(e.i,o);var c=o,u=e.K;u&&c.setTimeout(u),c.B&&(ke(c),De(c)),e.g=o}else Hn(e);0<t.l.length&&$n(t)}else"stop"!=h[0]&&"close"!=h[0]||nr(t,7);else 3==t.G&&("stop"==h[0]||"close"==h[0]?"stop"==h[0]?nr(t,7):qn(t):"noop"!=h[0]&&t.j&&t.j.wa(h),t.A=0)}re(4)}catch(t){}}function Le(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(f(a)||"string"==typeof a)N(a,b,void 0);else{if(a.T&&"function"==typeof a.T)var t=a.T();else if(a.R&&"function"==typeof a.R)t=void 0;else if(f(a)||"string"==typeof a){t=[];for(var e=a.length,n=0;n<e;n++)t.push(n)}else for(n in t=[],e=0,a)t[e++]=n;e=function(a){if(a.R&&"function"==typeof a.R)return a.R();if("string"==typeof a)return a.split("");if(f(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a),n=e.length;for(var r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}}function Fe(a,b){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var e=0;e<t;e+=2)this.set(arguments[e],arguments[e+1])}else if(a)if(a instanceof Fe)for(t=a.T(),e=0;e<t.length;e++)this.set(t[e],a.get(t[e]));else for(e in a)this.set(e,a[e])}function Pe(a){if(a.i!=a.g.length){for(var b=0,t=0;b<a.g.length;){var e=a.g[b];Me(a.h,e)&&(a.g[t++]=e),b++}a.g.length=t}if(a.i!=a.g.length){var n={};for(t=b=0;b<a.g.length;)Me(n,e=a.g[b])||(a.g[t++]=e,n[e]=1),b++;a.g.length=t}}function Me(a,b){return Object.prototype.hasOwnProperty.call(a,b)}(r=we.prototype).setTimeout=function(a){this.P=a},r.gb=function(a){a=a.target;const b=this.L;b&&3==Fn(a)?b.l():this.Ia(a)},r.Ia=function(a){try{if(a==this.g)t:{const d=Fn(this.g);var b=this.g.Da();const f=this.g.ba();if(!(3>d)&&(3!=d||G||this.g&&(this.h.h||this.g.ga()||Pn(this.g)))){this.I||4!=d||7==b||re(8==b||0>=f?3:2),ke(this);var t=this.g.ba();this.N=t;e:if(Se(this)){var e=Pn(this.g);a="";var n=e.length,r=4==Fn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Oe(this),Ce(this);var o="";break e}this.h.i=new l.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(e[b],{stream:r&&b==n-1});e.splice(0,n),this.h.g+=a,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==t,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.X,d,t),this.i){if(this.$&&!this.J){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(c)){var h=c;break e}}h=null}if(!(t=h)){this.i=!1,this.o=3,ie(12),Oe(this),Ce(this);break t}Jt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Re(this,t)}this.U?(Ne(this,d,o),G&&this.i&&3==d&&(Wt(this.V,this.W,"tick",this.fb),this.W.start())):(Jt(this.j,this.m,o,null),Re(this,o)),4==d&&Oe(this),this.i&&!this.I&&(4==d?Zn(this.l,this):(this.i=!1,De(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,ie(12)):(this.o=0,ie(13)),Oe(this),Ce(this)}}}catch(t){}},r.fb=function(){if(this.g){var a=Fn(this.g),b=this.g.ga();this.C<b.length&&(ke(this),Ne(this,a,b),this.i&&4!=a&&De(this))}},r.cancel=function(){this.I=!0,Oe(this)},r.eb=function(){this.B=null;const a=Date.now();0<=a-this.Y?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.A),2!=this.K&&(re(3),ie(17)),Oe(this),this.o=2,Ce(this)):xe(this,this.Y-a)},(r=Fe.prototype).R=function(){Pe(this);for(var a=[],b=0;b<this.g.length;b++)a.push(this.h[this.g[b]]);return a},r.T=function(){return Pe(this),this.g.concat()},r.get=function(a,b){return Me(this.h,a)?this.h[a]:b},r.set=function(a,b){Me(this.h,a)||(this.i++,this.g.push(a)),this.h[a]=b},r.forEach=function(a,b){for(var t=this.T(),e=0;e<t.length;e++){var n=t[e],r=this.get(n);a.call(b,r,n,this)}};var Ve=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ue(a,b){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,a instanceof Ue){this.g=void 0!==b?b:a.g,je(this,a.j),this.s=a.s,Be(this,a.i),Ke(this,a.m),this.l=a.l,b=a.h;var t=new en;t.i=b.i,b.g&&(t.g=new Fe(b.g),t.h=b.h),$e(this,t),this.o=a.o}else a&&(t=String(a).match(Ve))?(this.g=!!b,je(this,t[1]||"",!0),this.s=Qe(t[2]||""),Be(this,t[3]||"",!0),Ke(this,t[4]),this.l=Qe(t[5]||"",!0),$e(this,t[6]||"",!0),this.o=Qe(t[7]||"")):(this.g=!!b,this.h=new en(null,this.g))}function qe(a){return new Ue(a)}function je(a,b,t){a.j=t?Qe(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Be(a,b,t){a.i=t?Qe(b,!0):b}function Ke(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function $e(a,b,t){b instanceof en?(a.h=b,function(a,b){b&&!a.j&&(nn(a),a.i=null,a.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(dd(this,e),sn(this,n,t))}),a)),a.j=b}(a.h,a.g)):(t||(b=He(b,Ze)),a.h=new en(b,a.g))}function ze(a,b,t){a.h.set(b,t)}function Ge(a){return ze(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Qe(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function He(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,We),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function We(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}Ue.prototype.toString=function(){var a=[],b=this.j;b&&a.push(He(b,Ye,!0),":");var t=this.i;return(t||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(He(b,Ye,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&a.push(":",String(t))),(t=this.l)&&(this.i&&"/"!=t.charAt(0)&&a.push("/"),a.push(He(t,"/"==t.charAt(0)?Je:Xe,!0))),(t=this.h.toString())&&a.push("?",t),(t=this.o)&&a.push("#",He(t,tn)),a.join("")};var Ye=/[#\/\?@]/g,Xe=/[#\?:]/g,Je=/[#\?]/g,Ze=/[#\?@]/g,tn=/#/g;function en(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function nn(a){a.g||(a.g=new Fe,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function dd(a,b){nn(a),b=on(a,b),Me(a.g.h,b)&&(a.i=null,a.h-=a.g.get(b).length,Me((a=a.g).h,b)&&(delete a.h[b],a.i--,a.g.length>2*a.i&&Pe(a)))}function rn(a,b){return nn(a),b=on(a,b),Me(a.g.h,b)}function sn(a,b,t){dd(a,b),0<t.length&&(a.i=null,a.g.set(on(a,b),D(t)),a.h+=t.length)}function on(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=en.prototype).add=function(a,b){nn(this),this.i=null,a=on(this,a);var t=this.g.get(a);return t||this.g.set(a,t=[]),t.push(b),this.h+=1,this},r.forEach=function(a,b){nn(this),this.g.forEach((function(t,e){N(t,(function(t){a.call(b,t,e,this)}),this)}),this)},r.T=function(){nn(this);for(var a=this.g.R(),b=this.g.T(),t=[],e=0;e<b.length;e++)for(var n=a[e],r=0;r<n.length;r++)t.push(b[e]);return t},r.R=function(a){nn(this);var b=[];if("string"==typeof a)rn(this,a)&&(b=A(b,this.g.get(on(this,a))));else{a=this.g.R();for(var t=0;t<a.length;t++)b=A(b,a[t])}return b},r.set=function(a,b){return nn(this),this.i=null,rn(this,a=on(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.R(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var a=[],b=this.g.T(),t=0;t<b.length;t++){var e=b[t],n=encodeURIComponent(String(e));e=this.R(e);for(var r=0;r<e.length;r++){var o=n;""!==e[r]&&(o+="="+encodeURIComponent(String(e[r]))),a.push(o)}}return this.i=a.join("&")};function an(a){this.l=a||cn,l.PerformanceNavigationTiming?a=0<(a=l.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.g&&l.g.Ea&&l.g.Ea()&&l.g.Ea().Zb),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var cn=10;function un(a){return!!a.h||!!a.g&&a.g.size>=a.j}function hn(a){return a.h?1:a.g?a.g.size:0}function ln(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function dn(a,b){a.g?a.g.add(b):a.h=b}function fn(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function gn(a){if(null!=a.h)return a.i.concat(a.h.D);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const t of a.g.values())b=b.concat(t.D);return b}return D(a.i)}function mn(){}function pn(){this.g=new mn}function yn(a,b,t){const e=t||"";try{Le(a,(function(t,n){let r=t;p(t)&&(r=Ot(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function wn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}function vn(a){this.l=a.$b||null,this.j=a.ib||!1}function bn(a,b){xt.call(this),this.D=a,this.u=b,this.m=void 0,this.readyState=In,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}an.prototype.cancel=function(){if(this.i=gn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}},mn.prototype.stringify=function(a){return l.JSON.stringify(a,void 0)},mn.prototype.parse=function(a){return l.JSON.parse(a,void 0)},T(vn,he),vn.prototype.g=function(){return new bn(this.l,this.j)},vn.prototype.i=function(a){return function(){return a}}({}),T(bn,xt);var In=0;function Tn(a){a.j.read().then(a.Sa.bind(a)).catch(a.ha.bind(a))}function td(a){a.readyState=4,a.l=null,a.j=null,a.A=null,En(a)}function En(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=bn.prototype).open=function(a,b){if(this.readyState!=In)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,En(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.D||l).fetch(new Request(this.B,b)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,td(this)),this.readyState=In},r.Va=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,En(this)),this.g&&(this.readyState=3,En(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==l.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Tn(this)}else a.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?td(this):En(this),3==this.readyState&&Tn(this)}},r.Ua=function(a){this.g&&(this.response=this.responseText=a,td(this))},r.Ta=function(a){this.g&&(this.response=a,td(this))},r.ha=function(){this.g&&td(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var t=b.next();!t.done;)t=t.value,a.push(t[0]+": "+t[1]),t=b.next();return a.join("\r\n")},Object.defineProperty(bn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var _n=l.JSON.parse;function Sn(a){xt.call(this),this.headers=new Fe,this.u=a||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Nn,this.K=this.L=!1}T(Sn,xt);var Nn="",An=/^https?$/i,Dn=["POST","PUT"];function xn(a){return"content-type"==a.toLowerCase()}function kn(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,Cn(a),Rn(a)}function Cn(a){a.D||(a.D=!0,kt(a,"complete"),kt(a,"error"))}function On(a){if(a.h&&void 0!==h&&(!a.C[1]||4!=Fn(a)||2!=a.ba()))if(a.v&&4==Fn(a))$t(a.Fa,0,a);else if(kt(a,"readystatechange"),4==Fn(a)){a.h=!1;try{const c=a.ba();t:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break t;default:b=!1}var t;if(!(t=b)){var e;if(e=0===c){var n=String(a.H).match(Ve)[1]||null;if(!n&&l.self&&l.self.location){var r=l.self.location.protocol;n=r.substr(0,r.length-1)}e=!An.test(n?n.toLowerCase():"")}t=e}if(t)kt(a,"complete"),kt(a,"success");else{a.m=6;try{var o=2<Fn(a)?a.g.statusText:""}catch(t){o=""}a.j=o+" ["+a.ba()+"]",Cn(a)}}finally{Rn(a)}}}function Rn(a,b){if(a.g){Ln(a);const t=a.g,e=a.C[0]?d:null;a.g=null,a.C=null,b||kt(a,"ready");try{t.onreadystatechange=e}catch(t){}}}function Ln(a){a.g&&a.K&&(a.g.ontimeout=null),a.A&&(l.clearTimeout(a.A),a.A=null)}function Fn(a){return a.g?a.g.readyState:0}function Pn(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.J){case Nn:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Mn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=function(a){let b="";return P(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):ze(a,b,t))}function Vn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function Un(a){this.za=0,this.l=[],this.h=new Xt,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Vn("failFast",!1,a),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Vn("baseRetryDelayMs",5e3,a),this.$a=Vn("retryDelaySeedMs",1e4,a),this.Ya=Vn("forwardChannelMaxRetries",2,a),this.ra=Vn("forwardChannelRequestTimeoutMs",2e4,a),this.qa=a&&a.xmlHttpFactory||void 0,this.Ba=a&&a.Yb||!1,this.K=void 0,this.H=a&&a.supportsCrossDomainXhr||!1,this.J="",this.i=new an(a&&a.concurrentRequestLimit),this.Ca=new pn,this.ja=a&&a.fastHandshake||!1,this.Ra=a&&a.Wb||!1,a&&a.Aa&&this.h.Aa(),a&&a.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&a&&a.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!a||!1!==a.Xb}function qn(a){if(Bn(a),3==a.G){var b=a.V++,t=qe(a.F);ze(t,"SID",a.J),ze(t,"RID",b),ze(t,"TYPE","terminate"),Gn(a,t),(b=new we(a,a.h,b,void 0)).K=2,b.v=Ge(qe(t)),t=!1,l.navigator&&l.navigator.sendBeacon&&(t=l.navigator.sendBeacon(b.v.toString(),"")),!t&&l.Image&&((new Image).src=b.v,t=!0),t||(b.g=ir(b.l,null),b.g.ea(b.v)),b.F=Date.now(),De(b)}rr(a)}function jn(a){a.g&&(Yn(a),a.g.cancel(),a.g=null)}function Bn(a){jn(a),a.u&&(l.clearTimeout(a.u),a.u=null),Jn(a),a.i.cancel(),a.m&&("number"==typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Kn(a,b){a.l.push(new class{constructor(a,b){this.h=a,this.g=b}}(a.Za++,b)),3==a.G&&$n(a)}function $n(a){un(a.i)||a.m||(a.m=!0,Vt(a.Ha,a),a.C=0)}function zn(a,b){var t;t=b?b.m:a.V++;const e=qe(a.F);ze(e,"SID",a.J),ze(e,"RID",t),ze(e,"AID",a.U),Gn(a,e),a.o&&a.s&&Mn(e,a.o,a.s),t=new we(a,a.h,t,a.C+1),null===a.o&&(t.H=a.s),b&&(a.l=b.D.concat(a.l)),b=Qn(a,t,1e3),t.setTimeout(Math.round(.5*a.ra)+Math.round(.5*a.ra*Math.random())),dn(a.i,t),Ee(t,e,b)}function Gn(a,b){a.j&&Le({},(function(t,e){ze(b,e,t)}))}function Qn(a,b,t){t=Math.min(a.l.length,t);var e=a.j?q(a.j.Oa,a.j,a):null;t:{var n=a.l;let r=-1;for(;;){const o=["count="+t];-1==r?0<t?(r=n[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let u=0;u<t;u++){let t=n[u].h;const h=n[u].g;if(t-=r,0>t)r=Math.max(0,n[u].h-100),c=!1;else try{yn(h,o,"req"+t+"_")}catch(t){e&&e(h)}}if(c){e=o.join("&");break t}}}return a=a.l.splice(0,t),b.D=a,e}function Hn(a){a.g||a.u||(a.Y=1,Vt(a.Ga,a),a.A=0)}function Wn(a){return!(a.g||a.u||3<=a.A)&&(a.Y++,a.u=ae(q(a.Ga,a),er(a,a.A)),a.A++,!0)}function Yn(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function Xn(a){a.g=new we(a,a.h,"rpc",a.Y),null===a.o&&(a.g.H=a.s),a.g.O=0;var b=qe(a.oa);ze(b,"RID","rpc"),ze(b,"SID",a.J),ze(b,"CI",a.N?"0":"1"),ze(b,"AID",a.U),Gn(a,b),ze(b,"TYPE","xmlhttp"),a.o&&a.s&&Mn(b,a.o,a.s),a.K&&a.g.setTimeout(a.K);var t=a.g;a=a.la,t.K=1,t.v=Ge(qe(b)),t.s=null,t.U=!0,_e(t,a)}function Jn(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function Zn(a,b){var t=null;if(a.g==b){Jn(a),Yn(a),a.g=null;var e=2}else{if(!ln(a.i,b))return;t=b.D,fn(a.i,b),e=1}if(a.I=b.N,0!=a.G)if(b.i)if(1==e){t=b.s?b.s.length:0,b=Date.now()-b.F;var n=a.C;kt(e=ee(),new oe(e,t,b,n)),$n(a)}else Hn(a);else if(3==(n=b.o)||0==n&&0<a.I||!(1==e&&function(a,b){return!(hn(a.i)>=a.i.j-(a.m?1:0)||(a.m?(a.l=b.D.concat(a.l),0):1==a.G||2==a.G||a.C>=(a.Xa?0:a.Ya)||(a.m=ae(q(a.Ha,a,b),er(a,a.C)),a.C++,0)))}(a,b)||2==e&&Wn(a)))switch(t&&0<t.length&&(b=a.i,b.i=b.i.concat(t)),n){case 1:nr(a,5);break;case 4:nr(a,10);break;case 3:nr(a,6);break;default:nr(a,2)}}function er(a,b){let t=a.Pa+Math.floor(Math.random()*a.$a);return a.j||(t*=2),t*b}function nr(a,b){if(a.h.info("Error code "+b),2==b){var t=null;a.j&&(t=null);var e=q(a.jb,a);t||(t=new Ue("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||je(t,"https"),Ge(t)),function(a,b){const t=new Xt;if(l.Image){const e=new Image;e.onload=I(wn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=I(wn,t,e,"TestLoadImage: error",!1,b),e.onabort=I(wn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=I(wn,t,e,"TestLoadImage: timeout",!1,b),l.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else ie(2);a.G=0,a.j&&a.j.va(b),rr(a),Bn(a)}function rr(a){a.G=0,a.I=-1,a.j&&(0==gn(a.i).length&&0==a.l.length||(a.i.i.length=0,D(a.l),a.l.length=0),a.j.ua())}function sr(a,b,t){let e=function(a){return a instanceof Ue?qe(a):new Ue(a,void 0)}(t);if(""!=e.i)b&&Be(e,b+"."+e.i),Ke(e,e.m);else{const n=l.location;e=function(a,b,t,e){var n=new Ue(null,void 0);return a&&je(n,a),b&&Be(n,b),t&&Ke(n,t),e&&(n.l=e),n}(n.protocol,b?b+"."+n.hostname:n.hostname,+n.port,t)}return a.aa&&P(a.aa,(function(t,n){ze(e,n,t)})),b=a.D,t=a.sa,b&&t&&ze(e,b,t),ze(e,"VER",a.ma),Gn(a,e),e}function ir(a,b,t){if(b&&!a.H)throw Error("Can't create secondary domain capable XhrIo object.");return(b=t&&a.Ba&&!a.qa?new Sn(new vn({ib:!0})):new Sn(a.qa)).L=a.H,b}function or(){}function ar(){if($&&!(10<=Number(st)))throw Error("Environmental error: no available transport.")}function cr(a,b){xt.call(this),this.g=new Un(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.ya&&(a?a["X-WebChannel-Client-Profile"]=b.ya:a={"X-WebChannel-Client-Profile":b.ya}),this.g.P=a,(a=b&&b.httpHeadersOverwriteParam)&&!x(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!x(b)&&(this.g.D=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new dr(this)}function ur(a){me.call(this);var b=a.__sm__;if(b){t:{for(const t in b){a=t;break t}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function lr(){pe.call(this),this.status=1}function dr(a){this.g=a}(r=Sn.prototype).ea=function(a,b,t,e){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+a);b=b?b.toUpperCase():"GET",this.H=a,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():fe.g(),this.C=this.u?le(this.u):le(fe),this.g.onreadystatechange=q(this.Fa,this);try{this.F=!0,this.g.open(b,String(a),!0),this.F=!1}catch(t){return void kn(this,t)}a=t||"";const n=new Fe(this.headers);e&&Le(e,(function(t,e){n.set(e,t)})),e=function(a){t:{var b=xn;const t=a.length,e="string"==typeof a?a.split(""):a;for(let n=0;n<t;n++)if(n in e&&b.call(void 0,e[n],n,a)){b=n;break t}b=-1}return 0>b?null:"string"==typeof a?a.charAt(b):a[b]}(n.T()),t=l.FormData&&a instanceof l.FormData,!(0<=S(Dn,b))||e||t||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ln(this),0<this.B&&((this.K=function(a){return $&&et()&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.pa,this)):this.A=$t(this.pa,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(t){kn(this,t)}},r.pa=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,kt(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,kt(this,"complete"),kt(this,"abort"),Rn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Rn(this,!0)),Sn.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?On(this):this.cb())},r.cb=function(){On(this)},r.ba=function(){try{return 2<Fn(this)?this.g.status:-1}catch(t){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Qa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),_n(b)}},r.Da=function(){return this.m},r.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=Un.prototype).ma=8,r.G=1,r.hb=function(a){try{this.h.info("Origin Trials invoked: "+a)}catch(t){}},r.Ha=function(a){if(this.m)if(this.m=null,1==this.G){if(!a){this.V=Math.floor(1e5*Math.random()),a=this.V++;const n=new we(this,this.h,a,void 0);let r=this.s;if(this.P&&(r?(r=M(r),U(r,this.P)):r=this.P),null===this.o&&(n.H=r),this.ja)t:{for(var b=0,t=0;t<this.l.length;t++){var e=this.l[t];if(void 0===(e="__data__"in e.g&&"string"==typeof(e=e.g.__data__)?e.length:void 0))break;if(4096<(b+=e)){b=t;break t}if(4096===b||t===this.l.length-1){b=t+1;break t}}b=1e3}else b=1e3;b=Qn(this,n,b),ze(t=qe(this.F),"RID",a),ze(t,"CVER",22),this.D&&ze(t,"X-HTTP-Session-Id",this.D),Gn(this,t),this.o&&r&&Mn(t,this.o,r),dn(this.i,n),this.Ra&&ze(t,"TYPE","init"),this.ja?(ze(t,"$req",b),ze(t,"SID","null"),n.$=!0,Ee(n,t,null)):Ee(n,t,b),this.G=2}}else 3==this.G&&(a?zn(this,a):0==this.l.length||un(this.i)||zn(this))},r.Ga=function(){if(this.u=null,Xn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var a=2*this.O;this.h.info("BP detection timer enabled: "+a),this.B=ae(q(this.bb,this),a)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ie(10),jn(this),Xn(this))},r.ab=function(){null!=this.v&&(this.v=null,jn(this),Wn(this),ie(19))},r.jb=function(a){a?(this.h.info("Successfully pinged google.com"),ie(2)):(this.h.info("Failed to ping google.com"),ie(1))},(r=or.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},ar.prototype.g=function(a,b){return new cr(a,b)},T(cr,xt),cr.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var a=this.g,b=this.l,t=this.h||void 0;a.Wa&&(a.h.info("Origin Trials enabled."),Vt(q(a.hb,a,b))),ie(0),a.W=b,a.aa=t||{},a.N=a.X,a.F=sr(a,null,a.W),$n(a)},cr.prototype.close=function(){qn(this.g)},cr.prototype.u=function(a){if("string"==typeof a){var b={};b.__data__=a,Kn(this.g,b)}else this.v?((b={}).__data__=Ot(a),Kn(this.g,b)):Kn(this.g,a)},cr.prototype.M=function(){this.g.j=null,delete this.j,qn(this.g),delete this.g,cr.Z.M.call(this)},T(ur,me),T(lr,pe),T(dr,or),dr.prototype.xa=function(){kt(this.g,"a")},dr.prototype.wa=function(a){kt(this.g,new ur(a))},dr.prototype.va=function(a){kt(this.g,new lr(a))},dr.prototype.ua=function(){kt(this.g,"b")},ar.prototype.createWebChannel=ar.prototype.g,cr.prototype.send=cr.prototype.u,cr.prototype.open=cr.prototype.m,cr.prototype.close=cr.prototype.close,ce.NO_ERROR=0,ce.TIMEOUT=8,ce.HTTP_ERROR=6,ue.COMPLETE="complete",de.EventType=ge,ge.OPEN="a",ge.CLOSE="b",ge.ERROR="c",ge.MESSAGE="d",xt.prototype.listen=xt.prototype.N,Sn.prototype.listenOnce=Sn.prototype.O,Sn.prototype.getLastError=Sn.prototype.La,Sn.prototype.getLastErrorCode=Sn.prototype.Da,Sn.prototype.getStatus=Sn.prototype.ba,Sn.prototype.getResponseJson=Sn.prototype.Qa,Sn.prototype.getResponseText=Sn.prototype.ga,Sn.prototype.send=Sn.prototype.ea;var fr=c.createWebChannelTransport=function(){return new ar},gr=c.getStatEventTarget=function(){return ee()},mr=c.ErrorCode=ce,pr=c.EventType=ue,yr=c.Event=Zt,wr=c.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},vr=c.FetchXmlHttpFactory=vn,Ir=c.WebChannel=de,Tr=c.XhrIo=Sn}).call(this,n(73))},527:function(t,e,n){"use strict";n.r(e);var r=n(419),o=n(514),c=n(415),h=n(418);function l(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new o.g("invalid-argument",`Invalid options passed to function ${t}(): You cannot specify both "merge" and "mergeFields".`);return e}function d(){if("undefined"==typeof Uint8Array)throw new o.g("unimplemented","Uint8Arrays are not available in this environment.")}function f(){if(!Object(o.r)())throw new o.g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class m{constructor(t){this._delegate=t}static fromBase64String(t){return f(),new m(o.b.fromBase64String(t))}static fromUint8Array(t){return d(),new m(o.b.fromUint8Array(t))}toBase64(){return f(),this._delegate.toBase64()}toUint8Array(){return d(),this._delegate.toUint8Array()}isEqual(t){return this._delegate.isEqual(t._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function y(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const object=t;for(const t of e)if(t in object&&"function"==typeof object[t])return!0;return!1}(t,["next","error","complete"])}class w{enableIndexedDbPersistence(t,e){return Object(o.F)(t._delegate,{forceOwnership:e})}enableMultiTabIndexedDbPersistence(t){return Object(o.G)(t._delegate)}clearIndexedDbPersistence(t){return Object(o.x)(t._delegate)}}class v{constructor(t,e,n){this._delegate=e,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},t instanceof o.m||(this._appCompat=t)}get _databaseId(){return this._delegate._databaseId}settings(t){const e=this._delegate._getSettings();t.merge||e.host===t.host||Object(o.s)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)}useEmulator(t,e,n={}){Object(o.A)(this._delegate,t,e,n)}enableNetwork(){return Object(o.H)(this._delegate)}disableNetwork(){return Object(o.D)(this._delegate)}enablePersistence(t){let e=!1,n=!1;return t&&(e=!!t.synchronizeTabs,n=!!t.experimentalForceOwningTab,Object(o.t)("synchronizeTabs",e,"experimentalForceOwningTab",n)),e?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Object(o.lb)(this._delegate)}onSnapshotsInSync(t){return Object(o.Y)(this._delegate,t)}get app(){if(!this._appCompat)throw new o.g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(t){try{return new L(this,Object(o.y)(this._delegate,t))}catch(t){throw N(t,"collection()","Firestore.collection()")}}doc(t){try{return new S(this,Object(o.E)(this._delegate,t))}catch(t){throw N(t,"doc()","Firestore.doc()")}}collectionGroup(t){try{return new C(this,Object(o.z)(this._delegate,t))}catch(t){throw N(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return Object(o.db)(this._delegate,(e=>t(new T(this,e))))}batch(){return Object(o.K)(this._delegate),new E(new o.l(this._delegate,(t=>Object(o.L)(this._delegate,t))))}loadBundle(t){return Object(o.V)(this._delegate,t)}namedQuery(t){return Object(o.W)(this._delegate,t).then((t=>t?new C(this,t):null))}}class I extends o.a{constructor(t){super(),this.firestore=t}convertBytes(t){return new m(new o.b(t))}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return S.forKey(e,this.firestore,null)}}class T{constructor(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new I(t)}get(t){const e=F(t);return this._delegate.get(e).then((t=>new x(this._firestore,new o.e(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,e.converter))))}set(t,data,e){const n=F(t);return e?(l("Transaction.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=F(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=F(t);return this._delegate.delete(e),this}}class E{constructor(t){this._delegate=t}set(t,data,e){const n=F(t);return e?(l("WriteBatch.set",e),this._delegate.set(n,data,e)):this._delegate.set(n,data),this}update(t,e,n,...r){const o=F(t);return 2===arguments.length?this._delegate.update(o,e):this._delegate.update(o,e,n,...r),this}delete(t){const e=F(t);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class _{constructor(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}fromFirestore(t,e){const n=new o.i(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new k(this._firestore,n),null!=e?e:{})}toFirestore(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)}static getInstance(t,e){const n=_.INSTANCES;let r=n.get(t);r||(r=new WeakMap,n.set(t,r));let o=r.get(e);return o||(o=new _(t,new I(t),e),r.set(e,o)),o}}_.INSTANCES=new WeakMap;class S{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new I(t)}static forPath(path,t,e){if(path.length%2!=0)throw new o.g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${path.canonicalString()} has ${path.length}`);return new S(t,new o.d(t._delegate,e,new o.n(path)))}static forKey(t,e,n){return new S(e,new o.d(e._delegate,n,t))}get id(){return this._delegate.id}get parent(){return new L(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(t){try{return new L(this.firestore,Object(o.y)(this._delegate,t))}catch(t){throw N(t,"collection()","DocumentReference.collection()")}}isEqual(t){return(t=Object(c.k)(t))instanceof o.d&&Object(o.cb)(this._delegate,t)}set(t,e){e=l("DocumentReference.set",e);try{return e?Object(o.fb)(this._delegate,t,e):Object(o.fb)(this._delegate,t)}catch(t){throw N(t,"setDoc()","DocumentReference.set()")}}update(t,e,...n){try{return 1===arguments.length?Object(o.kb)(this._delegate,t):Object(o.kb)(this._delegate,t,e,...n)}catch(t){throw N(t,"updateDoc()","DocumentReference.update()")}}delete(){return Object(o.B)(this._delegate)}onSnapshot(...t){const e=A(t),n=D(t,(t=>new x(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))));return Object(o.X)(this._delegate,e,n)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.N)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.O)(this._delegate):Object(o.M)(this._delegate),e.then((t=>new x(this.firestore,new o.e(this.firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,this._delegate.converter))))}withConverter(t){return new S(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function N(t,e,n){return t.message=t.message.replace(e,n),t}function A(t){for(const e of t)if("object"==typeof e&&!y(e))return e;return{}}function D(t,e){var n,r;let o;return o=y(t[0])?t[0]:y(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]},{next:t=>{o.next&&o.next(e(t))},error:null===(n=o.error)||void 0===n?void 0:n.bind(o),complete:null===(r=o.complete)||void 0===r?void 0:r.bind(o)}}class x{constructor(t,e){this._firestore=t,this._delegate=e}get ref(){return new S(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(t){return this._delegate.data(t)}get(t,e){return this._delegate.get(t,e)}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class k extends x{data(t){const data=this._delegate.data(t);return Object(o.q)(void 0!==data,"Document in a QueryDocumentSnapshot should exist"),data}}class C{constructor(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new I(t)}where(t,e,n){try{return new C(this.firestore,Object(o.ab)(this._delegate,Object(o.mb)(t,e,n)))}catch(t){throw N(t,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(t,e){try{return new C(this.firestore,Object(o.ab)(this._delegate,Object(o.Z)(t,e)))}catch(t){throw N(t,/(orderBy|where)\(\)/,"Query.$1()")}}limit(t){try{return new C(this.firestore,Object(o.ab)(this._delegate,Object(o.T)(t)))}catch(t){throw N(t,"limit()","Query.limit()")}}limitToLast(t){try{return new C(this.firestore,Object(o.ab)(this._delegate,Object(o.U)(t)))}catch(t){throw N(t,"limitToLast()","Query.limitToLast()")}}startAt(...t){try{return new C(this.firestore,Object(o.ab)(this._delegate,Object(o.jb)(...t)))}catch(t){throw N(t,"startAt()","Query.startAt()")}}startAfter(...t){try{return new C(this.firestore,Object(o.ab)(this._delegate,Object(o.ib)(...t)))}catch(t){throw N(t,"startAfter()","Query.startAfter()")}}endBefore(...t){try{return new C(this.firestore,Object(o.ab)(this._delegate,Object(o.J)(...t)))}catch(t){throw N(t,"endBefore()","Query.endBefore()")}}endAt(...t){try{return new C(this.firestore,Object(o.ab)(this._delegate,Object(o.I)(...t)))}catch(t){throw N(t,"endAt()","Query.endAt()")}}isEqual(t){return Object(o.bb)(this._delegate,t._delegate)}get(t){let e;return e="cache"===(null==t?void 0:t.source)?Object(o.Q)(this._delegate):"server"===(null==t?void 0:t.source)?Object(o.R)(this._delegate):Object(o.P)(this._delegate),e.then((t=>new R(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))))}onSnapshot(...t){const e=A(t),n=D(t,(t=>new R(this.firestore,new o.j(this.firestore._delegate,this._userDataWriter,this._delegate,t._snapshot))));return Object(o.X)(this._delegate,e,n)}withConverter(t){return new C(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}class O{constructor(t,e){this._firestore=t,this._delegate=e}get type(){return this._delegate.type}get doc(){return new k(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class R{constructor(t,e){this._firestore=t,this._delegate=e}get query(){return new C(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((t=>new k(this._firestore,t)))}docChanges(t){return this._delegate.docChanges(t).map((t=>new O(this._firestore,t)))}forEach(t,e){this._delegate.forEach((n=>{t.call(e,new k(this._firestore,n))}))}isEqual(t){return Object(o.hb)(this._delegate,t._delegate)}}class L extends C{constructor(t,e){super(t,e),this.firestore=t,this._delegate=e}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const t=this._delegate.parent;return t?new S(this.firestore,t):null}doc(t){try{return new S(this.firestore,void 0===t?Object(o.E)(this._delegate):Object(o.E)(this._delegate,t))}catch(t){throw N(t,"doc()","CollectionReference.doc()")}}add(data){return Object(o.u)(this._delegate,data).then((t=>new S(this.firestore,t)))}isEqual(t){return Object(o.cb)(this._delegate,t._delegate)}withConverter(t){return new L(this.firestore,t?this._delegate.withConverter(_.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}function F(t){return Object(o.p)(t,o.d)}class P{constructor(...t){this._delegate=new o.f(...t)}static documentId(){return new P(o.o.keyField().canonicalString())}isEqual(t){return(t=Object(c.k)(t))instanceof o.f&&this._delegate._internalPath.isEqual(t._internalPath)}}class M{constructor(t){this._delegate=t}static serverTimestamp(){const t=Object(o.eb)();return t._methodName="FieldValue.serverTimestamp",new M(t)}static delete(){const t=Object(o.C)();return t._methodName="FieldValue.delete",new M(t)}static arrayUnion(...t){const e=Object(o.w)(...t);return e._methodName="FieldValue.arrayUnion",new M(e)}static arrayRemove(...t){const e=Object(o.v)(...t);return e._methodName="FieldValue.arrayRemove",new M(e)}static increment(t){const e=Object(o.S)(t);return e._methodName="FieldValue.increment",new M(e)}isEqual(t){return this._delegate.isEqual(t._delegate)}}const V={Firestore:v,GeoPoint:o.h,Timestamp:o.k,Blob:m,Transaction:T,WriteBatch:E,DocumentReference:S,DocumentSnapshot:x,Query:C,QueryDocumentSnapshot:k,QuerySnapshot:R,CollectionReference:L,FieldPath:P,FieldValue:M,setLogLevel:function(t){Object(o.gb)(t)},CACHE_SIZE_UNLIMITED:o.c};var U,j;U=r.a,j=(t,e)=>new v(t,e,new w),U.INTERNAL.registerComponent(new h.a("firestore-compat",(t=>{const e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("firestore").getImmediate();return j(e,n)}),"PUBLIC").setServiceProps(Object.assign({},V))),U.registerVersion("@firebase/firestore-compat","0.1.7")}}]);